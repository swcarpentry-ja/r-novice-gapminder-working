<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="ja" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>再現可能な化学分析のためのR: 一つにまとまったページ</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css">
<script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="manifest" href="../site.webmanifest">
<link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav software"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">本文へ移動</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="swc-logo" alt="Software Carpentry" src="../assets/images/software-logo.svg">
</div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> インストラクター表示 <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='../aio.html';">学習者表示</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav software" aria-label="メインナビゲーション"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="ナビゲーションの切り替え">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">メニュー</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Software Carpentry" src="../assets/images/software-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      再現可能な化学分析のためのR
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="オールインワンページで検索" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            再現可能な化学分析のためのR
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">まとめ</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">インストラクター用メモ</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">全ての画像</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            その他 <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<hr>
<li><a class="dropdown-item" href="discuss.html">議論１</a></li>
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="オールインワンページで検索"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="オールインワンページで検索">オールインワンページで検索</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  再現可能な化学分析のためのR
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress software">
    <div class="progress-bar software" role="progressbar" style="width: %" aria-valuenow="" aria-label="レッスンの進捗状況" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="メニューを閉じる" alt="メニューを閉じる" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="折りたたむ " data-episodes="エピソード ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> インストラクター表示
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../aio.html">学習者表示</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  エピソード
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">概要とスケジュール</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-rstudio-intro.html">1. RとRStudio入門</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-project-intro.html">2. Project Management With RStudio</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-seeking-help.html">3. Seeking Help</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-data-structures-part1.html">4. Data Structures</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-data-structures-part2.html">5. Exploring Data Frames</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="06-data-subsetting.html">6. Subsetting Data</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-control-flow.html">7. Control Flow</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="08-plot-ggplot2.html">8. Creating Publication-Quality Graphics with ggplot2</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="09-vectorization.html">9. ベクトル化</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush11">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading11">
        <a href="10-functions.html">10. Functions Explained</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush12">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading12">
        <a href="11-writing-data.html">11. データの出力</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush13">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading13">
        <a href="12-dplyr.html">12. Data Frame Manipulation with dplyr</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush14">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading14">
        <a href="13-tidyr.html">13. Data Frame Manipulation with tidyr</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush15">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading15">
        <a href="14-knitr-markdown.html">14. Producing Reports With knitr</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush16">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading16">
        <a href="15-wrap-up.html">15. Writing Good Software</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    資料
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="../instructor/key-points.html">まとめ</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">インストラクター用メモ</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">全ての画像</a>
                      </li>
                      <hr>
<li><a class="dropdown-item" href="discuss.html">議論１</a></li>
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources">
<a href="../instructor/aio.html">一つにまとまったページ</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-01-rstudio-intro"><p>Content from <a href="01-rstudio-intro.html">RとRStudio入門</a></p>
<hr>
<p>最終更新日：2024-10-12 |

        <a href="https://github.com/swcarpentry-ja/r-novice-gapminder/edit/main/episodes/01-rstudio-intro.Rmd" class="external-link">ページの編集 <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>所要時間：<i aria-hidden="true" data-feather="clock"></i> 55分</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="回答を全て表示する " data-collapse="回答を全て折りたたむ "> 回答を全て表示する <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">概要</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">質問</h3>
<ul>
<li>RStudio はどのように操作したらよいですか？</li>
<li>R とはどのようにやりとりしたらよいですか？</li>
<li>環境の管理はどうしたらよいですか？</li>
<li>パッケージのインストールはどうしたらよいですか？</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">目的</h3>
<ul>
<li>RStudio IDE
の各ウィンドウの使用目的と使い方が説明出来るようになりましょう。</li>
<li>RStudio IDE のボタンやオプションの位置を理解しましょう。</li>
<li>変数が定義出来るようになりましょう。</li>
<li>変数に値の設定が出来るようになりましょう。</li>
<li>R セッションのワークスペース管理が出来るようになりましょう。</li>
<li>算術演算子や比較演算子が使えるようになりましょう。</li>
<li>関数が呼び出せるようになりましょう。</li>
<li>パーッケージをロードしましょう。</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="ワークショップを始める前に">ワークショップを始める前に<a class="anchor" aria-label="anchor" href="#%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%83%E3%83%97%E3%82%92%E5%A7%8B%E3%82%81%E3%82%8B%E5%89%8D%E3%81%AB"></a>
</h2>
<hr class="half-width">
<p>RとRStudioの最新バージョンが、自分のコンピューターにインストールされているか確認してください。
最新バージョンであることが重要である理由は、ワークショップで使うパッケージには、Rが最新でないと、正常に（または全く）インストールされないものがあるからです。</p>
<ul>
<li><a href="https://www.r-project.org/" class="external-link">ここからRの最新バージョンをダウンロード及びインストール下さい</a></li>
<li><a href="https://www.rstudio.com/products/rstudio/download/#download" class="external-link">ここからRStudioをダウンロード及びインストール下さい</a></li>
</ul></section><section><h2 class="section-heading" id="r-とrstudio-を使う理由">R とRStudio を使う理由<a class="anchor" aria-label="anchor" href="#r-%E3%81%A8rstudio-%E3%82%92%E4%BD%BF%E3%81%86%E7%90%86%E7%94%B1"></a>
</h2>
<hr class="half-width">
<p>Software CarpentryのR部分のワークショップへようこそ。</p>
<p>科学は複数の段階からなる作業です：実験を計画し、データを収集したら、
そこから本当の楽しみが始まります！
このレッスンでは、R言語の基礎と、知っていると後々かなり楽になる科学的プロジェクトのためにコードを整える最適な方法をお教えます。</p>
<p>Microsoft Excel やGoogle
スプレッドシートを使用してデータを分析することも可能ですが、これらのツールは柔軟性とアクセス性に限界があります。
特に、生データの探索や変更を行うステップを共有するのが難しいため、<a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1003285" class="external-link">「再現可能」</a>な研究には不向きです。</p>
<p>そのため、このレッスンではR とRStudio
を使用してデータの探索を始める方法を学びます。 R
プログラムはWindows、Mac、Linux
のオペレーティングシステムで利用でき、無料で上記からダウンロード可能です。
R を実行するにはR プログラムだけで十分です。</p>
<p>ただし、R の使用をより簡単にするために、上記でダウンロードしたRStudio
を使用します。 RStudioは、無料であり、Rを組み込んだオープンソースの
総合開発環境（IDE: Integrated Development Environment）です。
RStudioは、全てのプラットフォーム（サーバーも含む）で起動できること、
エディタが組み込まれていることや、プロジェクト管理やバージョン管理にも対応しているなど、
良いところがいっぱいがあります。</p>
</section><section><h2 class="section-heading" id="概要">概要<a class="anchor" aria-label="anchor" href="#%E6%A6%82%E8%A6%81"></a>
</h2>
<hr class="half-width">
<p>生のデータから、予備解析をし、結果をどう
グラフ上にプロットするかを学びます。 ここでの例は <a href="https://www.gapminder.org" class="external-link">gapminder.org</a>
のデータセットを使います。このデータセットには、多くの国の人口の時系列データが入っています。
データをRに読み込むことができますか？
セネガルの人口をプロットできますか？
アジア大陸にある国の平均所得を計算できますか？
これらのレッスンの終わるまでに、これらの全ての国の人口をプロットしたりするようなことが
一分足らずでできるようになるでしょう！</p>
<p><strong>基本的なレイアウト</strong></p>
<p>最初にRStudioを開くと、３つのパネルが現れます：</p>
<ul>
<li>インタラクティブなRコンソール（左側全部）</li>
<li>環境／履歴（右上のタブ形式）</li>
<li>Files/Plots/Packages/Help/Viewer（右下のタブ形式）</li>
</ul>
<figure><img src="../fig/01-rstudio.png" alt="RStudioレイアウト" class="figure mx-auto d-block"></figure><p>Rスクリプトなどのファイルを開くと、左上にエディタパネルも開きます。</p>
<figure><img src="../fig/01-rstudio-script.png" alt=".R ファイルが開いてある状態のRStudio" class="figure mx-auto d-block"></figure><div id="r-スクリプト" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="r-スクリプト" class="callout-inner">
<h3 class="callout-title">R スクリプト</h3>
<div class="callout-content">
<p>R コンソールに書き込んだコマンドは、再度実行するために
ファイルに保存することができます。 このように実行される R
コードを含むファイルは R スクリプトと呼ばれます。 R スクリプトには
<code>.R</code> が名前の末尾にが付けられています。</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="rstudioでの作業の流れ">RStudioでの作業の流れ<a class="anchor" aria-label="anchor" href="#rstudio%E3%81%A7%E3%81%AE%E4%BD%9C%E6%A5%AD%E3%81%AE%E6%B5%81%E3%82%8C"></a>
</h2>
<hr class="half-width">
<p>RStudioで作業する２つの主な方法：</p>
<ol style="list-style-type: decimal">
<li>インタラクティブなRコンソールで試したり、確認したりした後、コードを.</li>
</ol>
<ul>
<li>まず始めてみるときや、小規模なテストをするのに適している。</li>
<li>すぐ面倒になる。</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>まず .R ファイルに書き、インタラクティブな R
コンソールへ、現在の行、選択した行、
修正した行など送るコマンドを走らせるために、RStudio
のショートカットキーを使う。</li>
</ol>
<ul>
<li>始めるのによい方法。全てのコードが後々のために保存される。</li>
<li>作ったファイルを、RStudioから又は<code>source()</code>関数を使って走らせることができる。</li>
</ul>
<div id="ヒントひとかたまりのコードを走らせる" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒントひとかたまりのコードを走らせる" class="callout-inner">
<h3 class="callout-title">ヒント：ひとかたまりのコードを走らせる</h3>
<div class="callout-content">
<p>RStudio には、エディタからコードを走らせる色々な方法があります。
ボタン、メニュー選択、そしてキーボードのショートカットがあります。
現在の行を走らせるには、</p>
<ol style="list-style-type: decimal">
<li>エディタパネルの<code>Run</code>のボタンをクリックする</li>
<li>「Code」メニューから「Run Lines」を選択する</li>
<li>WindowsかLinuxなら、<kbd>Ctrl</kbd>+<kbd>Return</kbd> 、またはOS
Xなら、<kbd>⌘</kbd>+<kbd>Return</kbd>
を押す（このショートカットはボタンの上にマウスを合わせると表示される）。
ードのかたまりを走らせるには、まずその部分を選択してから<code>Run</code>を押します。
もし、コードのかたまりを走らせた後で、その一部を修正した場合、
その部分を選択して <code>Run</code> する必要はありません。その場合は次の
<code>Re-run the previous region</code>
ボタンが使えます。これは、前のコードのかたまりを
修正を行った部分を含めて走らせます。 これは、前のコードのかたまりを
修正を行った部分を含めて走らせます。</li>
</ol>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="r入門">R入門<a class="anchor" aria-label="anchor" href="#r%E5%85%A5%E9%96%80"></a>
</h2>
<hr class="half-width">
<p>Rを使う時間のほとんどは、Rのインタラクティブコンソールでの作業となるでしょう。
ここが、全てのコードを走らせる、また、.Rファイルにコードを加える前にアイディアを
試してみるのに使える環境となります。
このRStudioのコンソールが、コマンドライン環境に<code>R</code>
と入力するのと同じ環境になります。</p>
<p>Rインタラクティブセッションでまず目に入ってくるのは、ひとかたまりの情報と
その後に続く、「 」と点滅するカーソルです。これは多くの観点で、
シェルのレッスンで学んだシェル環境と似ています。
つまり、「読み、実行し、出力するループ」の考えと同じように動くので、
コマンドを入力すれば、Rは、それを実行しようとし、そして結果を返すのです。</p>
</section><section><h2 class="section-heading" id="rを計算機としての使用">Rを計算機としての使用<a class="anchor" aria-label="anchor" href="#r%E3%82%92%E8%A8%88%E7%AE%97%E6%A9%9F%E3%81%A8%E3%81%97%E3%81%A6%E3%81%AE%E4%BD%BF%E7%94%A8"></a>
</h2>
<hr class="half-width">
<p>一番単純なRの使い方は、演算です：</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">+</span> <span class="fl">100</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 101</code></pre>
</div>
<p>And R will print out the answer, with a preceding “[1]”. [1] is the
index of the first element of the line being printed in the console. For
more information on indexing vectors, see <a href="https://swcarpentry.github.io/r-novice-gapminder/06-data-subsetting/index.html" class="external-link">Episode
6: Subsetting Data</a>.</p>
<p>バッシュのように、Rは、不完全なコマンドが入力されると、それが完成されるまで待ちます：
If you are familiar with Unix Shell’s bash, you may recognize this
behavior from bash.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">+</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>+</code></pre>
</div>
<p>Any time you hit return and the R session shows a “+” instead of a
“&gt;”, it means it’s waiting for you to complete the command. If you
want to cancel a command you can hit <kbd>Esc</kbd> and RStudio will
give you back the “&gt;” prompt.</p>
<div id="ヒントコマンドの取り消し" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒントコマンドの取り消し" class="callout-inner">
<h3 class="callout-title">ヒント：コマンドの取り消し</h3>
<div class="callout-content">
<p>RStudioではなく、コマンドラインからRを使う場合、
コマンドを取り消す場合、<kbd>Esc</kbd>の代わりに<kbd>Ctrl</kbd>+<kbd>C</kbd>を使う必要があります。これは、Macユーザーも同じです！
コマンドの取り消しは、不完全なコマンドを消す他にも使えます。</p>
<p>走っているコードを止めてとRに伝えるにも使え（例えば、予想よりも
かなり長くかかっている場合）、その他にも、今書いているコードを
消去するにも使えます。</p>
</div>
</div>
</div>
<p>Rを計算機として使う場合、演算の順番は、学校で学んだだろうものと
同じです。</p>
<p>一番先に行われる処理から一番後に行われる処理：</p>
<ul>
<li>括弧： <code>( )</code>
</li>
<li>累乗：<code>^</code>か<code>**</code>
</li>
<li>掛ける：<code>*</code>
</li>
<li>割る：<code>/</code>
</li>
<li>加える：<code>+</code>
</li>
<li>引く：<code>-</code>
</li>
</ul>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">3</span> <span class="op">+</span> <span class="fl">5</span> <span class="op">*</span> <span class="fl">2</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 13</code></pre>
</div>
<p>デフォルトと違う順番で計算させたい場合や、意図を明確にしたい場合は、
演算をまとめるために、括弧を使いましょう。</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="fl">3</span> <span class="op">+</span> <span class="fl">5</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 16</code></pre>
</div>
<p>括弧をつける必要ではないときは、面倒かもしれませんが、そうすることで自分の意図
するところがはっきり伝わります。
自分が書いたコードを、後々他の人が読むことになるかもしれないことを忘れないように。</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="fl">3</span> <span class="op">+</span> <span class="op">(</span><span class="fl">5</span> <span class="op">(</span><span class="fl">2</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># 読みづらい 3 + 5 2 ^ 2 # ルールを覚えている人には明確 3 + 5 (2 ^ 2) # ルールを忘れている人にも伝わるはず</span></span></code></pre>
</div>
<p>コードの後の文は、「コメント」と呼ばれます。
シャープ（ナンバー）記号<code>#</code>
の後に来るものは、Rがコードを実行する際は無視されます。</p>
<p>とても大きい、又は小さい数には、指数表記が使われます：</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">2</span><span class="op">/</span><span class="fl">10000</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2e-04</code></pre>
</div>
<p>Which is shorthand for “multiplied by <code>10^XX</code>”. So
<code>2e-4</code> is shorthand for <code>2 * 10^(-4)</code>.</p>
<p>数を指数記号で書くこともできます：</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">5e3</span> <span class="co"># マイナスがないことに注意</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 5000</code></pre>
</div>
</section><section><h2 class="section-heading" id="数学関数">数学関数<a class="anchor" aria-label="anchor" href="#%E6%95%B0%E5%AD%A6%E9%96%A2%E6%95%B0"></a>
</h2>
<hr class="half-width">
<p>R has many built in mathematical functions. To call a function, we
can type its name, followed by open and closing parentheses. Functions
take arguments as inputs, anything we type inside the parentheses of a
function is considered an argument. Depending on the function, the
number of arguments can vary from none to multiple. 例えば：</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">getwd</span><span class="op">(</span><span class="op">)</span> <span class="co">#returns an absolute filepath</span></span></code></pre>
</div>
<p>doesn’t require an argument, whereas for the next set of mathematical
functions we will need to supply the function a value in order to
compute the result.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sin</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="co"># 三角関数</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.841471</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">log</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="co"># 自然対数</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">log10</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="co"># 10を底とする対数</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">exp</span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span> <span class="co"># e^(1/2)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1.648721</code></pre>
</div>
<p>Googleで検索すればいいですし、関数の始まりさえ覚えていれば
RStudioのタブ入力補完機能が使えます。</p>
<p>これがRStudioが、Rそのものを使うよりもいい理由のひとつです。
RStudioには、自動補完機能があり、関数、その引数、その取りうる値を
より簡単に見つけることができます。</p>
<p>コマンド名の前に、<code>?</code>
を付けることで、そのコマンドのヘルプのページを開くことができます。 When
using RStudio, this will open the ‘Help’ pane; if using R in the
terminal, the help page will open in your browser. The help page will
include a detailed description of the command and how it works.
Scrolling to the bottom of the help page will usually show a collection
of code examples which illustrate command usage.
これについては、後ほど、例で見てみることにしましょう。</p>
</section><section><h2 class="section-heading" id="何かを比較する">何かを比較する<a class="anchor" aria-label="anchor" href="#%E4%BD%95%E3%81%8B%E3%82%92%E6%AF%94%E8%BC%83%E3%81%99%E3%82%8B"></a>
</h2>
<hr class="half-width">
<p>Rを使って比較をすることもできます：</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">~</span><span class="op">~</span><span class="op">~</span> <span class="fl">1</span> <span class="op">==</span> <span class="fl">1</span> <span class="co"># 等価（イコールが２つあることに注意。「は、～と等しい」と読む） ~~~</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="op">~</span><span class="op">~</span><span class="op">~</span><span class="fl">1</span> <span class="op">==</span> <span class="fl">1</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">~</span><span class="op">~</span><span class="op">~</span> <span class="fl">1</span> <span class="op">!=</span> <span class="fl">2</span> <span class="co"># 不等価（「は、～と等しくない」と読む） ~~~</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="op">~</span><span class="op">~</span><span class="op">~</span><span class="fl">1</span> <span class="op">!=</span> <span class="fl">2</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">&lt;</span> <span class="fl">2</span> <span class="co"># より少ない</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] TRUE</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">&lt;=</span> <span class="fl">1</span> <span class="co"># より少ない、又は等しい</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] TRUE</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="dv">1</span> <span class="dv">0</span> <span class="co"># より大きい</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in parse(text = input): &lt;text&gt;:1:3: unexpected numeric constant
1: 1 0
      ^</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">=</span> <span class="op">-</span><span class="fl">9</span> <span class="co"># より大きい、又は等しい</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in 1 = -9: invalid (do_set) left-hand side to assignment</code></pre>
</div>
<div id="ヒント-数の比較" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント-数の比較" class="callout-inner">
<h3 class="callout-title">##ヒント： 数の比較</h3>
<div class="callout-content">
<p>A word of warning about comparing numbers: you should never use
<code>==</code> to compare two numbers unless they are integers (a data
type which can specifically represent only whole numbers).</p>
<p>Computers may only represent decimal numbers with a certain degree of
precision, so two numbers which look the same when printed out by R, may
actually have different underlying representations and therefore be
different by a small margin of error (called Machine numeric
tolerance).</p>
<p>Instead you should use the <code>all.equal</code> function.</p>
<p>Further reading: <a href="https://floating-point-gui.de/" class="external-link">http://floating-point-gui.de/</a></p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="変数及び代入">変数及び代入<a class="anchor" aria-label="anchor" href="#%E5%A4%89%E6%95%B0%E5%8F%8A%E3%81%B3%E4%BB%A3%E5%85%A5"></a>
</h2>
<hr class="half-width">
<p>代入演算子<code>&lt;-</code>を用いて、次のように値を変数に入れることができます：</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">40</span></span></code></pre>
</div>
<p>Notice that assignment does not print a value. Instead, we stored it
for later in something called a <strong>variable</strong>.
<code>x</code> now contains the <strong>value</strong>
<code>0.025</code>:</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.025</code></pre>
</div>
<p>より正確には、記録された値は、<a href="https://en.wikipedia.org/wiki/Floating_point" class="external-link">浮動小数点数</a>
と呼ばれる 小数近似 (decimal approximation) です。</p>
<p>Look for the <code>Environment</code> tab in the top right panel of
RStudio, and you will see that <code>x</code> and its value have
appeared. Our variable <code>x</code> can be used in place of a number
in any calculation that expects a number:</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">log</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] -3.688879</code></pre>
</div>
<p>変数は、再度、代入することもできます：</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></code></pre>
</div>
<p><code>x</code>は、0.025という値でしたが、今は、100になりました。</p>
<p>代入する値は、既に代入されている変数でもいいです：</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="fl">1</span> <span class="co">#RStudioが、右上のタブにあるxの詳細をどう更新したかにも御留意下さい y &lt;- x 2</span></span></code></pre>
</div>
<p>代入の右側については、Rで使える表現であれば何でも大丈夫です。
右側については、代入される前に、 計算が完全に実施 されます。</p>
<p>変数名には、文字、数字、下線、ピリオドを含むことができます。 They
must start with a letter or a period followed by a letter (they cannot
start with a number nor an underscore). Variables beginning with a
period are hidden variables. 長い変数名のつけ方は様々です。例えば、</p>
<ul>
<li>ピリオドを.単語の.間に入れる</li>
<li>下線を\_単語の_間に入れる</li>
<li>単語の始まりを大文字にする（camelCaseToSeparateWords）</li>
</ul>
<p>何を使うかは書き手次第ですが、 一貫性を持たせる
ようにしましょう。</p>
<p>代入の演算子として、<code>=</code>を使うこともできます：</p>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">40</span></span></code></pre>
</div>
<p>But this is much less common among R users. The most important thing
is to <strong>be consistent</strong> with the operator you use. There
are occasionally places where it is less confusing to use
<code>&lt;-</code> than <code>=</code>, and it is the most common symbol
used in the community. So the recommendation is to use
<code>&lt;-</code>.</p>
<div id="チャレンジ１" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ１" class="callout-inner">
<h3 class="callout-title">チャレンジ１</h3>
<div class="callout-content">
<p>次のうちどれがRの変数名として使えますか？</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a>min_height</span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a>max.height</span>
<span id="cb43-3"><a href="#cb43-3" tabindex="-1"></a>_age</span>
<span id="cb43-4"><a href="#cb43-4" tabindex="-1"></a>.mass</span>
<span id="cb43-5"><a href="#cb43-5" tabindex="-1"></a>MaxLength</span>
<span id="cb43-6"><a href="#cb43-6" tabindex="-1"></a>min<span class="sc">-</span>length</span>
<span id="cb43-7"><a href="#cb43-7" tabindex="-1"></a><span class="dv">2</span>widths</span>
<span id="cb43-8"><a href="#cb43-8" tabindex="-1"></a>celsius2kelvin</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> チャレンジ８の解答 1 </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>The following can be used as R variables:</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">min_height</span></span>
<span><span class="va">max.height</span></span>
<span><span class="va">MaxLength</span></span>
<span><span class="va">celsius2kelvin</span></span></code></pre>
</div>
<p>The following creates a hidden variable:</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">.mass</span></span></code></pre>
</div>
<p>The following will not be able to be used to create a variable</p>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a>_age</span>
<span id="cb46-2"><a href="#cb46-2" tabindex="-1"></a>min<span class="sc">-</span>length</span>
<span id="cb46-3"><a href="#cb46-3" tabindex="-1"></a><span class="dv">2</span>widths</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="ベクトル化">ベクトル化<a class="anchor" aria-label="anchor" href="#%E3%83%99%E3%82%AF%E3%83%88%E3%83%AB%E5%8C%96"></a>
</h2>
<hr class="half-width">
<p>One final thing to be aware of is that R is <em>vectorized</em>,
meaning that variables and functions can have vectors as values. In
contrast to physics and mathematics, a vector in R describes a set of
values in a certain order of the same data type. 例えば：</p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1 2 3 4 5</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">2</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1]  2  4  8 16 32</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span></span>
<span><span class="fl">2</span><span class="op">^</span><span class="va">x</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1]  2  4  8 16 32</code></pre>
</div>
<p>これは、とても使えるのですが、詳しくは後続のレッスンで述べることにします。</p>
</section><section><h2 class="section-heading" id="環境を管理する">環境を管理する<a class="anchor" aria-label="anchor" href="#%E7%92%B0%E5%A2%83%E3%82%92%E7%AE%A1%E7%90%86%E3%81%99%E3%82%8B"></a>
</h2>
<hr class="half-width">
<p>Rセッションで使えるコマンドがいくつかあります。</p>
<p><code>ls</code>は、グローバル環境（作業中のRセッション）にある全ての変数と関数をリスト化します：</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ls</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error: object 'y' not found</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "x"</code></pre>
</div>
<div id="ヒント隠れたオブジェクト" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント隠れたオブジェクト" class="callout-inner">
<h3 class="callout-title">ヒント：隠れたオブジェクト</h3>
<div class="callout-content">
<p>シェルのように、<code>ls</code>はデフォルトでは、“.”で始まる変数と関数を表示しません。
全てのオブジェクトをリスト化するには、代わりに<code>ls(all.names=TRUE)</code>と書きます</p>
</div>
</div>
</div>
<p>ここでは、<code>ls</code>に特に引数を与えませんでしたが、それでもRに関数を
呼び出していることを伝えるために括弧は必要です。</p>
<p>If we type <code>ls</code> by itself, R prints a bunch of code
instead of a listing of objects.</p>
<div class="codewrapper sourceCode" id="cb56">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ls</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>function (name, pos = -1L, envir = as.environment(pos), all.names = FALSE,
    pattern, sorted = TRUE)
{
    if (!missing(name)) {
        pos &lt;- tryCatch(name, error = function(e) e)
        if (inherits(pos, "error")) {
            name &lt;- substitute(name)
            if (!is.character(name))
                name &lt;- deparse(name)
            warning(gettextf("%s converted to character string",
                sQuote(name)), domain = NA)
            pos &lt;- name
        }
    }
    all.names &lt;- .Internal(ls(envir, all.names, sorted))
    if (!missing(pattern)) {
        if ((ll &lt;- length(grep("[", pattern, fixed = TRUE))) &amp;&amp;
            ll != length(grep("]", pattern, fixed = TRUE))) {
            if (pattern == "[") {
                pattern &lt;- "\\["
                warning("replaced regular expression pattern '[' by  '\\\\['")
            }
            else if (length(grep("[^\\\\]\\[&lt;-", pattern))) {
                pattern &lt;- sub("\\[&lt;-", "\\\\\\[&lt;-", pattern)
                warning("replaced '[&lt;-' by '\\\\[&lt;-' in regular expression pattern")
            }
        }
        grep(pattern, all.names, value = TRUE)
    }
    else all.names
}
&lt;bytecode: 0x558c4bfdbdd0&gt;
&lt;environment: namespace:base&gt;</code></pre>
</div>
<p>What’s going on here?</p>
<p>Like everything in R, <code>ls</code> is the name of an object, and
entering the name of an object by itself prints the contents of the
object. The object <code>x</code> that we created earlier contains 1, 2,
3, 4, 5:</p>
<div class="codewrapper sourceCode" id="cb58">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1 2 3 4 5</code></pre>
</div>
<p>The object <code>ls</code> contains the R code that makes the
<code>ls</code> function work! We’ll talk more about how functions work
and start writing our own later.</p>
<p>もう必要ないオブジェクトを消去するには、<code>rm</code>が使えます：</p>
<div class="codewrapper sourceCode" id="cb60">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rm</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre>
</div>
<p>もし、環境に、色々なものがいっぱいあって、それらを全て消去したい場合、
<code>ls</code>の結果を<code>rm</code>関数に渡すことで対応できます。：</p>
<div class="codewrapper sourceCode" id="cb61">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rm</span><span class="op">(</span>list <span class="op">=</span> <span class="fu">ls</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>In this case we’ve combined the two.
ここでは、二つを組み合わせました。演算の順番のように、一番内側の括弧の中のものが、
まず最初に実行され、実行が続きます。</p>
<p>ここでは、<code>ls</code>の結果を<code>rm</code>の引数のリストとして用いるべしと設定しました。
名前で引数の値を定めるときは、演算子<code>=</code>を 必ず
使わなければなりません！</p>
<p>もし代わりに<code>&lt;-</code>を使うと、意図しない副作用が現れるか、エラーメッセージが現れます：</p>
<div class="codewrapper sourceCode" id="cb62">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rm</span><span class="op">(</span><span class="va">list</span> <span class="op">&lt;-</span> <span class="fu">ls</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in rm(list &lt;- ls()): ... must contain names or character strings</code></pre>
</div>
<div id="ヒント警告かエラーか" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント警告かエラーか" class="callout-inner">
<h3 class="callout-title">ヒント：警告かエラーか</h3>
<div class="callout-content">
<p>Pay attention when R does something unexpected! Errors, like above,
are thrown when R cannot proceed with a calculation. Warnings on the
other hand usually mean that the function has run, but it probably
hasn’t worked as expected.</p>
<p>In both cases, the message that R prints out usually give you clues
how to fix a problem.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="rパッケージ">Rパッケージ<a class="anchor" aria-label="anchor" href="#r%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8"></a>
</h2>
<hr class="half-width">
<p>It is possible to add functions to R by writing a package, or by
obtaining a package written by someone else. As of this writing, there
are over 10,000 packages available on CRAN (the comprehensive R archive
network). R and RStudio have functionality for managing packages:</p>
<ul>
<li>インストールされているパッケージを以下を入力することで見ることができます。</li>
<li>You can install packages by typing
<code>install.packages("packagename")</code>, where
<code>packagename</code> is the package name, in quotes.</li>
<li>You can update installed packages by typing
<code>update.packages()</code>
</li>
<li>You can remove a package with
<code>remove.packages("packagename")</code>
</li>
<li>You can make a package available for use with
<code>library(packagename)</code>
</li>
</ul>
<p>Packages can also be viewed, loaded, and detached in the Packages tab
of the lower right panel in RStudio. Clicking on this tab will display
all of the installed packages with a checkbox next to them. If the box
next to a package name is checked, the package is loaded and if it is
empty, the package is not loaded. Click an empty box to load that
package and click a checked box to detach that package.</p>
<p>Packages can be installed and updated from the Package tab with the
Install and Update buttons at the top of the tab.</p>
<div id="チャレンジ２" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ２" class="callout-inner">
<h3 class="callout-title">チャレンジ２</h3>
<div class="callout-content">
<p>次のプログラムのそれぞれの宣言の後、それぞれの変数の値は
何になるでしょうか？</p>
<div class="codewrapper sourceCode" id="cb64">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mass</span> <span class="op">&lt;-</span> <span class="fl">47.5</span></span>
<span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fl">122</span></span>
<span><span class="va">mass</span> <span class="op">&lt;-</span> <span class="va">mass</span> <span class="op">*</span> <span class="fl">2.3</span></span>
<span><span class="va">age</span> <span class="op">&lt;-</span> <span class="va">age</span> <span class="op">-</span> <span class="fl">20</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> チャレンジ８の解答 </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb65">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mass</span> <span class="op">&lt;-</span> <span class="fl">47.5</span></span></code></pre>
</div>
<p>This will give a value of 47.5 for the variable mass</p>
<div class="codewrapper sourceCode" id="cb66">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fl">122</span></span></code></pre>
</div>
<p>This will give a value of 122 for the variable age</p>
<div class="codewrapper sourceCode" id="cb67">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mass</span> <span class="op">&lt;-</span> <span class="va">mass</span> <span class="op">*</span> <span class="fl">2.3</span></span></code></pre>
</div>
<p>This will multiply the existing value of 47.5 by 2.3 to give a new
value of 109.25 to the variable mass.</p>
<div class="codewrapper sourceCode" id="cb68">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age</span> <span class="op">&lt;-</span> <span class="va">age</span> <span class="op">-</span> <span class="fl">20</span></span></code></pre>
</div>
<p>This will subtract 20 from the existing value of 122 to give a new
value of 102 to the variable age.</p>
</div>
</div>
</div>
</div>
<div id="チャレンジ３" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ３" class="callout-inner">
<h3 class="callout-title">チャレンジ３</h3>
<div class="callout-content">
<p>チャレンジ２のコードを走らせ、massとageを比較するコマンドを書いて下さい。
massはageよりも大きいでしょうか？</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> チャレンジ３の解答 </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>One way of answering this question in R is to use the
<code>&gt;</code> to set up the following:</p>
<div class="codewrapper sourceCode" id="cb69">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mass</span> <span class="op">&gt;</span> <span class="va">age</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] TRUE</code></pre>
</div>
<p>This should yield a boolean value of TRUE since 109.25 is greater
than 102.</p>
</div>
</div>
</div>
</div>
<div id="チャレンジ４" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ４" class="callout-inner">
<h3 class="callout-title">チャレンジ４</h3>
<div class="callout-content">
<p>Clean up your working environment by deleting the mass and age
variables.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> チャレンジ８の解答 </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>We can use the <code>rm</code> command to accomplish this task</p>
<div class="codewrapper sourceCode" id="cb71">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rm</span><span class="op">(</span><span class="va">age</span>, <span class="va">mass</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="チャレンジ５" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ５" class="callout-inner">
<h3 class="callout-title">チャレンジ５</h3>
<div class="callout-content">
<p>Install the following packages: <code>ggplot2</code>,
<code>plyr</code>, <code>gapminder</code></p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> チャレンジ８の解答 </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<p>We can use the <code>install.packages()</code> command to install the
required packages.</p>
<div class="codewrapper sourceCode" id="cb72">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span></span>
<span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"plyr"</span><span class="op">)</span></span>
<span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"gapminder"</span><span class="op">)</span></span></code></pre>
</div>
<p>An alternate solution, to install multiple packages with a single
<code>install.packages()</code> command is:</p>
<div class="codewrapper sourceCode" id="cb73">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="st">"ggplot2"</span>, <span class="st">"plyr"</span>, <span class="st">"gapminder"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> インストラクター用メモ </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor1" aria-labelledby="headingInstructor1">
<div class="accordion-body">
<p>When installing ggplot2, it may be required for some users to use the
dependencies flag as a result of lazy loading affecting the install.
This suggestion is not tied to any known bug discussion, and is advised
based off instructor feedback/experience in resolving stochastic
occurences of errors identified through delivery of this workshop:</p>
<div class="codewrapper sourceCode" id="cb74">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"ggplot2"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">まとめ</h3>
<div class="callout-content">
<ul>
<li>Use RStudio to write and run R programs.</li>
<li>R has the usual arithmetic operators and mathematical
functions.</li>
<li>Use <code>&lt;-</code> to assign values to variables.</li>
<li>Use <code>ls()</code> to list the variables in a program.</li>
<li>Use <code>rm()</code> to delete objects in a program.</li>
<li>Use <code>install.packages()</code> to install packages
(libraries).</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-02-project-intro"><p>Content from <a href="02-project-intro.html">Project Management With RStudio</a></p>
<hr>
<p>最終更新日：2024-10-12 |

        <a href="https://github.com/swcarpentry-ja/r-novice-gapminder/edit/main/episodes/02-project-intro.Rmd" class="external-link">ページの編集 <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>所要時間：<i aria-hidden="true" data-feather="clock"></i> 30分</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="回答を全て表示する " data-collapse="回答を全て折りたたむ "> 回答を全て表示する <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">概要</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">質問</h3>
<ul>
<li>How can I manage my projects in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">目的</h3>
<ul>
<li>Create self-contained projects in RStudio</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="はじめに">はじめに<a class="anchor" aria-label="anchor" href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"></a>
</h2>
<hr class="half-width">
<p>科学的なプロセスは、徐々に進んでいくものです。プロジェクトの多くは、
計画性のないメモやいくつかのコードから始まります。そして、原案ができ、
最終的に、全てが少しづつ混ざり合ってまとまっていくのです。</p>
<blockquote class="twitter-tweet">
<p>
Managing your projects in a reproducible fashion doesn’t just make your
science reproducible, it makes your life easier.
</p>
— Vince Buffalo (<span class="citation">@vsbuffalo</span>)
<a href="https://twitter.com/vsbuffalo/status/323638476153167872" class="external-link">April
15, 2013</a>
</blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script><p>大抵の人達は、次のようにプロジェクトを整理する傾向にあります：</p>
<figure><img src="../fig/bad_layout.png" alt="Screenshot of file manager demonstrating bad project organisation" class="figure mx-auto d-block"></figure><p>このようなことを 絶対 避けるべき理由はいくつもあります：</p>
<ol style="list-style-type: decimal">
<li>It is really hard to tell which version of your data is the original
and which is the modified;</li>
<li>It gets really messy because it mixes files with various extensions
together;</li>
<li>It probably takes you a lot of time to actually find things, and
relate the correct figures to the exact code that has been used to
generate it;</li>
</ol>
<p>プロジェクトのレイアウトが良ければ、最終的に自分が楽になる</p>
<ul>
<li>自分のデータの整合性を保つ助けになる</li>
<li>It makes it simpler to share your code with someone else (a
lab-mate, collaborator, or supervisor);</li>
<li>It allows you to easily upload your code with your manuscript
submission;</li>
<li>It makes it easier to pick the project back up after a break.</li>
</ul></section><section><h2 class="section-heading" id="考えられる解決策">考えられる解決策<a class="anchor" aria-label="anchor" href="#%E8%80%83%E3%81%88%E3%82%89%E3%82%8C%E3%82%8B%E8%A7%A3%E6%B1%BA%E7%AD%96"></a>
</h2>
<hr class="half-width">
<p>幸いなことに、効果的な作業管理を助けるツールやパッケージがあります</p>
<p>RStudioの最も有能て使えるもののひとつとして、プロジェクト管理機能が挙げられます。
今日では、必要なものが揃い、再現可能なプロジェクトを作成するために、これが使われているのでしょう。</p>
<div id="チャレンジ必要なものが揃ったプロジェクトを作成する" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="チャレンジ必要なものが揃ったプロジェクトを作成する" class="callout-inner">
<h3 class="callout-title">チャレンジ：必要なものが揃ったプロジェクトを作成する</h3>
<div class="callout-content">
<p>We’re going to create a new project in RStudio:</p>
<ol style="list-style-type: decimal">
<li>Click the “File” menu button, then “New Project”.</li>
<li>Click “New Directory”.</li>
<li>Click “New Project”.</li>
<li>Type in the name of the directory to store your project,
e.g. “my_project”.</li>
<li>If available, select the checkbox for “Create a git
repository.”</li>
<li>Click the “Create Project” button.</li>
</ol>
</div>
</div>
</div>
<p>The simplest way to open an RStudio project once it has been created
is to click through your file system to get to the directory where it
was saved and double click on the <code>.Rproj</code> file. This will
open RStudio and start your R session in the same directory as the
<code>.Rproj</code> file. All your data, plots and scripts will now be
relative to the project directory. RStudio projects have the added
benefit of allowing you to open multiple projects at the same time each
open to its own project directory. This allows you to keep multiple
projects open without them interfering with each other.</p>
<div id="challenge-2-opening-an-rstudio-project-through-the-file-system" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="challenge-2-opening-an-rstudio-project-through-the-file-system" class="callout-inner">
<h3 class="callout-title">Challenge 2: Opening an RStudio project through the file system</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>Exit RStudio.</li>
<li>Navigate to the directory where you created a project in Challenge
1.</li>
<li>Double click on the <code>.Rproj</code> file in that directory.</li>
</ol>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="プロジェクト管理の最適なやり方">プロジェクト管理の最適なやり方<a class="anchor" aria-label="anchor" href="#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E7%AE%A1%E7%90%86%E3%81%AE%E6%9C%80%E9%81%A9%E3%81%AA%E3%82%84%E3%82%8A%E6%96%B9"></a>
</h2>
<hr class="half-width">
<p>プロジェクトのレイアウトに「最適」な方法はありませんが、これを守れば、
プロジェクト管理が簡単になるだろうという一般的な原則がいくつかあります：</p>
<div class="section level3">
<h3 id="データは読み込み専用にしましょう">データは読み込み専用にしましょう<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AF%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF%E5%B0%82%E7%94%A8%E3%81%AB%E3%81%97%E3%81%BE%E3%81%97%E3%82%87%E3%81%86"></a>
</h3>
<p>プロジェクトを始めるにあたって、これが多分一番重要なゴールかもしれません。
データ収集には、多くの時間と費用のいずれか、または両方が掛かることが多いものです。
データの修正も行える形で読込みも書込みもできる作業（例えば、エクセル）をすると、
データがどこからきたか、または収集されてからどう修正されてきたかが分からなくなります。
ですから、データは「読み込むだけ」のものと扱うのがよいというわけです。</p>
</div>
<div class="section level3">
<h3 id="データクリーニング">データクリーニング<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0"></a>
</h3>
<p>多くの場合、データは「汚れて」います：
R（または、他のプログラミング言語）が使える形にするためには、かなりの前処理が必要となるでしょう。
この作業は、「データ・マンジング」と呼ばれることもあります。 Storing
these scripts in a separate folder, and creating a second “read-only”
data folder to hold the “cleaned” data sets can prevent confusion
between the two sets.</p>
</div>
<div class="section level3">
<h3 id="生成されたアウトプットを捨てても良いようにしましょう">生成されたアウトプットを捨てても良いようにしましょう<a class="anchor" aria-label="anchor" href="#%E7%94%9F%E6%88%90%E3%81%95%E3%82%8C%E3%81%9F%E3%82%A2%E3%82%A6%E3%83%88%E3%83%97%E3%83%83%E3%83%88%E3%82%92%E6%8D%A8%E3%81%A6%E3%81%A6%E3%82%82%E8%89%AF%E3%81%84%E3%82%88%E3%81%86%E3%81%AB%E3%81%97%E3%81%BE%E3%81%97%E3%82%87%E3%81%86"></a>
</h3>
<p>書いたものから生成されたものは、全て捨てても良いものにしましょう。
つまり、書いたものから生成できるようにしましょう。</p>
<p>There are lots of different ways to manage this output. Having an
output folder with different sub-directories for each separate analysis
makes it easier later. Since many analyses are exploratory and don’t end
up being used in the final project, and some of the analyses get shared
between projects.</p>
<div id="ヒント科学的演算の良いと言えるやり方" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント科学的演算の良いと言えるやり方" class="callout-inner">
<h3 class="callout-title">ヒント：科学的演算の良いと言えるやり方</h3>
<div class="callout-content">
<p><a href="https://github.com/swcarpentry/good-enough-practices-in-scientific-computing/blob/gh-pages/good-enough-practices-for-scientific-computing.pdf" class="external-link">Good
Enough Practices for Scientific Computing</a> gives the following
recommendations for project organization:</p>
<ol style="list-style-type: decimal">
<li>Put each project in its own directory, which is named after the
project.</li>
<li>Put text documents associated with the project in the
<code>doc</code> directory.</li>
<li>Put raw data and metadata in the <code>data</code> directory, and
files generated during cleanup and analysis in a <code>results</code>
directory.</li>
<li>Put source for the project’s scripts and programs in the
<code>src</code> directory, and programs brought in from elsewhere or
compiled locally in the <code>bin</code> directory.</li>
<li>Name all files to reflect their content or function.</li>
</ol>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="関数定義と適用は別々にしましょう">関数定義と適用は別々にしましょう<a class="anchor" aria-label="anchor" href="#%E9%96%A2%E6%95%B0%E5%AE%9A%E7%BE%A9%E3%81%A8%E9%81%A9%E7%94%A8%E3%81%AF%E5%88%A5%E3%80%85%E3%81%AB%E3%81%97%E3%81%BE%E3%81%97%E3%82%87%E3%81%86"></a>
</h3>
<p>Rで作業するより効果的な方法のひとつは、まず走らせたいコードを直接.Rスクリプトに書き、それから選択した行をインタラクティブなRコンソールで（RStudioのショートカットキーを使うか、「Run」ボタンをクリックして）走らせることです。</p>
<p>プロジェクトの初期段階では、最初の.Rスクリプトファイルには直接実行されるコードの行が多数あるものです。
プロジェクトが進むにつれて、何度も使える部分は、独自の関数としてまとめられます。
これらの関数を、色々なプロジェクトや分析で使える関数を保存するフォルダと、この分析のスクリプトを保存するフォルダの２つの異なるフォルダに分けるとよいでしょう。</p>
</div>
<div class="section level3">
<h3 id="データディレクトリにデータを保存しましょう">データディレクトリにデータを保存しましょう<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%AB%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E4%BF%9D%E5%AD%98%E3%81%97%E3%81%BE%E3%81%97%E3%82%87%E3%81%86"></a>
</h3>
<p>よいディレクトリ構造ができた後は、データファイルを <code>data/</code>
ディレクトリに置く、または保管しましょう。</p>
<div id="チャレンジ３" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="チャレンジ３" class="callout-inner">
<h3 class="callout-title">チャレンジ３</h3>
<div class="callout-content">
<p>Download the gapminder data from <a href="../data/gapminder_data.csv">this link to a csv file</a>.</p>
<ol style="list-style-type: decimal">
<li>Download the file (right mouse click on the link above -&gt; “Save
link as” / “Save file as”, or click on the link and after the page
loads, press <kbd>Ctrl</kbd>+<kbd>S</kbd> or choose File -&gt; “Save
page as”)</li>
<li>Make sure it’s saved under the name
<code>gapminder_data.csv</code>
</li>
<li>Save the file in the <code>data/</code> folder within your
project.</li>
</ol>
<p>We will load and inspect these data later.</p>
</div>
</div>
</div>
<div id="チャレンジ４" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ４" class="callout-inner">
<h3 class="callout-title">チャレンジ４</h3>
<div class="callout-content">
<p>It is useful to get some general idea about the dataset, directly
from the command line, before loading it into R. Understanding the
dataset better will come in handy when making decisions on how to load
it in R. Use the command-line shell to answer the following
questions:</p>
<ol style="list-style-type: decimal">
<li>ファイルのサイズは何ですか？</li>
<li>データは何列入っていますか？</li>
<li>ファイルには、どのような値が保存されていますか？</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>By running these commands in the shell:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-lh</span> data/gapminder_data.csv</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>-rw-r--r-- 1 runner docker 80K Oct 12 02:35 data/gapminder_data.csv</code></pre>
</div>
<p>The file size is 80K.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">wc</span> <span class="at">-l</span> data/gapminder_data.csv</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>1705 data/gapminder_data.csv</code></pre>
</div>
<p>There are 1705 lines. The data looks like:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">head</span> data/gapminder_data.csv</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>country,year,pop,continent,lifeExp,gdpPercap
Afghanistan,1952,8425333,Asia,28.801,779.4453145
Afghanistan,1957,9240934,Asia,30.332,820.8530296
Afghanistan,1962,10267083,Asia,31.997,853.10071
Afghanistan,1967,11537966,Asia,34.02,836.1971382
Afghanistan,1972,13079460,Asia,36.088,739.9811058
Afghanistan,1977,14880372,Asia,38.438,786.11336
Afghanistan,1982,12881816,Asia,39.854,978.0114388
Afghanistan,1987,13867957,Asia,40.822,852.3959448
Afghanistan,1992,16317921,Asia,41.674,649.3413952</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="ヒントr-studioのコマンドライン" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒントr-studioのコマンドライン" class="callout-inner">
<h3 class="callout-title">ヒント：R Studioのコマンドライン</h3>
<div class="callout-content">
<p>The Terminal tab in the console pane provides a convenient place
directly within RStudio to interact directly with the command line.</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="working-directory">Working directory<a class="anchor" aria-label="anchor" href="#working-directory"></a>
</h3>
<p>Knowing R’s current working directory is important because when you
need to access other files (for example, to import a data file), R will
look for them relative to the current working directory.</p>
<p>Each time you create a new RStudio Project, it will create a new
directory for that project. When you open an existing
<code>.Rproj</code> file, it will open that project and set R’s working
directory to the folder that file is in.</p>
<div id="チャレンジ５" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="チャレンジ５" class="callout-inner">
<h3 class="callout-title">チャレンジ５</h3>
<div class="callout-content">
<p>You can check the current working directory with the
<code>getwd()</code> command, or by using the menus in RStudio.</p>
<ol style="list-style-type: decimal">
<li>In the console, type <code>getwd()</code> (“wd” is short for
“working directory”) and hit Enter.</li>
<li>In the Files pane, double click on the <code>data</code> folder to
open it (or navigate to any other folder you wish). To get the Files
pane back to the current working directory, click “More” and then select
“Go To Working Directory”.</li>
</ol>
<p>You can change the working directory with <code>setwd()</code>, or by
using RStudio menus.</p>
<ol style="list-style-type: decimal">
<li>In the console, type <code>setwd("data")</code> and hit Enter. Type
<code>getwd()</code> and hit Enter to see the new working
directory.</li>
<li>In the menus at the top of the RStudio window, click the “Session”
menu button, and then select “Set Working Directory” and then “Choose
Directory”. Next, in the windows navigator that opens, navigate back to
the project directory, and click “Open”. Note that a <code>setwd</code>
command will automatically appear in the console.</li>
</ol>
</div>
</div>
</div>
<div id="tip-file-does-not-exist-errors" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-file-does-not-exist-errors" class="callout-inner">
<h3 class="callout-title">Tip: File does not exist errors</h3>
<div class="callout-content">
<p>When you’re attempting to reference a file in your R code and you’re
getting errors saying the file doesn’t exist, it’s a good idea to check
your working directory. You need to either provide an absolute path to
the file, or you need to make sure the file is saved in the working
directory (or a subfolder of the working directory) and provide a
relative path.</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="バージョンコントロール">バージョン・コントロール<a class="anchor" aria-label="anchor" href="#%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB"></a>
</h3>
<p>プロジェクトでは、バージョン・コントロールを使うことが重要です。 <a href="https://swcarpentry.github.io/git-novice/14-supplemental-rstudio.html/" class="external-link">RStudioでGitを使う良いレッスン</a>を参照して下さい。</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">まとめ</h3>
<div class="callout-content">
<ul>
<li>Use RStudio to create and manage projects with consistent
layout.</li>
<li>データは読み込み専用にしましょう.</li>
<li>生成されたアウトプットを捨てても良いようにしましょう.</li>
<li>関数定義と適用は別々にしましょう.</li>
</ul>
</div>
</div>
</div>
</div>
</section></section><section id="aio-03-seeking-help"><p>Content from <a href="03-seeking-help.html">Seeking Help</a></p>
<hr>
<p>最終更新日：2024-10-12 |

        <a href="https://github.com/swcarpentry-ja/r-novice-gapminder/edit/main/episodes/03-seeking-help.Rmd" class="external-link">ページの編集 <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>所要時間：<i aria-hidden="true" data-feather="clock"></i> 20分</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="回答を全て表示する " data-collapse="回答を全て折りたたむ "> 回答を全て表示する <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">概要</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">質問</h3>
<ul>
<li>How can I get help in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">目的</h3>
<ul>
<li>To be able to read R help files for functions and special
operators.</li>
<li>To be able to use CRAN task views to identify packages to solve a
problem.</li>
<li>To be able to seek help from your peers.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="ヘルプファイルを読む">ヘルプファイルを読む<a class="anchor" aria-label="anchor" href="#%E3%83%98%E3%83%AB%E3%83%97%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E8%AA%AD%E3%82%80"></a>
</h2>
<hr class="half-width">
<p>R、そしてその他のパッケージには、関数のヘルプファイルが用意されています。
一般的な関数のヘルプを検索する構文は、（インタラクティブなRセッションで）自分の名前空間に読み込まれた
パッケージに存在する特定の関数名、「function_name」を以下のように使って下さい：</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">function_name</span></span>
<span><span class="fu">help</span><span class="op">(</span><span class="va">function_name</span><span class="op">)</span></span></code></pre>
</div>
<p>For example take a look at the help file for
<code>write.table()</code>, we will be using a similar function in an
upcoming episode.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="fu">write.table</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>これで、RStudioにヘルプページ（Rの場合は、画面に簡素なテキスト）が表示されます</p>
<p>それぞれのヘルプページは、セクションに分けられます：</p>
<ul>
<li><ul>
<li>Description（説明）：関数がすることの詳しい説明</li>
</ul></li>
<li><ul>
<li>Usage（使い方）：関数の引数及びデフォルトの値</li>
</ul></li>
<li><ul>
<li>Arguments（引数）：それぞれの引数が取りうるデータの説明</li>
</ul></li>
<li><ul>
<li>Details（詳細）：気を付けるべき重要な詳細</li>
</ul></li>
<li><ul>
<li>Value（値）：関数が返すデータ</li>
</ul></li>
<li><ul>
<li>See Also（ついでにこっちも）：他に役立ちそうな関連する関数</li>
</ul></li>
<li><ul>
<li>Examples（例）：関数の使い方の例</li>
</ul></li>
</ul>
<p>関数によって、違うセクションがあるかもしれませんが、知っておくべき主要なものは以上でしょう。</p>
<p>Notice how related functions might call for the same help file:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="fu">write.table</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">?</span><span class="fu">write.csv</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>This is because these functions have very similar applicability and
often share the same arguments as inputs to the function, so package
authors often choose to document them together in a single help
file.</p>
<div id="tip-running-examples" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-running-examples" class="callout-inner">
<h3 class="callout-title">Tip: Running Examples</h3>
<div class="callout-content">
<p>From within the function help page, you can highlight code in the
Examples and hit <kbd>Ctrl</kbd>+<kbd>Return</kbd> to run it in RStudio
console. This gives you a quick way to get a feel for how a function
works.</p>
</div>
</div>
</div>
<div id="ヒントヘルプファイルを読む" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒントヘルプファイルを読む" class="callout-inner">
<h3 class="callout-title">ヒント：ヘルプファイルを読む</h3>
<div class="callout-content">
<p>Rの気が滅入る点は、多くの関数があるという点です。
自分が使う全ての関数の正しい使い方を覚えるのは不可能とまでは言いませんが、かなり大変でしょう。
Luckily, using the help files means you don’t have to remember that!</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="特別な演算子">特別な演算子<a class="anchor" aria-label="anchor" href="#%E7%89%B9%E5%88%A5%E3%81%AA%E6%BC%94%E7%AE%97%E5%AD%90"></a>
</h2>
<hr class="half-width">
<p>特別な演算子を検索するためには、引用符を使いましょう：</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="st">"&lt;-"</span></span>
<span><span class="op">?</span><span class="va">`&lt;-`</span></span></code></pre>
</div>
</section><section><h2 class="section-heading" id="パッケージについてのヘルプを入手する">パッケージについてのヘルプを入手する<a class="anchor" aria-label="anchor" href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%81%AE%E3%83%98%E3%83%AB%E3%83%97%E3%82%92%E5%85%A5%E6%89%8B%E3%81%99%E3%82%8B"></a>
</h2>
<hr class="half-width">
<p>Many packages come with “vignettes”: tutorials and extended example
documentation.
多くのパッケージには、「ビニエット（vignette）」があります。これは、使い方の説明や詳細な例を掲載する資料です。
引数なしに、<code>vignette()</code>
と入力すると、インストールされているパッケージの全てのビニエットの一覧が表示されます。
<code>vignette(package="package-name")</code>
と入力すると、<code>package-name</code>についての全てのビニエットの一覧が表示され、
<code>vignette("vignette-name")</code>
と入力すると、指定されたビニエットが開きます。</p>
<p>もしパッケージにビニエットがひとつもない場合、通常
<code>help("package-name")</code> と入力するとヘルプが表示されます。</p>
<p>RStudio also has a set of excellent <a href="https://rstudio.com/resources/cheatsheets/" class="external-link">cheatsheets</a> for
many packages.</p>
</section><section><h2 class="section-heading" id="when-you-remember-part-of-the-function-name">When You Remember Part of the Function Name<a class="anchor" aria-label="anchor" href="#when-you-remember-part-of-the-function-name"></a>
</h2>
<hr class="half-width">
<p>関数がどのパッケージに入っているか、またはスペルが定かではないとき、あいまい検索をすることもできます：</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="op">?</span><span class="va">function_name</span></span></code></pre>
</div>
<p>A fuzzy search is when you search for an approximate string match.
For example, you may remember that the function to set your working
directory includes “set” in its name. You can do a fuzzy search to help
you identify the function:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="op">?</span><span class="va">set</span></span></code></pre>
</div>
</section><section><h2 class="section-heading" id="どうしていいか分からない場合">どうしていいか分からない場合<a class="anchor" aria-label="anchor" href="#%E3%81%A9%E3%81%86%E3%81%97%E3%81%A6%E3%81%84%E3%81%84%E3%81%8B%E5%88%86%E3%81%8B%E3%82%89%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88"></a>
</h2>
<hr class="half-width">
<p>関数やパッケージが分からない場合、<a href="https://cran.at.r-project.org/web/views" class="external-link">CRAN Task Views</a>という
分野ごとにまとめられたパッケージのリストがあります。
このページから探し始めるといいかもしれません。</p>
</section><section><h2 class="section-heading" id="コードがうまく動作しない仲間の助けが必要な場合">コードがうまく動作しない：仲間の助けが必要な場合<a class="anchor" aria-label="anchor" href="#%E3%82%B3%E3%83%BC%E3%83%89%E3%81%8C%E3%81%86%E3%81%BE%E3%81%8F%E5%8B%95%E4%BD%9C%E3%81%97%E3%81%AA%E3%81%84%E4%BB%B2%E9%96%93%E3%81%AE%E5%8A%A9%E3%81%91%E3%81%8C%E5%BF%85%E8%A6%81%E3%81%AA%E5%A0%B4%E5%90%88"></a>
</h2>
<hr class="half-width">
<p>関数がうまく動かない場合、十中八九、探している問の答えは、 <a href="https://stackoverflow.com/" class="external-link">Stack Overflow</a>に掲載されいます。
<code>[r]</code> タグを使って検索ができます。 Please make sure to see
their page on <a href="https://stackoverflow.com/help/how-to-ask" class="external-link">how to
ask a good question.</a></p>
<p>もし答えが見つからない場合、仲間に質問をする際に
役に立つ関数がいくつかあります：</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">dput</span></span></code></pre>
</div>
<p>これで、あなたが使っているデータを誰にでもコピー・アンド・ペーストしてRセッションで使える
形式にすることができます。</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sessionInfo</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>R version 4.4.1 (2024-06-14)
Platform: x86_64-pc-linux-gnu
Running under: Ubuntu 22.04.5 LTS

Matrix products: default
BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.10.0
LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.10.0

locale:
 [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8
 [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8
 [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C
[10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C

time zone: UTC
tzcode source: system (glibc)

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
 [1] assertthat_0.2.1 R6_2.5.1         xfun_0.47        magrittr_2.0.3
 [5] glue_1.8.0       knitr_1.48       sandpaper_0.16.8 lifecycle_1.0.4
 [9] xml2_1.3.6       ps_1.8.0         cli_3.6.3        processx_3.8.4
[13] callr_3.7.6      vctrs_0.6.5      renv_1.0.10      withr_3.0.1
[17] compiler_4.4.1   purrr_1.0.2      tools_4.4.1      tinkr_0.2.0.9000
[21] evaluate_1.0.0   yaml_2.3.10      pegboard_0.7.6   rlang_1.1.4     </code></pre>
</div>
<p>これは、現在使っている R
のバージョン、そして読み込まれている全てのパッケージを表示させる関数です。
他の人が問題点を再現し、バグを見つける際にこの情報が役立つこともあります。</p>
<div id="チャレンジ１" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ１" class="callout-inner">
<h3 class="callout-title">チャレンジ１</h3>
<div class="callout-content">
<p>Look at the help page for the <code>c</code> function. What kind of
vector do you expect will be created if you evaluate the following:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu">c</span><span class="op">(</span><span class="st">'d'</span>, <span class="st">'e'</span>, <span class="st">'f'</span><span class="op">)</span></span>
<span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="st">'f'</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>The <code>c()</code> function creates a vector, in which all elements
are of the same type. In the first case, the elements are numeric, in
the second, they are characters, and in the third they are also
characters: the numeric values are “coerced” to be characters.</p>
</div>
</div>
</div>
</div>
<div id="チャレンジ２" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ２" class="callout-inner">
<h3 class="callout-title">チャレンジ２</h3>
<div class="callout-content">
<p>Look at the help for the <code>paste</code> function. You will need
to use it later. What’s the difference between the <code>sep</code> and
<code>collapse</code> arguments?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>To look at the help for the <code>paste()</code> function, use:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">help</span><span class="op">(</span><span class="st">"paste"</span><span class="op">)</span></span>
<span><span class="op">?</span><span class="va">paste</span></span></code></pre>
</div>
<p>The difference between <code>sep</code> and <code>collapse</code> is
a little tricky. The <code>paste</code> function accepts any number of
arguments, each of which can be a vector of any length. The
<code>sep</code> argument specifies the string used between concatenated
terms — by default, a space. The result is a vector as long as the
longest argument supplied to <code>paste</code>. In contrast,
<code>collapse</code> specifies that after concatenation the elements
are <em>collapsed</em> together using the given separator, the result
being a single string.</p>
<p>It is important to call the arguments explicitly by typing out the
argument name e.g <code>sep = ","</code> so the function understands to
use the “,” as a separator and not a term to concatenate. e.g.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">paste</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"b"</span><span class="op">)</span>, <span class="st">"c"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a c" "b c"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">paste</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"b"</span><span class="op">)</span>, <span class="st">"c"</span>, <span class="st">","</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a c ," "b c ,"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">paste</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"b"</span><span class="op">)</span>, <span class="st">"c"</span>, sep <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a,c" "b,c"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">paste</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"b"</span><span class="op">)</span>, <span class="st">"c"</span>, collapse <span class="op">=</span> <span class="st">"|"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a c|b c"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">paste</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"b"</span><span class="op">)</span>, <span class="st">"c"</span>, sep <span class="op">=</span> <span class="st">","</span>, collapse <span class="op">=</span> <span class="st">"|"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a,c|b,c"</code></pre>
</div>
<p>(For more information, scroll to the bottom of the
<code>?paste</code> help page and look at the examples, or try
<code>example('paste')</code>.)</p>
</div>
</div>
</div>
</div>
<div id="チャレンジ３" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ３" class="callout-inner">
<h3 class="callout-title">チャレンジ３</h3>
<div class="callout-content">
<p>Use help to find a function (and its associated parameters) that you
could use to load data from a tabular file in which columns are
delimited with “\t” (tab) and the decimal point is a “.” (period). This
check for decimal separator is important, especially if you are working
with international colleagues, because different countries have
different conventions for the decimal point (i.e. comma vs period).
Hint: use <code>??"read table"</code> to look up functions related to
reading in tabular data.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>The standard R function for reading tab-delimited files with a period
decimal separator is read.delim(). You can also do this with
<code>read.table(file, sep="\t")</code> (the period is the
<em>default</em> decimal separator for <code>read.table()</code>),
although you may have to change the <code>comment.char</code> argument
as well if your data file contains hash (#) characters.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="その他の資料">その他の資料<a class="anchor" aria-label="anchor" href="#%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE%E8%B3%87%E6%96%99"></a>
</h2>
<hr class="half-width">
<ul>
<li><a href="https://www.statmethods.net/" class="external-link">Quick R</a></li>
<li><a href="https://www.rstudio.com/resources/cheatsheets/" class="external-link">RStudio
cheat sheets</a></li>
<li><a href="https://www.cookbook-r.com/" class="external-link">Cookbook for R</a></li>
</ul>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">まとめ</h3>
<div class="callout-content">
<ul>
<li>Use <code>help()</code> to get online help in R.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-04-data-structures-part1"><p>Content from <a href="04-data-structures-part1.html">Data Structures</a></p>
<hr>
<p>最終更新日：2024-10-12 |

        <a href="https://github.com/swcarpentry-ja/r-novice-gapminder/edit/main/episodes/04-data-structures-part1.Rmd" class="external-link">ページの編集 <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>所要時間：<i aria-hidden="true" data-feather="clock"></i> 55分</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="回答を全て表示する " data-collapse="回答を全て折りたたむ "> 回答を全て表示する <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">概要</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">質問</h3>
<ul>
<li>How can I read data in R?</li>
<li>What are the basic data types in R?</li>
<li>How do I represent categorical information in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">目的</h3>
<ul>
<li>To be able to identify the 5 main data types.</li>
<li>To begin exploring data frames, and understand how they are related
to vectors and lists.</li>
<li>To be able to ask questions from R about the type, class, and
structure of an object.</li>
<li>To understand the information of the attributes “names”, “class”,
and “dim”.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Rのすごい特徴のひとつは、表形式のデータ（既に手元にあるようなスプレッドシートやCSVファイル）が扱えることです。
まず、 <code>data/</code> ディレクトリに <code>feline-data.csv</code>
というお試しのデータセットを作ってみましょう。</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span>coat <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"calico"</span>, <span class="st">"black"</span>, <span class="st">"tabby"</span><span class="op">)</span>,</span>
<span>                    weight <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">2.1</span>, <span class="fl">5.0</span>, <span class="fl">3.2</span><span class="op">)</span>,</span>
<span>                    likes_string <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>We can now save <code>cats</code> as a CSV file. It is good practice
to call the argument names explicitly so the function knows what default
values you are changing. Here we are setting
<code>row.names = FALSE</code>. Recall you can use
<code>?write.csv</code> to pull up the help file to check out the
argument names and their default values.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">write.csv</span><span class="op">(</span>x <span class="op">=</span> <span class="va">cats</span>, file <span class="op">=</span> <span class="st">"data/feline-data.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre>
</div>
<p>新しいファイル <code>feline-data.csv</code> の内容：</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>coat,weight,likes_string</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>calico,<span class="fl">2.1</span>,<span class="dv">1</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>black,<span class="fl">5.0</span>,<span class="dv">0</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>tabby,<span class="fl">3.2</span>,<span class="dv">1</span></span></code></pre>
</div>
<div id="ヒントrを使ったテキスト形式のファイルの編集" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒントrを使ったテキスト形式のファイルの編集" class="callout-inner">
<h3 class="callout-title">ヒント：Rを使ったテキスト形式のファイルの編集</h3>
<div class="callout-content">
<p>あるいは、テキストエディタ（Nano）またはをRStudioのメニューから File
- New File - Text File を使って <code>data/feline-data.csv</code>
を作成することができます。</p>
</div>
</div>
</div>
<p>以下を使って作ったデータをRへ読み込ませることができます：</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span>file <span class="op">=</span> <span class="st">"data/feline-data.csv"</span><span class="op">)</span></span>
<span><span class="va">cats</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    coat weight likes_string
1 calico    2.1            1
2  black    5.0            0
3  tabby    3.2            1</code></pre>
</div>
<p>この<code>read.table</code>関数は、CSVファイル（csv = comma-separated
values）のように、
データの列が区読文字で分けられたテキストファイルに収められた表形式データを
読み込むために使われます。
タブとコンマは、csvファイルでデータ点を区切る、又は分けるために使われる
最も一般的な句読文字です。
便宜上、Rでは、他に２つの<code>read.table</code>のバージョンが提供されています。
ひとつは、データがコンマで分けられているファイルのための
<code>read.csv</code> 、 データがタブで分けられているファイルのための
<code>read.delim</code> です。
これら３つの関数のうち、<code>read.csv</code> が最も広く使われています。
必要であれば、 <code>read.csv</code> と <code>read.delim</code>、両方の
デフォルトの句読記号を置き換えることができます。</p>
<div id="check-your-data-for-factors" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="check-your-data-for-factors" class="callout-inner">
<h3 class="callout-title">Check your data for factors</h3>
<div class="callout-content">
<p>In recent times, the default way how R handles textual data has
changed. Text data was interpreted by R automatically into a format
called “factors”. But there is an easier format that is called
“character”. We will hear about factors later, and what to use them for.
For now, remember that in most cases, they are not needed and only
complicate your life, which is why newer R versions read in text as
“character”. Check now if your version of R has automatically created
factors and convert them to “character” format:</p>
<ol style="list-style-type: decimal">
<li>Check the data types of your input by typing
<code>str(cats)</code>
</li>
<li>In the output, look at the three-letter codes after the colons: If
you see only “num” and “chr”, you can continue with the lesson and skip
this box. If you find “fct”, continue to step 3.</li>
<li>Prevent R from automatically creating “factor” data. That can be
done by the following code:
<code>options(stringsAsFactors = FALSE)</code>. Then, re-read the cats
table for the change to take effect.</li>
<li>You must set this option every time you restart R. To not forget
this, include it in your analysis script before you read in any data,
for example in one of the first lines.</li>
<li>For R versions greater than 4.0.0, text data is no longer converted
to factors anymore. So you can install this or a newer version to avoid
this problem. If you are working on an institute or company computer,
ask your administrator to do it.</li>
</ol>
</div>
</div>
</div>
<p>演算子 <code>$</code>
を使って列を指定し、列を抜き出すことで、すぐにデータセットの探索を始めることができます：</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">$</span><span class="va">weight</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2.1 5.0 3.2</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">$</span><span class="va">coat</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "calico" "black"  "tabby" </code></pre>
</div>
<p>列に他の操作をすることもできます：</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Say we discovered that the scale weighs two Kg light:</span></span>
<span><span class="va">cats</span><span class="op">$</span><span class="va">weight</span> <span class="op">+</span> <span class="fl">2</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 4.1 7.0 5.2</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">paste</span><span class="op">(</span><span class="st">"My cat is"</span>, <span class="va">cats</span><span class="op">$</span><span class="va">coat</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "My cat is calico" "My cat is black"  "My cat is tabby" </code></pre>
</div>
<p>でも、こうしたらどうだろう</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">$</span><span class="va">weight</span> <span class="op">+</span> <span class="va">cats</span><span class="op">$</span><span class="va">coat</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in cats$weight + cats$coat: non-numeric argument to binary operator</code></pre>
</div>
<p>ここで何が起こったかを理解することが、データをRでうまく分析する鍵となります。</p>
<div class="section level3">
<h3 id="データ型">データ型<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E5%9E%8B"></a>
</h3>
<p>最後のコマンドがエラーを返すのは <code>2.1</code> 足す
<code>"black"</code> はナンセンスだからだろうと思ったとしたら、
それは正解で、既にプログラミングにおける データ型
という重要な概念をある程度分かっていると言えます。
データ型が何かを知るには、以下を使います：</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="va">cats</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "double"</code></pre>
</div>
<p>主な型は５つあります：<code>double（浮動小数点型）</code>、<code>integer（整数型）</code>、<code>complex（複素数型）</code>、<code>logical（論理型）</code>、そして<code>character（文字型）</code>。
For historic reasons, <code>double</code> is also called
<code>numeric</code>.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="fl">3.14</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "double"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="fl">1L</span><span class="op">)</span> <span class="co"># The L suffix forces the number to be an integer, since by default R uses float numbers</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "integer"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fl">1i</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "complex"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "logical"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="st">'banana'</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "character"</code></pre>
</div>
<p>どんなに分析が複雑になっても、
Rにある全てのデータは、この基本データ型のいずれかとして解釈されます。
この厳格性によって、とても重要なことが後々起こることもあります。</p>
<p>あるユーザーが他の猫の詳細を加えたとします。 情報は
<code>data/feline-data_v2.csv</code> ファイルにあるものです。</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">file.show</span><span class="op">(</span><span class="st">"data/feline-data_v2.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>coat,weight,likes_string</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>calico,<span class="fl">2.1</span>,<span class="dv">1</span></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>black,<span class="fl">5.0</span>,<span class="dv">0</span></span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>tabby,<span class="fl">3.2</span>,<span class="dv">1</span></span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>tabby,<span class="fl">2.3</span> or <span class="fl">2.4</span>,<span class="dv">1</span></span></code></pre>
</div>
<p>先ほどのように、この新しい猫の情報を読み込み、 <code>weight</code>
の列が、 どんなデータ型が確認してみましょう。</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span>file<span class="op">=</span><span class="st">"data/feline-data_v2.csv"</span><span class="op">)</span></span>
<span><span class="fu">typeof</span><span class="op">(</span><span class="va">cats</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "character"</code></pre>
</div>
<p>なんと、この weight はdouble型ではないじゃありませんか！
前と同じように計算をしようとすると、 やっかいなことになります：</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">$</span><span class="va">weight</span> <span class="op">+</span> <span class="fl">2</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in cats$weight + 2: non-numeric argument to binary operator</code></pre>
</div>
<p>何が起こったのでしょう？Rは、csvファイルを読み込む際、
列にある全てのものが同じ基本の型であるべきだと主張します。もし、列の
全て が、 double型であることが確認できない場合、その列の だれも
double型にならないのです。 The <code>cats</code> data we are working
with is something called a <em>data frame</em>. Data frames are one of
the most common and versatile types of <em>data structures</em> we will
work with in R. A given column in a data frame cannot be composed of
different data types. In this case, R does not read everything in the
data frame column <code>weight</code> as a <em>double</em>, therefore
the entire column data type changes to something that is suitable for
everything in the column.</p>
<p>When R reads a csv file, it reads it in as a <em>data frame</em>.
Thus, when we loaded the <code>cats</code> csv file, it is stored as a
data frame. We can recognize data frames by the first row that is
written by the <code>str()</code> function:</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">cats</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	4 obs. of  3 variables:
 $ coat        : chr  "calico" "black" "tabby" "tabby"
 $ weight      : chr  "2.1" "5" "3.2" "2.3 or 2.4"
 $ likes_string: int  1 0 1 1</code></pre>
</div>
<p><em>Data frames</em> are composed of rows and columns, where each
column has the same number of rows. Different columns in a data frame
can be made up of different data types (this is what makes them so
versatile), but everything in a given column needs to be the same type
(e.g., vector, factor, or list).</p>
<p>Let’s explore more about different data structures and how they
behave. For now, let’s remove that extra line from our cats data and
reload it, while we investigate this behavior further:</p>
<p>feline-data.csv:</p>
<pre><code>coat,weight,likes_string
calico,2.1,1
black,5.0,0
tabby,3.2,1</code></pre>
<p>RStudioに戻ります：</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span>file<span class="op">=</span><span class="st">"data/feline-data.csv"</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="ベクトル及び型強制">ベクトル及び型強制<a class="anchor" aria-label="anchor" href="#%E3%83%99%E3%82%AF%E3%83%88%E3%83%AB%E5%8F%8A%E3%81%B3%E5%9E%8B%E5%BC%B7%E5%88%B6"></a>
</h3>
<p>この動作をより理解するために、もう一つのデータ構造 ベクトル
を紹介します。</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_vector</span> <span class="op">&lt;-</span> <span class="fu">vector</span><span class="op">(</span>length <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">my_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] FALSE FALSE FALSE</code></pre>
</div>
<p>Rのベクトルは、本来、
ベクトルの中の全てのものは同じ基本データ型でなければいけない
という特別な条件のある、 順番を付けられたもののリストです。
もし、データ型を選ばなければ、デフォルトで<code>logical</code>になりますが、好きなデータ型を持つ空のベクトルを
宣言することもできます。</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">another_vector</span> <span class="op">&lt;-</span> <span class="fu">vector</span><span class="op">(</span>mode<span class="op">=</span><span class="st">'character'</span>, length<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">another_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "" "" ""</code></pre>
</div>
<p>以下を使えばベクトルかどうかを確かめられます：</p>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">another_vector</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> chr [1:3] "" "" ""</code></pre>
</div>
<p>このコマンドから出てきた暗号みたいなアウトプットによると、このベクトルの基本データ型（ここでは
<code>chr</code> （文字型））、 数（実際には、ベクトルの添字、この場合
<code>[1:3]</code> ）、
そして中身のいくつかの例示（この場合、空の文字列）が示されています。
<code>cats$weight</code>に同じようなことをすると：</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">cats</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> num [1:3] 2.1 5 3.2</code></pre>
</div>
<p>ここで<code>cats$weight</code> もまたベクトルであることが分かります。
Rのデータフレームに読み込まれたデータの列は全てベクトル で、
Rが全ての列を同じ基本データ型にする理由です。</p>
<div id="議論１" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="議論１" class="callout-inner">
<h3 class="callout-title">議論１</h3>
<div class="callout-content">
<p>Why is R so opinionated about what we put in our columns of data? How
does this help us?</p>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  議論１
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>By keeping everything in a column the same, we allow ourselves to
make simple assumptions about our data; if you can interpret one entry
in the column as a number, then you can interpret <em>all</em> of them
as numbers, so we don’t have to check every time. This consistency is
what people mean when they talk about <em>clean data</em>; in the long
run, strict consistency goes a long way to making our lives easier in
R.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level4">
<h4 id="coercion-by-combining-vectors">Coercion by combining vectors<a class="anchor" aria-label="anchor" href="#coercion-by-combining-vectors"></a>
</h4>
<p>合成関数で明確な内容を持つベクトルを作ることもできます：</p>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combine_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">2</span>,<span class="fl">6</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">combine_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2 6 3</code></pre>
</div>
<p>これまで学んだことを踏まえて、以下は何を生み出すでしょうか。</p>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">quiz_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">2</span>,<span class="fl">6</span>,<span class="st">'3'</span><span class="op">)</span></span></code></pre>
</div>
<p>This is something called <em>type coercion</em>, and it is the source
of many surprises and the reason why we need to be aware of the basic
data types and how R will interpret them. When R encounters a mix of
types (here double and character) to be combined into a single vector,
it will force them all to be the same type. Consider:</p>
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coercion_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'a'</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">coercion_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a"    "TRUE"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">another_coercion_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">another_coercion_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0 1</code></pre>
</div>
</div>
<div class="section level4">
<h4 id="the-type-hierarchy">The type hierarchy<a class="anchor" aria-label="anchor" href="#the-type-hierarchy"></a>
</h4>
<p>強制化のルールは、<code>logical</code> - <code>integer</code> -
<code>numeric</code> - <code>complex</code> - <code>character</code>
です。ここで、 - は、 ～が変換されるのは～ という意味です。 For example,
combining <code>logical</code> and <code>character</code> transforms the
result to <code>character</code>:</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">c</span><span class="op">(</span><span class="st">'a'</span>, <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a"    "TRUE"</code></pre>
</div>
<p>A quick way to recognize <code>character</code> vectors is by the
quotes that enclose them when they are printed.</p>
<p>この流れに逆らう強制化も、<code>as.</code> 関数を使ってできます：</p>
<div class="codewrapper sourceCode" id="cb55">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">character_vector_example</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'0'</span>,<span class="st">'2'</span>,<span class="st">'4'</span><span class="op">)</span></span>
<span><span class="va">character_vector_example</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "0" "2" "4"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb57">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">character_coerced_to_double</span> <span class="op">&lt;-</span> <span class="fu">as.double</span><span class="op">(</span><span class="va">character_vector_example</span><span class="op">)</span></span>
<span><span class="va">character_coerced_to_double</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0 2 4</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb59">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">double_coerced_to_logical</span> <span class="op">&lt;-</span> <span class="fu">as.logical</span><span class="op">(</span><span class="va">character_coerced_to_double</span><span class="op">)</span></span>
<span><span class="va">double_coerced_to_logical</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] FALSE  TRUE  TRUE</code></pre>
</div>
<p>ご覧のとおり、Rがある基本のデータ型を他へ変換すると、驚くことが起こります。
型強制の核心はさておき、ポイントは：もし、データが思っていたものと違っている場合、
型強制が原因かもしれないという事です。ベクトルの中、データフレームの列を全て同じ型にすること、
さもなくば、いやなサプライズに会う羽目になるかもしれません。</p>
<p>But coercion can also be very useful! For example, in our
<code>cats</code> data <code>likes_string</code> is numeric, but we know
that the 1s and 0s actually represent <code>TRUE</code> and
<code>FALSE</code> (a common way of representing them). We should use
the <code>logical</code> datatype here, which has two states:
<code>TRUE</code> or <code>FALSE</code>, which is exactly what our data
represents. We can ‘coerce’ this column to be <code>logical</code> by
using the <code>as.logical</code> function:</p>
<div class="codewrapper sourceCode" id="cb61">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">$</span><span class="va">likes_string</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1 0 1</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb63">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">$</span><span class="va">likes_string</span> <span class="op">&lt;-</span> <span class="fu">as.logical</span><span class="op">(</span><span class="va">cats</span><span class="op">$</span><span class="va">likes_string</span><span class="op">)</span></span>
<span><span class="va">cats</span><span class="op">$</span><span class="va">likes_string</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1]  TRUE FALSE  TRUE</code></pre>
</div>
<div id="チャレンジ１" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ１" class="callout-inner">
<h3 class="callout-title">チャレンジ１</h3>
<div class="callout-content">
<p>An important part of every data analysis is cleaning the input data.
If you know that the input data is all of the same format,
(e.g. numbers), your analysis is much easier! Clean the cat data set
from the chapter about type coercion.</p>
<div class="section level4">
<h4 id="copy-the-code-template">Copy the code template<a class="anchor" aria-label="anchor" href="#copy-the-code-template"></a>
</h4>
<p>Create a new script in RStudio and copy and paste the following code.
Then move on to the tasks below, which help you to fill in the gaps
(______).</p>
<pre><code># Read data
cats &lt;- read.csv("data/feline-data_v2.csv")

# 1. Print the data
_____

# 2. Show an overview of the table with all data types
_____(cats)

# 3. The "weight" column has the incorrect data type __________.
#    The correct data type is: ____________.

# 4. Correct the 4th weight data point with the mean of the two given values
cats$weight[4] &lt;- 2.35
#    print the data again to see the effect
cats

# 5. Convert the weight to the right data type
cats$weight &lt;- ______________(cats$weight)

#    Calculate the mean to test yourself
mean(cats$weight)

# If you see the correct mean value (and not NA), you did the exercise
# correctly!</code></pre>
</div>
<div class="section level3">
<h3 id="instructions-for-the-tasks">Instructions for the tasks<a class="anchor" aria-label="anchor" href="#instructions-for-the-tasks"></a>
</h3>
<div class="section level4">
<h4 id="print-the-data">1. Print the data<a class="anchor" aria-label="anchor" href="#print-the-data"></a>
</h4>
<p>Execute the first statement (<code>read.csv(...)</code>). Then print
the data to the console</p>
</div>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Tip 1.1
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>Show the content of any variable by typing its name.</p>
<div class="section level3">
<h3 id="チャレンジ３の解答">チャレンジ３の解答<a class="anchor" aria-label="anchor" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8%EF%BC%93%E3%81%AE%E8%A7%A3%E7%AD%94"></a>
</h3>
<p>Two correct solutions:</p>
<pre><code><span><span class="va">cats</span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="va">cats</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="overview-of-the-data-types" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="overview-of-the-data-types" class="callout-inner">
<h3 class="callout-title">2. Overview of the data types</h3>
<div class="callout-content">
<p>The data type of your data is as important as the data itself. Use a
function we saw earlier to print out the data types of all columns of
the <code>cats</code> table.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  Tip 1.2
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>In the chapter “Data types” we saw two functions that can show data
types. One printed just a single word, the data type name. The other
printed a short form of the data type, and the first few values. We need
the second here.</p>
</div>
</div>
</div>
</div>
<div id="チャレンジ１" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ１" class="callout-inner">
<h3 class="callout-title">チャレンジ１<em> (continued)</em>
</h3>
<div class="callout-content">
<blockquote>
<h3 id="チャレンジ３の解答-1">チャレンジ３の解答</h3>
<pre><code><span><span class="fu">str</span><span class="op">(</span><span class="va">cats</span><span class="op">)</span></span></code></pre>
</blockquote>
<div class="section level4">
<h4 id="which-data-type-do-we-need">3. Which data type do we need?<a class="anchor" aria-label="anchor" href="#which-data-type-do-we-need"></a>
</h4>
<p>The shown data type is not the right one for this data (weight of a
cat). Which data type do we need?</p>
<ul>
<li>Why did the <code>read.csv()</code> function not choose the correct
data type?</li>
<li>Fill in the gap in the comment with the correct data type for cat
weight!</li>
</ul>
</div>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  Tip 1.3
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>Scroll up to the section about the <a href="#the-type-hierarchy">type
hierarchy</a> to review the available data types</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<ul>
<li>Weight is expressed on a continuous scale (real numbers). The R data
type for this is “double” (also known as “numeric”).</li>
<li>The fourth row has the value “2.3 or 2.4”. That is not a number but
two, and an english word. Therefore, the “character” data type is
chosen. The whole column is now text, because all values in the same
columns have to be the same data type.</li>
</ul>
</div>
</div>
</div>
</div>
<div id="correct-the-problematic-value" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="correct-the-problematic-value" class="callout-inner">
<h3 class="callout-title">4. Correct the problematic value</h3>
<div class="callout-content">
<p>The code to assign a new weight value to the problematic fourth row
is given. Think first and then execute it: What will be the data type
after assigning a number like in this example? You can check the data
type after executing to see if you were right.</p>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6">
  Tip 1.4
  </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" aria-labelledby="headingSolution6" data-bs-parent="#accordionSolution6">
<div class="accordion-body">
<p>Revisit the hierarchy of data types when two different data types are
combined.</p>
</div>
</div>
</div>
</div>
<div id="チャレンジ１" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ１" class="callout-inner">
<h3 class="callout-title">チャレンジ１<em> (continued)</em>
</h3>
<div class="callout-content">
<blockquote>
<h3 id="チャレンジ８の解答-1.">チャレンジ８の解答 1.</h3>
<p>The data type of the column “weight” is “character”. The assigned
data type is “double”. Combining two data types yields the data type
that is higher in the following hierarchy:</p>
<pre><code>logical &lt; integer &lt; double &lt; complex &lt; character</code></pre>
<p>Therefore, the column is still of type character! We need to manually
convert it to “double”. {: .solution}</p>
</blockquote>
<div class="section level4">
<h4 id="convert-the-column-weight-to-the-correct-data-type">5. Convert the column “weight” to the correct data type<a class="anchor" aria-label="anchor" href="#convert-the-column-weight-to-the-correct-data-type"></a>
</h4>
<p>Cat weight are numbers. But the column does not have this data type
yet. Coerce the column to floating point numbers.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution7" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution7" aria-expanded="false" aria-controls="collapseSolution7">
  <h4 class="accordion-header" id="headingSolution7">
  Tip 1.5
  </h4>
</button>
<div id="collapseSolution7" class="accordion-collapse collapse" aria-labelledby="headingSolution7" data-bs-parent="#accordionSolution7">
<div class="accordion-body">
<p>The functions to convert data types start with <code>as.</code>. You
can look for the function further up in the manuscript or use the
RStudio auto-complete function: Type “<code>as.</code>” and then press
the TAB key.</p>
</div>
</div>
</div>
</div>
<div id="チャレンジ１" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="チャレンジ１" class="callout-inner">
<h3 class="callout-title">チャレンジ１<em> (continued)</em>
</h3>
<div class="callout-content">
<blockquote>
<h3 id="チャレンジ３の解答-3">チャレンジ３の解答</h3>
<p>There are two functions that are synonymous for historic reasons:</p>
<pre><code><span><span class="va">cats</span><span class="op">$</span><span class="va">weight</span> <span class="op">&lt;-</span> <span class="fu">as.double</span><span class="op">(</span><span class="va">cats</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span></span>
<span><span class="va">cats</span><span class="op">$</span><span class="va">weight</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">cats</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span></span></code></pre>
</blockquote>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="some-basic-vector-functions">Some basic vector functions<a class="anchor" aria-label="anchor" href="#some-basic-vector-functions"></a>
</h3>
<p>合成関数
<code>c()</code>は、既存のベクトルに追加することもできます：</p>
<div class="codewrapper sourceCode" id="cb70">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ab_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span><span class="op">)</span></span>
<span><span class="va">ab_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a" "b"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb72">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combine_example</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">ab_vector</span>, <span class="st">'SWC'</span><span class="op">)</span></span>
<span><span class="va">combine_example</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a"   "b"   "SWC"</code></pre>
</div>
<p>数列を作ることもできます：</p>
<div class="codewrapper sourceCode" id="cb74">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mySeries</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span><span class="va">mySeries</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb76">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">seq</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb78">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">seq</span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span>, by<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1]  1.0  1.1  1.2  1.3  1.4  1.5  1.6  1.7  1.8  1.9  2.0  2.1  2.2  2.3  2.4
[16]  2.5  2.6  2.7  2.8  2.9  3.0  3.1  3.2  3.3  3.4  3.5  3.6  3.7  3.8  3.9
[31]  4.0  4.1  4.2  4.3  4.4  4.5  4.6  4.7  4.8  4.9  5.0  5.1  5.2  5.3  5.4
[46]  5.5  5.6  5.7  5.8  5.9  6.0  6.1  6.2  6.3  6.4  6.5  6.6  6.7  6.8  6.9
[61]  7.0  7.1  7.2  7.3  7.4  7.5  7.6  7.7  7.8  7.9  8.0  8.1  8.2  8.3  8.4
[76]  8.5  8.6  8.7  8.8  8.9  9.0  9.1  9.2  9.3  9.4  9.5  9.6  9.7  9.8  9.9
[91] 10.0</code></pre>
</div>
<p>ベクトルについて、いくつか質問することもできます：</p>
<div class="codewrapper sourceCode" id="cb80">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sequence_example</span> <span class="op">&lt;-</span> <span class="fl">20</span><span class="op">:</span><span class="fl">25</span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">sequence_example</span>, n<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 20 21</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb82">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tail</span><span class="op">(</span><span class="va">sequence_example</span>, n<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 22 23 24 25</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb84">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">length</span><span class="op">(</span><span class="va">sequence_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 6</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb86">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="va">sequence_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "integer"</code></pre>
</div>
<p>We can get individual elements of a vector by using the bracket
notation:</p>
<div class="codewrapper sourceCode" id="cb88">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">first_element</span> <span class="op">&lt;-</span> <span class="va">sequence_example</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">first_element</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 20</code></pre>
</div>
<p>To change a single element, use the bracket on the other side of the
arrow:</p>
<div class="codewrapper sourceCode" id="cb90">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sequence_example</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span><span class="va">sequence_example</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 30 21 22 23 24 25</code></pre>
</div>
<div id="チャレンジ２" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ２" class="callout-inner">
<h3 class="callout-title">チャレンジ２</h3>
<div class="callout-content">
<p>Start by making a vector with the numbers 1 through 26. Then,
multiply the vector by 2.</p>
</div>
</div>
</div>
<div id="accordionSolution8" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution8" aria-expanded="false" aria-controls="collapseSolution8">
  <h4 class="accordion-header" id="headingSolution8">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution8" class="accordion-collapse collapse" aria-labelledby="headingSolution8" data-bs-parent="#accordionSolution8">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb92">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">26</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">2</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="リスト">リスト<a class="anchor" aria-label="anchor" href="#%E3%83%AA%E3%82%B9%E3%83%88"></a>
</h3>
<p>覚えておきたいもう一つのデータ構造は、 <code>list</code> です。
リストは、他の種類よりも、ある意味シンプルです。その理由は、入れたいものを
なんでも入れることができるからです： Remember <em>everything in the
vector must be of the same basic data type</em>, but a list can have
different data types:</p>
<div class="codewrapper sourceCode" id="cb93">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">list_example</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"a"</span>, <span class="cn">TRUE</span>, <span class="fl">1</span><span class="op">+</span><span class="fl">4i</span><span class="op">)</span></span>
<span><span class="va">list_example</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[[1]]
[1] 1

[[2]]
[1] "a"

[[3]]
[1] TRUE

[[4]]
[1] 1+4i</code></pre>
</div>
<p>When printing the object structure with <code>str()</code>, we see
the data types of all elements:</p>
<div class="codewrapper sourceCode" id="cb95">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">list_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>List of 4
 $ : num 1
 $ : chr "a"
 $ : logi TRUE
 $ : cplx 1+4i</code></pre>
</div>
<p>What is the use of lists? They can <strong>organize data of different
types</strong>. For example, you can organize different tables that
belong together, similar to spreadsheets in Excel. But there are many
other uses, too.</p>
<p>We will see another example that will maybe surprise you in the next
chapter.</p>
<p>To retrieve one of the elements of a list, use the <strong>double
bracket</strong>:</p>
<div class="codewrapper sourceCode" id="cb97">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">list_example</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a"</code></pre>
</div>
<p>The elements of lists also can have <strong>names</strong>, they can
be given by prepending them to the values, separated by an equals
sign:</p>
<div class="codewrapper sourceCode" id="cb99">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">another_list</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Numbers"</span>, numbers <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, data <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span></span>
<span><span class="va">another_list</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>$title
[1] "Numbers"

$numbers
 [1]  1  2  3  4  5  6  7  8  9 10

$data
[1] TRUE</code></pre>
</div>
<p>This results in a <strong>named list</strong>. Now we have a new
function of our object! We can access single elements by an additional
way!</p>
<div class="codewrapper sourceCode" id="cb101">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">another_list</span><span class="op">$</span><span class="va">title</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Numbers"</code></pre>
</div>
</div>
<section><h2 class="section-heading" id="names">Names<a class="anchor" aria-label="anchor" href="#names"></a>
</h2>
<hr class="half-width">
<p>With names, we can give meaning to elements. It is the first time
that we do not only have the <strong>data</strong>, but also explaining
information. It is <em>metadata</em> that can be stuck to the object
like a label. In R, this is called an <strong>attribute</strong>. Some
attributes enable us to do more with our object, for example, like here,
accessing an element by a self-defined name.</p>
<div class="section level3">
<h3 id="accessing-vectors-and-lists-by-name">Accessing vectors and lists by name<a class="anchor" aria-label="anchor" href="#accessing-vectors-and-lists-by-name"></a>
</h3>
<p>We have already seen how to generate a named list. The way to
generate a named vector is very similar. You have seen this function
before:</p>
<div class="codewrapper sourceCode" id="cb103">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pizza_price</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span> pizzasubito <span class="op">=</span> <span class="fl">5.64</span>, pizzafresh <span class="op">=</span> <span class="fl">6.60</span>, callapizza <span class="op">=</span> <span class="fl">4.50</span> <span class="op">)</span></span></code></pre>
</div>
<p>The way to retrieve elements is different, though:</p>
<div class="codewrapper sourceCode" id="cb104">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pizza_price</span><span class="op">[</span><span class="st">"pizzasubito"</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">pizzasubito</span></span>
<span>       <span class="fl">5.64</span> </span></code></pre>
</div>
<p>The approach used for the list does not work:</p>
<div class="codewrapper sourceCode" id="cb106">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pizza_price</span><span class="op">$</span><span class="va">pizzafresh</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in pizza_price$pizzafresh: $ operator is invalid for atomic vectors</code></pre>
</div>
<p>It will pay off if you remember this error message, you will meet it
in your own analyses. It means that you have just tried accessing an
element like it was in a list, but it is actually in a vector.</p>
</div>
<div class="section level3">
<h3 id="accessing-and-changing-names">Accessing and changing names<a class="anchor" aria-label="anchor" href="#accessing-and-changing-names"></a>
</h3>
<p>If you are only interested in the names, use the <code>names()</code>
function:</p>
<div class="codewrapper sourceCode" id="cb108">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">pizza_price</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "pizzasubito" "pizzafresh"  "callapizza" </code></pre>
</div>
<p>We have seen how to access and change single elements of a vector.
The same is possible for names:</p>
<div class="codewrapper sourceCode" id="cb110">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">pizza_price</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "callapizza"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb112">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">pizza_price</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"call-a-pizza"</span></span>
<span><span class="va">pizza_price</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> pizzasubito   pizzafresh call-a-pizza
        5.64         6.60         4.50 </code></pre>
</div>
<div id="チャレンジ３" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ３" class="callout-inner">
<h3 class="callout-title">チャレンジ３</h3>
<div class="callout-content">
<ul>
<li>What is the data type of the names of <code>pizza_price</code>? You
can find out using the <code>str()</code> or <code>typeof()</code>
functions.</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution9" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution9" aria-expanded="false" aria-controls="collapseSolution9">
  <h4 class="accordion-header" id="headingSolution9">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution9" class="accordion-collapse collapse" aria-labelledby="headingSolution9" data-bs-parent="#accordionSolution9">
<div class="accordion-body">
<p>You get the names of an object by wrapping the object name inside
<code>names(...)</code>. Similarly, you get the data type of the names
by again wrapping the whole code in <code>typeof(...)</code>:</p>
<pre><code><span><span class="fu">typeof</span><span class="op">(</span><span class="fu">names</span><span class="op">(</span><span class="va">pizza</span><span class="op">)</span><span class="op">)</span></span></code></pre>
<p>alternatively, use a new variable if this is easier for you to
read:</p>
<pre><code><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu">names</span><span class="op">(</span><span class="va">pizza</span><span class="op">)</span></span>
<span><span class="fu">typeof</span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="チャレンジ４" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ４" class="callout-inner">
<h3 class="callout-title">チャレンジ４</h3>
<div class="callout-content">
<p>Instead of just changing some of the names a vector/list already has,
you can also set all names of an object by writing code like (replace
ALL CAPS text):</p>
<pre><code><span><span class="fu">names</span><span class="op">(</span> <span class="va">OBJECT</span> <span class="op">)</span> <span class="op">&lt;-</span>  <span class="va">CHARACTER_VECTOR</span></span></code></pre>
<p>Create a vector that gives the number for each letter in the
alphabet!</p>
<ol style="list-style-type: decimal">
<li>Generate a vector called <code>letter_no</code> with the sequence of
numbers from 1 to 26!</li>
<li>R has a built-in object called <code>LETTERS</code>. It is a
26-character vector, from A to Z. Set the names of the number sequence
to this 26 letters</li>
<li>Test yourself by calling <code>letter_no["B"]</code>, which should
give you the number 2!</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution10" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution10" aria-expanded="false" aria-controls="collapseSolution10">
  <h4 class="accordion-header" id="headingSolution10">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution10" class="accordion-collapse collapse" aria-labelledby="headingSolution10" data-bs-parent="#accordionSolution10">
<div class="accordion-body">
<pre><code><span><span class="va">letter_no</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">26</span>   <span class="co"># or seq(1,26)</span></span>
<span><span class="fu">names</span><span class="op">(</span><span class="va">letter_no</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">LETTERS</span></span>
<span><span class="va">letter_no</span><span class="op">[</span><span class="st">"B"</span><span class="op">]</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="データフレーム">データフレーム<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0"></a>
</h2>
<hr class="half-width">
<p>We have data frames at the very beginning of this lesson, they
represent a table of data. We didn’t go much further into detail with
our example cat data frame:</p>
<div class="codewrapper sourceCode" id="cb118">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    coat weight likes_string
1 calico    2.1         TRUE
2  black    5.0        FALSE
3  tabby    3.2         TRUE</code></pre>
</div>
<p>これで、data.frameの驚くべき特徴を理解することができます。もし以下を走らせたらどうなるでしょう：</p>
<div class="codewrapper sourceCode" id="cb120">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="va">cats</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "list"</code></pre>
</div>
<p>We see that data.frames look like lists ‘under the hood’. Think again
what we heard about what lists can be used for:</p>
<blockquote>
<p>Lists organize data of different types</p>
</blockquote>
<p>Columns of a data frame are vectors of different types, that are
organized by belonging to the same table.</p>
<p>A data.frame is really a list of vectors. つまり、 ``
は、全てのベクトルの長さが同じでなければならない特別なリストなのです。</p>
<p>How is this “special”-ness written into the object, so that R does
not treat it like any other list, but as a table?</p>
<div class="codewrapper sourceCode" id="cb122">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">class</span><span class="op">(</span><span class="va">cats</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "data.frame"</code></pre>
</div>
<p>A <strong>class</strong>, just like names, is an attribute attached
to the object. It tells us what this object means for humans.</p>
<p>You might wonder: Why do we need another
what-type-of-object-is-this-function? We already have
<code>typeof()</code>? That function tells us how the object is
<strong>constructed in the computer</strong>. The <code>class</code> is
the <strong>meaning of the object for humans</strong>. Consequently,
what <code>typeof()</code> returns is <em>fixed</em> in R (mainly the
five data types), whereas the output of <code>class()</code> is
<em>diverse</em> and <em>extendable</em> by R packages.</p>
<p>我々の <code>cats</code>
の例では、整数型（integer）、浮動小数型（double）、論理型（logical）の変数があります。
既に見たように、data.frame のそれぞれの列はベクトルです。</p>
<div class="codewrapper sourceCode" id="cb124">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">$</span><span class="va">coat</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "calico" "black"  "tabby" </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb126">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "calico" "black"  "tabby" </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb128">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="va">cats</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "character"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb130">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">cats</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> chr [1:3] "calico" "black" "tabby"</code></pre>
</div>
<p>それぞれの行は、異なる変数の observation（観測値） であり、それ自体が
data.frame であるため、 異なる種類の要素で構成されることができます。</p>
<div class="codewrapper sourceCode" id="cb132">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    coat weight likes_string
1 calico    2.1         TRUE</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb134">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="va">cats</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "list"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb136">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">cats</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	1 obs. of  3 variables:
 $ coat        : chr "calico"
 $ weight      : num 2.1
 $ likes_string: logi TRUE</code></pre>
</div>
<div id="チャレンジ５" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ５" class="callout-inner">
<h3 class="callout-title">チャレンジ５</h3>
<div class="callout-content">
<p>There are several subtly different ways to call variables,
observations and elements from data.frames:</p>
<ul>
<li><code>cats[1]</code></li>
<li><code>cats[[1]]</code></li>
<li><code>cats$coat</code></li>
<li><code>cats["coat"]</code></li>
<li><code>cats[1, 1]</code></li>
<li><code>cats[, 1]</code></li>
<li><code>cats[1, ]</code></li>
</ul>
<p>Try out these examples and explain what is returned by each one.</p>
<p><em>Hint:</em> Use the function <code>typeof()</code> to examine what
is returned in each case.</p>
</div>
</div>
</div>
<div id="accordionSolution11" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution11" aria-expanded="false" aria-controls="collapseSolution11">
  <h4 class="accordion-header" id="headingSolution11">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution11" class="accordion-collapse collapse" aria-labelledby="headingSolution11" data-bs-parent="#accordionSolution11">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb138">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    coat
1 calico
2  black
3  tabby</code></pre>
</div>
<p>We can think of a data frame as a list of vectors. The single brace
<code>[1]</code> returns the first slice of the list, as another list.
In this case it is the first column of the data frame.</p>
<div class="codewrapper sourceCode" id="cb140">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "calico" "black"  "tabby" </code></pre>
</div>
<p>The double brace <code>[[1]]</code> returns the contents of the list
item. In this case it is the contents of the first column, a
<em>vector</em> of type <em>character</em>.</p>
<div class="codewrapper sourceCode" id="cb142">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">$</span><span class="va">coat</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "calico" "black"  "tabby" </code></pre>
</div>
<p>This example uses the <code>$</code> character to address items by
name. <em>coat</em> is the first column of the data frame, again a
<em>vector</em> of type <em>character</em>.</p>
<div class="codewrapper sourceCode" id="cb144">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">[</span><span class="st">"coat"</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    coat
1 calico
2  black
3  tabby</code></pre>
</div>
<p>Here we are using a single brace <code>["coat"]</code> replacing the
index number with the column name. Like example 1, the returned object
is a <em>list</em>.</p>
<div class="codewrapper sourceCode" id="cb146">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "calico"</code></pre>
</div>
<p>This example uses a single brace, but this time we provide row and
column coordinates. The returned object is the value in row 1, column 1.
The object is a <em>vector</em> of type <em>character</em>.</p>
<div class="codewrapper sourceCode" id="cb148">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "calico" "black"  "tabby" </code></pre>
</div>
<p>Like the previous example we use single braces and provide row and
column coordinates. The row coordinate is not specified, R interprets
this missing value as all the elements in this <em>column</em> and
returns them as a <em>vector</em>.</p>
<div class="codewrapper sourceCode" id="cb150">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    coat weight likes_string
1 calico    2.1         TRUE</code></pre>
</div>
<p>Again we use the single brace with row and column coordinates. The
column coordinate is not specified. The return value is a <em>list</em>
containing all the values in the first row.</p>
</div>
</div>
</div>
</div>
<div id="tip-renaming-data-frame-columns" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-renaming-data-frame-columns" class="callout-inner">
<h3 class="callout-title">Tip: Renaming data frame columns</h3>
<div class="callout-content">
<p>Data frames have column names, which can be accessed with the
<code>names()</code> function.</p>
<div class="codewrapper sourceCode" id="cb152">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">cats</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "coat"         "weight"       "likes_string"</code></pre>
</div>
<p>If you want to rename the second column of <code>cats</code>, you can
assign a new name to the second element of <code>names(cats)</code>.</p>
<div class="codewrapper sourceCode" id="cb154">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">cats</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"weight_kg"</span></span>
<span><span class="va">cats</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    coat weight_kg likes_string
1 calico       2.1         TRUE
2  black       5.0        FALSE
3  tabby       3.2         TRUE</code></pre>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="行列">行列<a class="anchor" aria-label="anchor" href="#%E8%A1%8C%E5%88%97"></a>
</h3>
<p>Last but not least is the matrix. We can declare a matrix full of
zeros:</p>
<div class="codewrapper sourceCode" id="cb156">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matrix_example</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">0</span>, ncol<span class="op">=</span><span class="fl">6</span>, nrow<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">matrix_example</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    0    0    0    0    0    0
[2,]    0    0    0    0    0    0
[3,]    0    0    0    0    0    0</code></pre>
</div>
<p>What makes it special is the <code>dim()</code> attribute:</p>
<div class="codewrapper sourceCode" id="cb158">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dim</span><span class="op">(</span><span class="va">matrix_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 3 6</code></pre>
</div>
<p>そして、他のデータ構造と同様に、行列に関することを尋ねることもできます：</p>
<div class="codewrapper sourceCode" id="cb160">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="va">matrix_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "double"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb162">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">class</span><span class="op">(</span><span class="va">matrix_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "matrix" "array" </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb164">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">matrix_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> num [1:3, 1:6] 0 0 0 0 0 0 0 0 0 0 ...</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb166">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nrow</span><span class="op">(</span><span class="va">matrix_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 3</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb168">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ncol</span><span class="op">(</span><span class="va">matrix_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 6</code></pre>
</div>
<div id="チャレンジ６" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ６" class="callout-inner">
<h3 class="callout-title">チャレンジ６</h3>
<div class="callout-content">
<p>What do you think will be the result of
<code>length(matrix_example)</code>? Try it. Were you right? Why / why
not?</p>
</div>
</div>
</div>
<div id="accordionSolution12" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution12" aria-expanded="false" aria-controls="collapseSolution12">
  <h4 class="accordion-header" id="headingSolution12">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution12" class="accordion-collapse collapse" aria-labelledby="headingSolution12" data-bs-parent="#accordionSolution12">
<div class="accordion-body">
<p>What do you think will be the result of
<code>length(matrix_example)</code>?</p>
<div class="codewrapper sourceCode" id="cb170">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matrix_example</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">0</span>, ncol<span class="op">=</span><span class="fl">6</span>, nrow<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu">length</span><span class="op">(</span><span class="va">matrix_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 18</code></pre>
</div>
<p>Because a matrix is a vector with added dimension attributes,
<code>length</code> gives you the total number of elements in the
matrix.</p>
</div>
</div>
</div>
</div>
<div id="チャレンジ７" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ７" class="callout-inner">
<h3 class="callout-title">チャレンジ７</h3>
<div class="callout-content">
<p>もう一つ行列を作ってみましょう、今回は、1:50の数を含むもので、
５行、10列を持つ行列にしましょう。 この <code>matrix</code>
関数は、デフォルトでは、行か列、どちらから 行列を埋めましたか？
これがどう変化したか理解したか確認してみましょう。 (hint: read the
documentation for <code>matrix</code>!)</p>
</div>
</div>
</div>
<div id="accordionSolution13" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution13" aria-expanded="false" aria-controls="collapseSolution13">
  <h4 class="accordion-header" id="headingSolution13">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution13" class="accordion-collapse collapse" aria-labelledby="headingSolution13" data-bs-parent="#accordionSolution13">
<div class="accordion-body">
<p>もう一つ行列を作ってみましょう、今回は、1:50の数を含むもので、
５行、10列を持つ行列にしましょう。 この <code>matrix</code>
関数は、デフォルトでは、行か列、どちらから 行列を埋めましたか？
これがどう変化したか理解したか確認してみましょう。 (hint: read the
documentation for <code>matrix</code>!)</p>
<div class="codewrapper sourceCode" id="cb172">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, ncol<span class="op">=</span><span class="fl">5</span>, nrow<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, ncol<span class="op">=</span><span class="fl">5</span>, nrow<span class="op">=</span><span class="fl">10</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># to fill by row</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="チャレンジ８" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ８" class="callout-inner">
<h3 class="callout-title">チャレンジ８</h3>
<div class="callout-content">
<p>ワークショップの現パート、それぞれのセクションのために、二つの文字型ベクトルが含まれるリストを作って下さい：</p>
<ul>
<li><p>データ型</p></li>
<li><p>Data structures</p></li>
<li><p>データ型 - データ構造
それぞれの文字ベクトルをこれまでみてきたデータ型と
データ構造で埋めてください。</p></li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution14" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution14" aria-expanded="false" aria-controls="collapseSolution14">
  <h4 class="accordion-header" id="headingSolution14">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution14" class="accordion-collapse collapse" aria-labelledby="headingSolution14" data-bs-parent="#accordionSolution14">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb173">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataTypes</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'double'</span>, <span class="st">'complex'</span>, <span class="st">'integer'</span>, <span class="st">'character'</span>, <span class="st">'logical'</span><span class="op">)</span></span>
<span><span class="va">dataStructures</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'data.frame'</span>, <span class="st">'vector'</span>, <span class="st">'list'</span>, <span class="st">'matrix'</span><span class="op">)</span></span>
<span><span class="va">answer</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span><span class="va">dataTypes</span>, <span class="va">dataStructures</span><span class="op">)</span></span></code></pre>
</div>
<p>Note: it’s nice to make a list in big writing on the board or taped
to the wall listing all of these types and structures - leave it up for
the rest of the workshop to remind people of the importance of these
basics.</p>
</div>
</div>
</div>
</div>
<div id="チャレンジ８-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ８-1" class="callout-inner">
<h3 class="callout-title">チャレンジ８</h3>
<div class="callout-content">
<p>Consider the R output of the matrix below:</p>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1] [,2]
[1,]    4    1
[2,]    9    5
[3,]   10    7</code></pre>
</div>
<p>この行列を書くために使ったコマンドは何でしたか？
それぞれのコマンドを確かめて、打ち込む前に正しいものが何か分かるようにしましょう。
他のコマンドでは、どのような行列が作られるかを考えてみましょう。</p>
<ol style="list-style-type: decimal">
<li><code>matrix(c(4, 1, 9, 5, 10, 7), nrow = 3)</code></li>
<li><code>matrix(c(4, 9, 10, 1, 5, 7), ncol = 2, byrow = TRUE)</code></li>
<li><code>matrix(c(4, 9, 10, 1, 5, 7), nrow = 2)</code></li>
<li><code>matrix(c(4, 1, 9, 5, 10, 7), ncol = 2, byrow = TRUE)</code></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution15" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution15" aria-expanded="false" aria-controls="collapseSolution15">
  <h4 class="accordion-header" id="headingSolution15">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution15" class="accordion-collapse collapse" aria-labelledby="headingSolution15" data-bs-parent="#accordionSolution15">
<div class="accordion-body">
<p>Consider the R output of the matrix below:</p>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1] [,2]
[1,]    4    1
[2,]    9    5
[3,]   10    7</code></pre>
</div>
<p>この行列を書くために使ったコマンドは何でしたか？
それぞれのコマンドを確かめて、打ち込む前に正しいものが何か分かるようにしましょう。
他のコマンドでは、どのような行列が作られるかを考えてみましょう。</p>
<div class="codewrapper sourceCode" id="cb176">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">matrix</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">9</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">7</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">まとめ</h3>
<div class="callout-content">
<ul>
<li>Use <code>read.csv</code> to read tabular data in R.</li>
<li>The basic data types in R are double, integer, complex, logical, and
character.</li>
<li>Data structures such as data frames or matrices are built on top of
lists and vectors, with some added attributes.</li>
</ul>
</div>
</div>
</div>
</div>
</section></section><section id="aio-05-data-structures-part2"><p>Content from <a href="05-data-structures-part2.html">Exploring Data Frames</a></p>
<hr>
<p>最終更新日：2024-10-12 |

        <a href="https://github.com/swcarpentry-ja/r-novice-gapminder/edit/main/episodes/05-data-structures-part2.Rmd" class="external-link">ページの編集 <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>所要時間：<i aria-hidden="true" data-feather="clock"></i> 30分</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="回答を全て表示する " data-collapse="回答を全て折りたたむ "> 回答を全て表示する <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">概要</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">質問</h3>
<ul>
<li>How can I manipulate a data frame?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">目的</h3>
<ul>
<li>Add and remove rows or columns.</li>
<li>データフレームへの追加.</li>
<li>Display basic properties of data frames including size and class of
the columns, names, and first few rows.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>At this point, you’ve seen it all: in the last lesson, we toured all
the basic data types and data structures in R. Everything you do will be
a manipulation of those tools.
しかし大抵の場合、主役はデータフレーム（CSVファイルから情報を読み込み作成した表）です。
このレッスンでは、データフレームを使ってどう作業していくかについて更に学んでいきましょう。</p>
<section><h2 class="section-heading" id="データフレームに行と列を追加する">データフレームに行と列を追加する<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%81%AB%E8%A1%8C%E3%81%A8%E5%88%97%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B"></a>
</h2>
<hr class="half-width">
<p>既に学んだとおり、データフレームの列はベクトルですから、列にあるデータには一貫性があります。
ですので、新しい列を加えたい場合は、新しいベクトルを作ることから始めることになります：</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">cats</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    coat weight likes_string
1 calico    2.1            1
2  black    5.0            0
3  tabby    3.2            1</code></pre>
</div>
<p>そして、これを以下を使って列に加えます：</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cbind</span><span class="op">(</span><span class="va">cats</span>, <span class="va">age</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    coat weight likes_string age
1 calico    2.1            1   2
2  black    5.0            0   3
3  tabby    3.2            1   5</code></pre>
</div>
<p>もし、データフレームの行の数と一致しない年齢のベクトルを追加しようとすると、失敗します：</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">12</span><span class="op">)</span></span>
<span><span class="fu">cbind</span><span class="op">(</span><span class="va">cats</span>, <span class="va">age</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in data.frame(..., check.names = FALSE): arguments imply differing number of rows: 3, 4</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu">cbind</span><span class="op">(</span><span class="va">cats</span>, <span class="va">age</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in data.frame(..., check.names = FALSE): arguments imply differing number of rows: 3, 2</code></pre>
</div>
<p>Why didn’t this work?
なぜダメだったのでしょうか？もちろん、Rは新しい列のひとつの要素を、表の中にある全ての行について参照したがるものです。</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nrow</span><span class="op">(</span><span class="va">cats</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 3</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">length</span><span class="op">(</span><span class="va">age</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2</code></pre>
</div>
<p>So for it to work we need to have <code>nrow(cats)</code> =
<code>length(age)</code>. Let’s overwrite the content of cats with our
new data frame.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">cats</span> <span class="op">&lt;-</span> <span class="fu">cbind</span><span class="op">(</span><span class="va">cats</span>, <span class="va">age</span><span class="op">)</span></span></code></pre>
</div>
<p>Now how about adding rows? We already know that the rows of a data
frame are lists:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">newRow</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span><span class="st">"tortoiseshell"</span>, <span class="fl">3.3</span>, <span class="cn">TRUE</span>, <span class="fl">9</span><span class="op">)</span></span>
<span><span class="va">cats</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span><span class="va">cats</span>, <span class="va">newRow</span><span class="op">)</span></span></code></pre>
</div>
<p>Let’s confirm that our new row was added correctly.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>           coat weight likes_string age
1        calico    2.1            1   2
2         black    5.0            0   3
3         tabby    3.2            1   5
4 tortoiseshell    3.3            1   9</code></pre>
</div>
</section><section><h2 class="section-heading" id="行の削除">行の削除<a class="anchor" aria-label="anchor" href="#%E8%A1%8C%E3%81%AE%E5%89%8A%E9%99%A4"></a>
</h2>
<hr class="half-width">
<p>We now know how to add rows and columns to our data frame in R. Now
let’s learn to remove rows.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>           coat weight likes_string age
1        calico    2.1            1   2
2         black    5.0            0   3
3         tabby    3.2            1   5
4 tortoiseshell    3.3            1   9</code></pre>
</div>
<p>この問題の行を除くようにデータフレームに頼みましょう：</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">[</span><span class="op">-</span><span class="fl">4</span>, <span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    coat weight likes_string age
1 calico    2.1            1   2
2  black    5.0            0   3
3  tabby    3.2            1   5</code></pre>
</div>
<p>コンマの後に何もないのは、４番目の行の全部を削除して欲しいということを示している点に留意しましょう。</p>
<p>注意：ベクトルの中に行番号を入れれば、新しく追加した行を両方削除することもできす：<code>cats[c(-3,-4), ]</code></p>
</section><section><h2 class="section-heading" id="列の削除">列の削除<a class="anchor" aria-label="anchor" href="#%E5%88%97%E3%81%AE%E5%89%8A%E9%99%A4"></a>
</h2>
<hr class="half-width">
<p>We can also remove columns in our data frame. What if we want to
remove the column “age”. We can remove it in two ways, by variable
number or by index.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span><span class="op">[</span>,<span class="op">-</span><span class="fl">4</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>           coat weight likes_string
1        calico    2.1            1
2         black    5.0            0
3         tabby    3.2            1
4 tortoiseshell    3.3            1</code></pre>
</div>
<p>全ての行を持っていたいということを示すため、コンマの前に何も入っていない点に留意しましょう。</p>
<p>または、要素番号の名前を使って列を削除することもできます： The
<code>%in%</code> operator goes through each element of its left
argument, in this case the names of <code>cats</code>, and asks, “Does
this element occur in the second argument?”</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">drop</span> <span class="op">&lt;-</span> <span class="fu">names</span><span class="op">(</span><span class="va">cats</span><span class="op">)</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="st">"age"</span><span class="op">)</span></span>
<span><span class="va">cats</span><span class="op">[</span>,<span class="op">!</span><span class="va">drop</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>           coat weight likes_string
1        calico    2.1            1
2         black    5.0            0
3         tabby    3.2            1
4 tortoiseshell    3.3            1</code></pre>
</div>
<p>We will cover subsetting with logical operators like
<code>%in%</code> in more detail in the next episode. See the section <a href="06-data-subsetting.html">Subsetting through other logical
operations</a></p>
</section><section><h2 class="section-heading" id="データフレームへの追加">データフレームへの追加<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%81%B8%E3%81%AE%E8%BF%BD%E5%8A%A0"></a>
</h2>
<hr class="half-width">
<p>データフレームにデータを加えるときに覚えておくべき重要なことは、
列はベクトルで、行はリスト であることです。 ２つのデータフレームを
<code>rbind</code> を使ってくっつけることもできます：</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cats</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span><span class="va">cats</span>, <span class="va">cats</span><span class="op">)</span></span>
<span><span class="va">cats</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>           coat weight likes_string age
1        calico    2.1            1   2
2         black    5.0            0   3
3         tabby    3.2            1   5
4 tortoiseshell    3.3            1   9
5        calico    2.1            1   2
6         black    5.0            0   3
7         tabby    3.2            1   5
8 tortoiseshell    3.3            1   9</code></pre>
</div>
<div id="チャレンジ１" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ１" class="callout-inner">
<h3 class="callout-title">チャレンジ１</h3>
<div class="callout-content">
<p>You can create a new data frame right from within R with the
following syntax:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span>id <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span><span class="op">)</span>,</span>
<span>                 x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,</span>
<span>                 y <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Make a data frame that holds the following information for
yourself:</p>
<ul>
<li>first name</li>
<li>last name</li>
<li>lucky number</li>
</ul>
<p>Then use <code>rbind</code> to add an entry for the people sitting
beside you. Finally, use <code>cbind</code> to add a column with each
person’s answer to the question, “Is it time for coffee break?”</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span>first <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"Grace"</span><span class="op">)</span>,</span>
<span>                 last <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"Hopper"</span><span class="op">)</span>,</span>
<span>                 lucky_number <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span><span class="va">df</span>, <span class="fu">list</span><span class="op">(</span><span class="st">"Marie"</span>, <span class="st">"Curie"</span>, <span class="fl">238</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">cbind</span><span class="op">(</span><span class="va">df</span>, coffeetime <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="現実的な例">現実的な例<a class="anchor" aria-label="anchor" href="#%E7%8F%BE%E5%AE%9F%E7%9A%84%E3%81%AA%E4%BE%8B"></a>
</h2>
<hr class="half-width">
<p>So far, you have seen the basics of manipulating data frames with our
cat data; now let’s use those skills to digest a more realistic dataset.
Let’s read in the <code>gapminder</code> dataset that we downloaded
previously:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/gapminder_data.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div id="いろいろなヒント" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="いろいろなヒント" class="callout-inner">
<h3 class="callout-title">いろいろなヒント</h3>
<div class="callout-content">
<ul>
<li><p>Another type of file you might encounter are tab-separated value
files (.tsv). To specify a tab as a separator, use <code>"\\t"</code> or
<code>read.delim()</code>.</p></li>
<li><p>Files can also be downloaded directly from the Internet into a
local folder of your choice onto your computer using the
<code>download.file</code> function. The <code>read.csv</code> function
can then be executed to read the downloaded file from the download
location, for example,</p></li>
</ul>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">download.file</span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/swcarpentry/r-novice-gapminder/main/episodes/data/gapminder_data.csv"</span>, destfile <span class="op">=</span> <span class="st">"data/gapminder_data.csv"</span><span class="op">)</span></span>
<span><span class="va">gapminder</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/gapminder_data.csv"</span><span class="op">)</span></span></code></pre>
</div>
<ul>
<li>Alternatively, you can also read in files directly into R from the
Internet by replacing the file paths with a web address in
<code>read.csv</code>. One should note that in doing this no local copy
of the csv file is first saved onto your computer. 例えば：</li>
</ul>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/swcarpentry/r-novice-gapminder/main/episodes/data/gapminder_data.csv"</span><span class="op">)</span></span></code></pre>
</div>
<ul>
<li><p>You can read directly from excel spreadsheets without converting
them to plain text first by using the <a href="https://cran.r-project.org/package=readxl" class="external-link">readxl</a>
package.</p></li>
<li><p>The argument “stringsAsFactors” can be useful to tell R how to
read strings either as factors or as character strings. In R versions
after 4.0, all strings are read-in as characters by default, but in
earlier versions of R, strings are read-in as factors by default. For
more information, see the call-out in <a href="https://swcarpentry.github.io/r-novice-gapminder/04-data-structures-part1.html#check-your-data-for-factors" class="external-link">the
previous episode</a>.</p></li>
</ul>
</div>
</div>
</div>
<p>gapminderを少し見てみましょう。いつも、まずしなければいけないことは、
データがどうなっているかを<code>str</code>で見てみることです：</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	1704 obs. of  6 variables:
 $ country  : chr  "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" ...
 $ year     : int  1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ pop      : num  8425333 9240934 10267083 11537966 13079460 ...
 $ continent: chr  "Asia" "Asia" "Asia" "Asia" ...
 $ lifeExp  : num  28.8 30.3 32 34 36.1 ...
 $ gdpPercap: num  779 821 853 836 740 ...</code></pre>
</div>
<p>An additional method for examining the structure of gapminder is to
use the <code>summary</code> function. This function can be used on
various objects in R. For data frames, <code>summary</code> yields a
numeric, tabular, or descriptive summary of each column. Numeric or
integer columns are described by the descriptive statistics (quartiles
and mean), and character columns by its length, class, and mode.</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   country               year           pop             continent
 Length:1704        Min.   :1952   Min.   :6.001e+04   Length:1704
 Class :character   1st Qu.:1966   1st Qu.:2.794e+06   Class :character
 Mode  :character   Median :1980   Median :7.024e+06   Mode  :character
                    Mean   :1980   Mean   :2.960e+07
                    3rd Qu.:1993   3rd Qu.:1.959e+07
                    Max.   :2007   Max.   :1.319e+09
    lifeExp        gdpPercap
 Min.   :23.60   Min.   :   241.2
 1st Qu.:48.20   1st Qu.:  1202.1
 Median :60.71   Median :  3531.8
 Mean   :59.47   Mean   :  7215.3
 3rd Qu.:70.85   3rd Qu.:  9325.5
 Max.   :82.60   Max.   :113523.1  </code></pre>
</div>
<p>Along with the <code>str</code> and <code>summary</code> functions,
we can examine individual columns of the data frame with our
<code>typeof</code> function:</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "integer"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">country</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "character"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">country</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> chr [1:1704] "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" ...</code></pre>
</div>
<p>データフレームの次元について見てみることもできます。
<code>str(gapminder)</code>
が、gapminderには、6変数について1704の観測値があると言っていたことを念頭に置き、
以下から何が出てくると思いますか？それはなぜですか？</p>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">length</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 6</code></pre>
</div>
<p>予想としては、データフレームの長さは行数（1704）だと思うものですが、実はそうではありません。
データフレームは、 ベクトルと順序なし因子型のリストである
ということを思い出しましょう：</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">typeof</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "list"</code></pre>
</div>
<p><code>length</code>が、6と返ってくるのは、gapminderは、6つの列のリストから成っているからです。
データセットで、行と列の数を知るためには、こうしてみましょう：</p>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nrow</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1704</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ncol</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 6</code></pre>
</div>
<p>または、両方を同時に：</p>
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dim</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1704    6</code></pre>
</div>
<p>全ての列のタイトルを知りたいと思うことも多いと思うので、後で聞いてみましょう：</p>
<div class="codewrapper sourceCode" id="cb52">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">colnames</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "country"   "year"      "pop"       "continent" "lifeExp"   "gdpPercap"</code></pre>
</div>
<p>この段階で、Rが伝える構造が自分の直感や予想と合っているかを自問することが大切です。
それぞれの列の基本的なデータ型は、思った通りのデータ型になってますか？もしなっていないのなら、今後、予想外の事態を引き起こさないように、
今の時点で、問題を解決しておく必要があります。そのためには、これまでに学んだ、Rがどのようにデータを解釈するか、
そしてデータを記録する際の 厳格な整合性
の重要性といった知識を活かしましょう。</p>
<p>データ型と構造に満足することができたら、データを詳しく見始めることができます。
最初のいくつかの行を見てみましょう：</p>
<div class="codewrapper sourceCode" id="cb54">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      country year      pop continent lifeExp gdpPercap
1 Afghanistan 1952  8425333      Asia  28.801  779.4453
2 Afghanistan 1957  9240934      Asia  30.332  820.8530
3 Afghanistan 1962 10267083      Asia  31.997  853.1007
4 Afghanistan 1967 11537966      Asia  34.020  836.1971
5 Afghanistan 1972 13079460      Asia  36.088  739.9811
6 Afghanistan 1977 14880372      Asia  38.438  786.1134</code></pre>
</div>
<div id="チャレンジ２" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ２" class="callout-inner">
<h3 class="callout-title">チャレンジ２</h3>
<div class="callout-content">
<p>It’s good practice to also check the last few lines of your data and
some in the middle. How would you do this?</p>
<p>Searching for ones specifically in the middle isn’t too hard, but we
could ask for a few lines at random. How would you code this?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>To check the last few lines it’s relatively simple as R already has a
function for this:</p>
<div class="codewrapper sourceCode" id="cb56">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tail</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span>
<span><span class="fu">tail</span><span class="op">(</span><span class="va">gapminder</span>, n <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span></code></pre>
</div>
<p>What about a few arbitrary rows just in case something is odd in the
middle?</p>
<div class="section level2">
<h2 id="tip-there-are-several-ways-to-achieve-this-">Tip: There are several ways to achieve this.<a class="anchor" aria-label="anchor" href="#tip-there-are-several-ways-to-achieve-this-"></a>
</h2>
<p>The solution here presents one form of using nested functions, i.e. a
function passed as an argument to another function. This might sound
like a new concept, but you are already using it! Remember
my_dataframe[rows, cols] will print to screen your data frame with the
number of rows and columns you asked for (although you might have asked
for a range or named columns for example). How would you get the last
row if you don’t know how many rows your data frame has? R has a
function for this. What about getting a (pseudorandom) sample? R also
has a function for this.</p>
<div class="codewrapper sourceCode" id="cb57">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">[</span><span class="fu">sample</span><span class="op">(</span><span class="fu">nrow</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span>, <span class="op">]</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<p>分析を再現可能にするためには、後で使えるようにコードをスクリプトファイルに置く必要があります。</p>
<div id="チャレンジ３" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ３" class="callout-inner">
<h3 class="callout-title">チャレンジ３</h3>
<div class="callout-content">
<p>Go to file -&gt; new file -&gt; R script, and write an R script to
load in the gapminder dataset. Put it in the <code>scripts/</code>
directory and add it to version control.</p>
<p>Run the script using the <code>source</code> function, using the file
path as its argument (or by pressing the “source” button in
RStudio).</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>The <code>source</code> function can be used to use a script within a
script. Assume you would like to load the same type of file over and
over again and therefore you need to specify the arguments to fit the
needs of your file. Instead of writing the necessary argument again and
again you could just write it once and save it as a script. Then, you
can use <code>source("Your_Script_containing_the_load_function")</code>
in a new script to use the function of that script without writing
everything again. Check out <code>?source</code> to find out more.</p>
<div class="codewrapper sourceCode" id="cb58">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">download.file</span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/swcarpentry/r-novice-gapminder/main/episodes/data/gapminder_data.csv"</span>, destfile <span class="op">=</span> <span class="st">"data/gapminder_data.csv"</span><span class="op">)</span></span>
<span><span class="va">gapminder</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span>file <span class="op">=</span> <span class="st">"data/gapminder_data.csv"</span><span class="op">)</span></span></code></pre>
</div>
<p>To run the script and load the data into the <code>gapminder</code>
variable:</p>
<div class="codewrapper sourceCode" id="cb59">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">source</span><span class="op">(</span>file <span class="op">=</span> <span class="st">"scripts/load-gapminder.R"</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="チャレンジ４" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ４" class="callout-inner">
<h3 class="callout-title">チャレンジ４</h3>
<div class="callout-content">
<p><code>str(gapminder)</code> の結果を再び読みましょう。
今度は、順序なし因数、リスト、ベクトルについて学んだことを使いましょう。</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>The object <code>gapminder</code> is a data frame with columns</p>
<ul>
<li>
<code>country</code> and <code>continent</code> are character
strings.</li>
<li>理解できないところがあれば、近くの人と話し合ってみましょう。</li>
<li>チャレンジ５の解答 <code>gapminder</code>
というオブジェクトは、データフレームで、 - <code>country</code> と
<code>continent</code> という順序なし因子型、 - <code>year</code>
という整数型のベクトル、 - <code>pop</code>、 <code>lifeExp</code>、
<code>gdpPercap</code> という数値型のベクトルの行を持っています。</li>
</ul>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">まとめ</h3>
<div class="callout-content">
<ul>
<li>Use <code>cbind()</code> to add a new column to a data frame.</li>
<li>Use <code>rbind()</code> to add a new row to a data frame.</li>
<li>Remove rows from a data frame.</li>
<li>Use <code>str()</code>, <code>summary()</code>, <code>nrow()</code>,
<code>ncol()</code>, <code>dim()</code>, <code>colnames()</code>,
<code>head()</code>, and <code>typeof()</code> to understand the
structure of a data frame.</li>
<li>Read in a csv file using <code>read.csv()</code>.</li>
<li>Understand what <code>length()</code> of a data frame
represents.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-06-data-subsetting"><p>Content from <a href="06-data-subsetting.html">Subsetting Data</a></p>
<hr>
<p>最終更新日：2024-10-12 |

        <a href="https://github.com/swcarpentry-ja/r-novice-gapminder/edit/main/episodes/06-data-subsetting.Rmd" class="external-link">ページの編集 <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>所要時間：<i aria-hidden="true" data-feather="clock"></i> 50分</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="回答を全て表示する " data-collapse="回答を全て折りたたむ "> 回答を全て表示する <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">概要</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">質問</h3>
<ul>
<li>How can I work with subsets of data in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">目的</h3>
<ul>
<li>To be able to subset vectors, factors, matrices, lists, and data
frames</li>
<li>To be able to extract individual and multiple elements: by index, by
name, using comparison operations</li>
<li>To be able to skip and remove elements from various data
structures.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>R has many powerful subset operators. Mastering them will allow you
to easily perform complex operations on any kind of dataset.</p>
<p>オブジェクトを部分集合する方法は６つあり、データ構造を
部分集合する方法は３つあります。</p>
<p>Rの働き頭、数値ベクトルから始めましょう。</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">5.4</span>, <span class="fl">6.2</span>, <span class="fl">7.1</span>, <span class="fl">4.8</span>, <span class="fl">7.5</span><span class="op">)</span></span>
<span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>, <span class="st">'e'</span><span class="op">)</span></span>
<span><span class="va">x</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   b   c   d   e
5.4 6.2 7.1 4.8 7.5 </code></pre>
</div>
<div id="原子ベクトル" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="原子ベクトル" class="callout-inner">
<h3 class="callout-title">原子ベクトル</h3>
<div class="callout-content">
<p>Rでは、文字列、数値、論理値を含む単純なベクトルは、 原子（atomic）
ベクトルと呼ばれています。その理由は、原子ベクトルはそれ以上単純化できないからです。</p>
</div>
</div>
</div>
<p>練習用のベクトルを作ることができたのですが、どうやってベクトルの中身を使うのでしょう？</p>
<section><h2 class="section-heading" id="要素番号で要素を使う">要素番号で要素を使う<a class="anchor" aria-label="anchor" href="#%E8%A6%81%E7%B4%A0%E7%95%AA%E5%8F%B7%E3%81%A7%E8%A6%81%E7%B4%A0%E3%82%92%E4%BD%BF%E3%81%86"></a>
</h2>
<hr class="half-width">
<p>ベクトルの要素を抽出するためには、対応する１から始まる要素番号を使います：</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span>  <span class="va">a</span></span>
<span><span class="fl">5.4</span> </span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span>  <span class="va">d</span></span>
<span><span class="fl">4.8</span> </span></code></pre>
</div>
<p>It may look different, but the square brackets operator is a
function. For vectors (and matrices), it means “get me the nth
element”.</p>
<p>複数の要素を一度に頼むこともできます：</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   c
5.4 7.1 </code></pre>
</div>
<p>または、ベクトルのスライスを頼むこともできます：</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   b   c   d
5.4 6.2 7.1 4.8 </code></pre>
</div>
<p>この <code>:</code>
演算子は、左から右の要素の一連番号を作ります。</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1 2 3 4</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1 2 3 4</code></pre>
</div>
<p>同じ要素を何度も頼むこともできます：</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   a   c
5.4 5.4 7.1 </code></pre>
</div>
<p>もしベクトルの長さ以上の要素番号を頼んだ場合、Rは欠測値を返します：</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;NA&gt;
  NA </code></pre>
</div>
<p>これは、 <code>NA</code> を含む、<code>NA</code>
という名前の長さ１のベクトルです。</p>
<p>もし、0番目の要素を頼んだ場合、空ベクトルが返ってきます：</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>named numeric(0)</code></pre>
</div>
<div id="rのベクトル番号は１から始まる" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="rのベクトル番号は１から始まる" class="callout-inner">
<h3 class="callout-title">Rのベクトル番号は、１から始まる</h3>
<div class="callout-content">
<p>多くのプログラミング言語（例えば、C、Python）では、ベクトルの最初の
要素の要素番号は０です。Rでは、最初の要素番号は１です。 In R, the first
element is 1.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="要素を飛ばす削除する">要素を飛ばす、削除する<a class="anchor" aria-label="anchor" href="#%E8%A6%81%E7%B4%A0%E3%82%92%E9%A3%9B%E3%81%B0%E3%81%99%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B"></a>
</h2>
<hr class="half-width">
<p>もし、負の番号をベクトルの要素番号として使った場合、Rは指定された番号
以外の 全ての要素を返します：</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="fl">2</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   c   d   e
5.4 7.1 4.8 7.5 </code></pre>
</div>
<p>複数の要素を飛ばすこともできます：</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">5</span><span class="op">)</span><span class="op">]</span>  <span class="co"># or x[-c(1,5)]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  b   c   d
6.2 7.1 4.8 </code></pre>
</div>
<div id="ヒント演算の順番" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント演算の順番" class="callout-inner">
<h3 class="callout-title">ヒント：演算の順番</h3>
<div class="callout-content">
<p>初心者によく見られるのが、ベクトルのスライスを飛ばそうとする時に起こる間違いです。
It’s natural to try to negate a sequence like so:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span></code></pre>
</div>
<p>This gives a somewhat cryptic error:</p>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in x[-1:3]: only 0's may be mixed with negative subscripts</code></pre>
</div>
<p>演算の順番を思い出してみましょう。<code>:</code>
は、実際には関数なのです。
最初の引数を-1、次の引数を3として認識し、次のような数列を生成します。
<code>c(-1, 0, 1, 2, 3)</code>
正解は、関数を呼ぶ部分を括弧で囲むことです。</p>
<p>そうすると関数の結果全てに<code>-</code> の演算子が適応されます： ~~~
x[-(:)] ~~~ ~~~ d e:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  d   e
4.8 7.5 </code></pre>
</div>
</div>
</div>
</div>
<p>ベクトルから要素を削除するには、結果を変数に戻してやる必要があります。</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">x</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   b   c   e
5.4 6.2 7.1 7.5 </code></pre>
</div>
<div id="チャレンジ１" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ１" class="callout-inner">
<h3 class="callout-title">チャレンジ１</h3>
<div class="callout-content">
<p>以下のリストがあるとします：</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">5.4</span>, <span class="fl">6.2</span>, <span class="fl">7.1</span>, <span class="fl">4.8</span>, <span class="fl">7.5</span><span class="op">)</span></span>
<span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>, <span class="st">'e'</span><span class="op">)</span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   b   c   d   e
5.4 6.2 7.1 4.8 7.5 </code></pre>
</div>
<p>以下の出力を得るために、少なくとも２つの異なるコマンドを考えてください：
~~~ b c d:</p>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  b   c   d
6.2 7.1 4.8 </code></pre>
</div>
<p>After you find 2 different commands, compare notes with your
neighbour. Did you have different strategies?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  チャレンジ８の解答 1
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  b   c   d
6.2 7.1 4.8 </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  b   c   d
6.2 7.1 4.8 </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  b   c   d
6.2 7.1 4.8 </code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="名前で部分集合を作る">名前で部分集合を作る<a class="anchor" aria-label="anchor" href="#%E5%90%8D%E5%89%8D%E3%81%A7%E9%83%A8%E5%88%86%E9%9B%86%E5%90%88%E3%82%92%E4%BD%9C%E3%82%8B"></a>
</h2>
<hr class="half-width">
<p>要素番号で抜き出す代わりに、名前で要素を抽出することもできます。</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span>a<span class="op">=</span><span class="fl">5.4</span>, b<span class="op">=</span><span class="fl">6.2</span>, c<span class="op">=</span><span class="fl">7.1</span>, d<span class="op">=</span><span class="fl">4.8</span>, e<span class="op">=</span><span class="fl">7.5</span><span class="op">)</span> <span class="co"># ベクトルを'その場で'名づけることができます x[c("a", "c")]</span></span></code></pre>
</div>
<p>オブジェクトの部分集合を作るには、この方法の方が確実です：要素の場所は、
部分集合の演算子を繋いで使うことでよく変わるのですが、
名前は絶対に変わりません。</p>
</section><section><h2 class="section-heading" id="logical-operations">Subsetting through other logical operations<a class="anchor" aria-label="anchor" href="#logical-operations"></a>
</h2>
<hr class="half-width">
<p>どんな論理ベクトルでも部分集合を作ることができます：</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  c   e
7.1 7.5 </code></pre>
</div>
<p>つまり、以下の宣言は、前と同じ結果を返します。</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">7</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  c   e
7.1 7.5 </code></pre>
</div>
<p>分割すると、この宣言は最初に <code>x 7</code> を計算し、論理ベクトル
<code>c(FALSE, FALSE, TRUE, FALSE, TRUE)</code> を作ります。それから、
<code>TRUE</code> の値に対応する要素を <code>x</code>
から選択しています。</p>
<p>名前で特定するという既出の方法を真似するため、 <code>==</code>
を使うこともできます。 （比較には、 <code>=</code> ではなく、
<code>==</code> を使わないといけません）：</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">==</span> <span class="st">"a"</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span>  <span class="va">a</span></span>
<span><span class="fl">5.4</span> </span></code></pre>
</div>
<div id="ヒント論理条件を組み合わせる" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント論理条件を組み合わせる" class="callout-inner">
<h3 class="callout-title">ヒント：論理条件を組み合わせる</h3>
<div class="callout-content">
<p>We often want to combine multiple logical criteria. For example, we
might want to find all the countries that are located in Asia
<strong>or</strong> Europe <strong>and</strong> have life expectancies
within a certain range. Several operations for combining logical vectors
exist in R:</p>
<ul>
<li>
<code>&amp;</code>, the “logical AND” operator: returns
<code>TRUE</code> if both the left and right are <code>TRUE</code>.</li>
<li>
<code>|</code>, the “logical OR” operator: returns
<code>TRUE</code>, if either the left or right (or both) are
<code>TRUE</code>.</li>
</ul>
<p>You may sometimes see <code>&amp;&amp;</code> and <code>||</code>
instead of <code>&amp;</code> and <code>|</code>. These two-character
operators only look at the first element of each vector and ignore the
remaining elements. In general you should not use the two-character
operators in data analysis; save them for programming, i.e. deciding
whether to execute a statement.</p>
<ul>
<li>
<code>!</code>, the “logical NOT” operator: converts
<code>TRUE</code> to <code>FALSE</code> and <code>FALSE</code> to
<code>TRUE</code>. It can negate a single logical condition (eg
<code>!TRUE</code> becomes <code>FALSE</code>), or a whole vector of
conditions(eg <code>!c(TRUE, FALSE)</code> becomes
<code>c(FALSE, TRUE)</code>).</li>
</ul>
<p>Additionally, you can compare the elements within a single vector
using the <code>all</code> function (which returns <code>TRUE</code> if
every element of the vector is <code>TRUE</code>) and the
<code>any</code> function (which returns <code>TRUE</code> if one or
more elements of the vector are <code>TRUE</code>).</p>
</div>
</div>
</div>
<div id="チャレンジ２" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ２" class="callout-inner">
<h3 class="callout-title">チャレンジ２</h3>
<div class="callout-content">
<p>以下のリストがあるとします：</p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">5.4</span>, <span class="fl">6.2</span>, <span class="fl">7.1</span>, <span class="fl">4.8</span>, <span class="fl">7.5</span><span class="op">)</span></span>
<span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>, <span class="st">'e'</span><span class="op">)</span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   b   c   d   e
5.4 6.2 7.1 4.8 7.5 </code></pre>
</div>
<p>4よりも大きく7より小さいxの値を返す部分集合を作るコマンドを書きましょう。</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  チャレンジ８の解答
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_subset</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">x</span><span class="op">&lt;</span><span class="fl">7</span> <span class="op">&amp;</span> <span class="va">x</span><span class="op">&gt;</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="va">x_subset</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   b   d
5.4 6.2 4.8 </code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="ヒント同じ名前がある場合" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント同じ名前がある場合" class="callout-inner">
<h3 class="callout-title">ヒント：同じ名前がある場合</h3>
<div class="callout-content">
<p>You should be aware that it is possible for multiple elements in a
vector to have the same name. (For a data frame, columns can have the
same name — although R tries to avoid this — but row names must be
unique.) Consider these examples:</p>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span></span>
<span><span class="va">x</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1 2 3</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'a'</span>, <span class="st">'a'</span><span class="op">)</span></span>
<span><span class="va">x</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>a a a
1 2 3 </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb55">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="st">'a'</span><span class="op">]</span>  <span class="co"># only returns first value</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">a</span></span>
<span><span class="fl">1</span> </span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb57">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">==</span> <span class="st">'a'</span><span class="op">]</span>  <span class="co"># returns all three values</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>a a a
1 2 3 </code></pre>
</div>
</div>
</div>
</div>
<div id="ヒント演算子についてのヘルプを見る" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント演算子についてのヘルプを見る" class="callout-inner">
<h3 class="callout-title">ヒント：演算子についてのヘルプを見る</h3>
<div class="callout-content">
<p>演算子を引用符で囲むことで、演算子についてのヘルプを検索できることを覚えておきましょう：
<code>help("%in%")</code> または <code>?"%in%"</code>.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="名前のある要素を飛ばす">名前のある要素を飛ばす<a class="anchor" aria-label="anchor" href="#%E5%90%8D%E5%89%8D%E3%81%AE%E3%81%82%E3%82%8B%E8%A6%81%E7%B4%A0%E3%82%92%E9%A3%9B%E3%81%B0%E3%81%99"></a>
</h2>
<hr class="half-width">
<p>Skipping or removing named elements is a little harder.
名前のある要素を飛ばしたり削除したりすることは少しだけ難しくなります。もし、ある文字列にマイナス記号を付けて飛ばそうとすると、Rは文字列にマイナス記号を付ける方法を知らないと（若干控えめに）抗議するでしょう：</p>
<div class="codewrapper sourceCode" id="cb59">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span>a<span class="op">=</span><span class="fl">5.4</span>, b<span class="op">=</span><span class="fl">6.2</span>, c<span class="op">=</span><span class="fl">7.1</span>, d<span class="op">=</span><span class="fl">4.8</span>, e<span class="op">=</span><span class="fl">7.5</span><span class="op">)</span> <span class="co"># まず、ベクトルにその場で名前を付けることから始めます x[-"a"]</span></span></code></pre>
</div>
<p>でも、<code>!=</code>
（不等号）演算子を使えば、やってもらいたかったことをしてくれる論理ベクトルが作れます：</p>
<div class="codewrapper sourceCode" id="cb60">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"a"</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  b   c   d   e
6.2 7.1 4.8 7.5 </code></pre>
</div>
<p>Skipping multiple named indices is a little bit harder still. Suppose
we want to drop the <code>"a"</code> and <code>"c"</code> elements, so
we try this:</p>
<div class="codewrapper sourceCode" id="cb62">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">!=</span><span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"c"</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">警告<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning in names(x) != c("a", "c"): longer object length is not a multiple of
shorter object length</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  b   c   d   e
6.2 7.1 4.8 7.5 </code></pre>
</div>
<p>Rは 何か
をしたのですが、私達が注目しなければならない警告も出しました。結果としては、どうやら
間違った回答 が帰ってきたみたいです（<code>"c"</code>
の要素が、ベクトルに含まれています）！</p>
<p>So what does <code>!=</code> actually do in this case? That’s an
excellent question.</p>
<div class="section level3">
<h3 id="再利用">再利用<a class="anchor" aria-label="anchor" href="#%E5%86%8D%E5%88%A9%E7%94%A8"></a>
</h3>
<p>このコードの比較する部分を見てみましょう：</p>
<div class="codewrapper sourceCode" id="cb65">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">!=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"c"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">警告<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning in names(x) != c("a", "c"): longer object length is not a multiple of
shorter object length</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] FALSE  TRUE  TRUE  TRUE  TRUE</code></pre>
</div>
<p>Rは、<code>names(x)[3] != "c"</code>
が明らかに間違いであるときに、このベクトルの３番目の要素をなぜ<code>TRUE</code>
にしたのでしょうか。 <code>!=</code>
を使うとき、Rは左側の引数のそれぞれの要素を右側のそれぞれの要素と比較しようとします。
違う長さのベクトルを比較しようとすると、何が起こるのでしょう？</p>
<figure><img src="../fig/06-rmd-inequality.1.png" alt="Inequality testing" class="figure mx-auto d-block"></figure><p>もし、もう一つのベクトルよりも短いベクトルがあったとき、そのベクトルは
再利用されます ：</p>
<figure><img src="../fig/06-rmd-inequality.2.png" alt="Inequality testing: results of recycling" class="figure mx-auto d-block"></figure><p>In this case R <strong>repeats</strong> <code>c("a", "c")</code> as
many times as necessary to match <code>names(x)</code>, i.e. we get
<code>c("a","c","a","c","a")</code>. Since the recycled <code>"a"</code>
doesn’t match the third element of <code>names(x)</code>, the value of
<code>!=</code> is <code>TRUE</code>. Because in this case the longer
vector length (5) isn’t a multiple of the shorter vector length (2), R
printed a warning message. If we had been unlucky and
<code>names(x)</code> had contained six elements, R would
<em>silently</em> have done the wrong thing (i.e., not what we intended
it to do). This recycling rule can can introduce hard-to-find and subtle
bugs!</p>
<p>The way to get R to do what we really want (match <em>each</em>
element of the left argument with <em>all</em> of the elements of the
right argument) it to use the <code>%in%</code> operator. The
<code>%in%</code> operator goes through each element of its left
argument, in this case the names of <code>x</code>, and asks, “Does this
element occur in the second argument?”. Here, since we want to
<em>exclude</em> values, we also need a <code>!</code> operator to
change “in” to “not in”:</p>
<div class="codewrapper sourceCode" id="cb68">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="op">!</span> <span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"c"</span><span class="op">)</span> <span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  b   d   e
6.2 4.8 7.5 </code></pre>
</div>
<div id="チャレンジ３" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ３" class="callout-inner">
<h3 class="callout-title">チャレンジ３</h3>
<div class="callout-content">
<p>Selecting elements of a vector that match any of a list of components
is a very common data analysis task. For example, the gapminder data set
contains <code>country</code> and <code>continent</code> variables, but
no information between these two scales. Suppose we want to pull out
information from southeast Asia: how do we set up an operation to
produce a logical vector that is <code>TRUE</code> for all of the
countries in southeast Asia and <code>FALSE</code> otherwise?</p>
<p>Suppose you have these data:</p>
<div class="codewrapper sourceCode" id="cb70">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seAsia</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"Myanmar"</span>,<span class="st">"Thailand"</span>,<span class="st">"Cambodia"</span>,<span class="st">"Vietnam"</span>,<span class="st">"Laos"</span><span class="op">)</span></span>
<span><span class="co">## read in the gapminder data that we downloaded in episode 2</span></span>
<span><span class="va">gapminder</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/gapminder_data.csv"</span>, header<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## extract the `country` column from a data frame (we'll see this later);</span></span>
<span><span class="co">## convert from a factor to a character;</span></span>
<span><span class="co">## and get just the non-repeated elements</span></span>
<span><span class="va">countries</span> <span class="op">&lt;-</span> <span class="fu">unique</span><span class="op">(</span><span class="fu">as.character</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">country</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>There’s a wrong way (using only <code>==</code>), which will give you
a warning; a clunky way (using the logical operators <code>==</code> and
<code>|</code>); and an elegant way (using <code>%in%</code>). See
whether you can come up with all three and explain how they (don’t)
work.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<ul>
<li>The <strong>wrong</strong> way to do this problem is
<code>countries==seAsia</code>. This gives a warning
(<code>"In countries == seAsia : longer object length is not a multiple of shorter object length"</code>)
and the wrong answer (a vector of all <code>FALSE</code> values),
because none of the recycled values of <code>seAsia</code> happen to
line up correctly with matching values in <code>country</code>.</li>
<li>The <strong>clunky</strong> (but technically correct) way to do this
problem is</li>
</ul>
<div class="codewrapper sourceCode" id="cb71">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="op">(</span><span class="va">countries</span><span class="op">==</span><span class="st">"Myanmar"</span> <span class="op">|</span> <span class="va">countries</span><span class="op">==</span><span class="st">"Thailand"</span> <span class="op">|</span></span>
<span> <span class="va">countries</span><span class="op">==</span><span class="st">"Cambodia"</span> <span class="op">|</span> <span class="va">countries</span> <span class="op">==</span> <span class="st">"Vietnam"</span> <span class="op">|</span> <span class="va">countries</span><span class="op">==</span><span class="st">"Laos"</span><span class="op">)</span></span></code></pre>
</div>
<p>(or <code>countries==seAsia[1] | countries==seAsia[2] | ...</code>).
This gives the correct values, but hopefully you can see how awkward it
is (what if we wanted to select countries from a much longer list?).</p>
<ul>
<li>The best way to do this problem is
<code>countries %in% seAsia</code>, which is both correct and easy to
type (and read).</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="特別な値を扱う">特別な値を扱う<a class="anchor" aria-label="anchor" href="#%E7%89%B9%E5%88%A5%E3%81%AA%E5%80%A4%E3%82%92%E6%89%B1%E3%81%86"></a>
</h2>
<hr class="half-width">
<p>ある時点で、欠測値、無限値、未定義のデータを扱えないRの関数に出会うことでしょう。</p>
<p>データをフィルターするために使える特別な関数がいくつかあります：</p>
<ul>
<li>
<code>is.na</code> は、ベクトル、行列、データフレームで、</li>
<li>likewise, <code>is.nan</code>, and <code>is.infinite</code> will do
the same for <code>NaN</code> and <code>Inf</code>.</li>
<li>
<code>is.finite</code> will return all positions in a vector,
matrix, or data.frame that do not contain <code>NA</code>,
<code>NaN</code> or <code>Inf</code>.</li>
<li>
<code>na.omit</code> will filter out all missing values from a
vector</li>
</ul></section><section><h2 class="section-heading" id="順序のない因子の部分集合を作る">順序のない因子の部分集合を作る<a class="anchor" aria-label="anchor" href="#%E9%A0%86%E5%BA%8F%E3%81%AE%E3%81%AA%E3%81%84%E5%9B%A0%E5%AD%90%E3%81%AE%E9%83%A8%E5%88%86%E9%9B%86%E5%90%88%E3%82%92%E4%BD%9C%E3%82%8B"></a>
</h2>
<hr class="half-width">
<p>これまで部分集合ベクトルを作る色々な方法をやってみましたが、
他のデータ構造の部分集合を作るにはどうすればいいでしょう。</p>
<p>順序なし因子の部分集合を作る方法は、ベクトルの部分集合を作る方法と同じです。</p>
<div class="codewrapper sourceCode" id="cb72">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu">factor</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"c"</span>, <span class="st">"d"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">f</span><span class="op">[</span><span class="va">f</span> <span class="op">==</span> <span class="st">"a"</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] a a
Levels: a b c d</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb74">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span><span class="op">[</span><span class="va">f</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="st">"b"</span>, <span class="st">"c"</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] b c c
Levels: a b c d</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb76">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] a a b
Levels: a b c d</code></pre>
</div>
<p>要素を飛ばし、その順序なし因子に該当カテゴリーが存在しない場合であっても、水準は削除されません：</p>
<div class="codewrapper sourceCode" id="cb78">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span><span class="op">[</span><span class="op">-</span><span class="fl">3</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] a a c c d
Levels: a b c d</code></pre>
</div>
</section><section><h2 class="section-heading" id="行列の部分周到を作る">行列の部分周到を作る<a class="anchor" aria-label="anchor" href="#%E8%A1%8C%E5%88%97%E3%81%AE%E9%83%A8%E5%88%86%E5%91%A8%E5%88%B0%E3%82%92%E4%BD%9C%E3%82%8B"></a>
</h2>
<hr class="half-width">
<p>Matrices are also subsetted using the <code>[</code> function. In
this case it takes two arguments: the first applying to the rows, the
second to its columns:</p>
<div class="codewrapper sourceCode" id="cb80">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span><span class="fu">rnorm</span><span class="op">(</span><span class="fl">6</span><span class="op">*</span><span class="fl">4</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">4</span>, nrow<span class="op">=</span><span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">m</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span>, <span class="fu">c</span><span class="op">(</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>            [,1]       [,2]
[1,]  1.12493092 -0.8356286
[2,] -0.04493361  1.5952808</code></pre>
</div>
<p>それぞれ全ての列または行を取ってくるためには、最初または２番目の引数を空のままにしておきましょう：</p>
<div class="codewrapper sourceCode" id="cb82">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span><span class="op">[</span>, <span class="fu">c</span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>            [,1]        [,2]
[1,] -0.62124058  0.82122120
[2,] -2.21469989  0.59390132
[3,]  1.12493092  0.91897737
[4,] -0.04493361  0.78213630
[5,] -0.01619026  0.07456498
[6,]  0.94383621 -1.98935170</code></pre>
</div>
<p>１つの列または行にアクセスした場合、Rは結果を自動的にベクトルに変換します：</p>
<div class="codewrapper sourceCode" id="cb84">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span><span class="op">[</span><span class="fl">3</span>,<span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] -0.8356286  0.5757814  1.1249309  0.9189774</code></pre>
</div>
<p>もし、アウトプットを行列のままにしておきたいなら、 ３番目の 因数、
<code>drop = FALSE</code> が必要です：</p>
<div class="codewrapper sourceCode" id="cb86">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span><span class="op">[</span><span class="fl">3</span>, , drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>           [,1]      [,2]     [,3]      [,4]
[1,] -0.8356286 0.5757814 1.124931 0.9189774</code></pre>
</div>
<p>ベクトルと違って、行列の外の行や列にアクセスしようとすると、Rはエラーを返します：</p>
<div class="codewrapper sourceCode" id="cb88">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span><span class="op">[</span>, <span class="fu">c</span><span class="op">(</span><span class="fl">3</span>,<span class="fl">6</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in m[, c(3, 6)]: subscript out of bounds</code></pre>
</div>
<div id="ヒント高次元列" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント高次元列" class="callout-inner">
<h3 class="callout-title">ヒント：高次元列</h3>
<div class="callout-content">
<p>多次元列を扱う際、<code>[</code>
のそれぞれの引数は、次元に対応しています。
例えば、3次元列は、最初の３つの引数が、行、列、次元の深さに対応してます。</p>
</div>
</div>
</div>
<p>行列はベクトルなので、１つの引数だけを使って部分集合を作ることもできます：</p>
<div class="codewrapper sourceCode" id="cb90">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.3295078</code></pre>
</div>
<p>This usually isn’t useful, and often confusing to read. However it is
useful to note that matrices are laid out in <em>column-major
format</em> by default. That is the elements of the vector are arranged
column-wise:</p>
<div class="codewrapper sourceCode" id="cb92">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">matrix</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, nrow<span class="op">=</span><span class="fl">2</span>, ncol<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1] [,2] [,3]
[1,]    1    3    5
[2,]    2    4    6</code></pre>
</div>
<p>もし、行列を行の順番で埋めていきたい場合は、 <code>byrow=TRUE</code>
を使います：</p>
<div class="codewrapper sourceCode" id="cb94">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">matrix</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, nrow<span class="op">=</span><span class="fl">2</span>, ncol<span class="op">=</span><span class="fl">3</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1] [,2] [,3]
[1,]    1    2    3
[2,]    4    5    6</code></pre>
</div>
<p>行列もまた、行及び列の要素番号の代わりに、名前で部分集合を作ることができます。</p>
<div id="チャレンジ４" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ４" class="callout-inner">
<h3 class="callout-title">チャレンジ４</h3>
<div class="callout-content">
<p>以下のリストがあるとします：</p>
<div class="codewrapper sourceCode" id="cb96">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">18</span>, nrow<span class="op">=</span><span class="fl">3</span>, ncol<span class="op">=</span><span class="fl">6</span><span class="op">)</span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    1    4    7   10   13   16
[2,]    2    5    8   11   14   17
[3,]    3    6    9   12   15   18</code></pre>
</div>
<ol style="list-style-type: decimal">
<li>次のコマンドのうち、11と14を抜き出すことができるコマンドはどれでしょう？</li>
</ol>
<p>A. <code>m[2,4,2,5]</code></p>
<p>B. <code>m[2:5]</code></p>
<p>C. <code>m[4:5,2]</code></p>
<p>D. <code>m[2,c(4,5)]</code></p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  チャレンジ８の解答
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>D</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="リストの分部集合を作る">リストの分部集合を作る<a class="anchor" aria-label="anchor" href="#%E3%83%AA%E3%82%B9%E3%83%88%E3%81%AE%E5%88%86%E9%83%A8%E9%9B%86%E5%90%88%E3%82%92%E4%BD%9C%E3%82%8B"></a>
</h2>
<hr class="half-width">
<p>Now we’ll introduce some new subsetting operators. There are three
functions used to subset lists. We’ve already seen these when learning
about atomic vectors and matrices: <code>[</code>, <code>[[</code>, and
<code>$</code>.</p>
<p>Using <code>[</code> will always return a list. If you want to
<em>subset</em> a list, but not <em>extract</em> an element, then you
will likely use <code>[</code>.</p>
<div class="codewrapper sourceCode" id="cb98">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xlist</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span>a <span class="op">=</span> <span class="st">"Software Carpentry"</span>, b <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, data <span class="op">=</span> <span class="fu">head</span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">xlist</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>$a
[1] "Software Carpentry"</code></pre>
</div>
<p>これは、 １つの要素を持つリスト です。</p>
<p><code>[</code>
を使って原子ベクトルを作ったのと全く同じ方法で、リストの要素から部分集合を作ることができます。
しかし、比較処理は反復的ではないため、使えません。比較処理は、リストのそれぞれの要素のデータ構造にある、個々の要素ではなく、
データ構造に条件付けをしようとするからです。</p>
<div class="codewrapper sourceCode" id="cb100">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xlist</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>$a
[1] "Software Carpentry"

$b
 [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
</div>
<p>リストの個々の要素を抜き出すためには、二重角括弧 <code>[[</code>
を使う必要があります：</p>
<div class="codewrapper sourceCode" id="cb102">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xlist</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Software Carpentry"</code></pre>
</div>
<p>ここで結果がリストではなく、ベクトルとなっていることに気をつけましょう。</p>
<p>１つの要素を同時に抜き出すことはできません：</p>
<div class="codewrapper sourceCode" id="cb104">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xlist</span><span class="op">[[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in xlist[[1:2]]: subscript out of bounds</code></pre>
</div>
<p>また、要素を飛ばすこともできません：</p>
<div class="codewrapper sourceCode" id="cb106">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xlist</span><span class="op">[[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in xlist[[-1]]: invalid negative subscript in get1index &lt;real&gt;</code></pre>
</div>
<p>でも両方の部分集合の名前を使って、要素を抽出することはできます：</p>
<div class="codewrapper sourceCode" id="cb108">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xlist</span><span class="op">[[</span><span class="st">"a"</span><span class="op">]</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Software Carpentry"</code></pre>
</div>
<p><code>$</code> 関数は、簡単に名前で要素を抽出できるものです。</p>
<div class="codewrapper sourceCode" id="cb110">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xlist</span><span class="op">$</span><span class="va">data</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>                   mpg cyl disp  hp drat    wt  qsec vs am gear carb
Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre>
</div>
<div id="チャレンジ５" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ５" class="callout-inner">
<h3 class="callout-title">チャレンジ５</h3>
<div class="callout-content">
<p>以下のリストがあるとします：</p>
<div class="codewrapper sourceCode" id="cb112">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xlist</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span>a <span class="op">=</span> <span class="st">"Software Carpentry"</span>, b <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, data <span class="op">=</span> <span class="fu">head</span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Using your knowledge of both list and vector subsetting, extract the
number 2 from xlist. ヒント：数字の2は、リスト「b」の中にあります。</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">
  チャレンジ８の解答
  </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb113">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xlist</span><span class="op">$</span><span class="va">b</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb115">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xlist</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb117">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xlist</span><span class="op">[[</span><span class="st">"b"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="チャレンジ６" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ６" class="callout-inner">
<h3 class="callout-title">チャレンジ６</h3>
<div class="callout-content">
<p>以下のような線形モデルあるとします：</p>
<div class="codewrapper sourceCode" id="cb119">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">aov</span><span class="op">(</span><span class="va">pop</span> <span class="op">~</span> <span class="va">lifeExp</span>, data<span class="op">=</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<p>Extract the residual degrees of freedom (hint:
<code>attributes()</code> will help you)</p>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6">
  チャレンジ８の解答
  </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" aria-labelledby="headingSolution6" data-bs-parent="#accordionSolution6">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb120">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">attributes</span><span class="op">(</span><span class="va">mod</span><span class="op">)</span> <span class="co">## `df.residual` is one of the names of `mod`</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb121">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span><span class="op">$</span><span class="va">df.residual</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="データフレーム">データフレーム<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0"></a>
</h2>
<hr class="half-width">
<p>データフレームの中身は実はリストなので、リストと同じようなルールがあてはまることを覚えておきましょう。
しかし、データフレームは２次元のオブジェクトでもあります。</p>
<p>1つの引数しかない <code>[</code>
は、リストと同じような働きがあり、それぞれのリストの要素が列に対応します。
その結果、返されるオブジェクトはデータフレームになります：</p>
<div class="codewrapper sourceCode" id="cb122">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">gapminder</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>       pop
1  8425333
2  9240934
3 10267083
4 11537966
5 13079460
6 14880372</code></pre>
</div>
<p>同様に、 <code>[[</code> は、 単一の列
を抜き出す働きをするものです：</p>
<div class="codewrapper sourceCode" id="cb124">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">gapminder</span><span class="op">[[</span><span class="st">"lifeExp"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 28.801 30.332 31.997 34.020 36.088 38.438</code></pre>
</div>
<p>そして <code>$</code> は、簡単に列名で列を抽出できるものです：</p>
<div class="codewrapper sourceCode" id="cb126">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1952 1957 1962 1967 1972 1977</code></pre>
</div>
<p>２つの引数を使えば、 <code>[</code>
は、行列と同じような働きをします：</p>
<div class="codewrapper sourceCode" id="cb128">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      country year      pop continent lifeExp gdpPercap
1 Afghanistan 1952  8425333      Asia  28.801  779.4453
2 Afghanistan 1957  9240934      Asia  30.332  820.8530
3 Afghanistan 1962 10267083      Asia  31.997  853.1007</code></pre>
</div>
<p>もし、１つの行を部分集合する場合、結果はデータフレームになります
（理由は、要素には色々なデータ型が混ざっているからです）：</p>
<div class="codewrapper sourceCode" id="cb130">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">[</span><span class="fl">3</span>,<span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      country year      pop continent lifeExp gdpPercap
3 Afghanistan 1962 10267083      Asia  31.997  853.1007</code></pre>
</div>
<p>しかし、１つの行についての結果は、ベクトルになります
（これは、３番目の引数を <code>drop = FALSE</code>
とすれば変えられます)。</p>
<div id="チャレンジ７" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ７" class="callout-inner">
<h3 class="callout-title">チャレンジ７</h3>
<div class="callout-content">
<p>Fix each of the following common data frame subsetting errors:</p>
<ol style="list-style-type: decimal">
<li>Extract observations collected for the year 1957</li>
</ol>
<div class="codewrapper sourceCode" id="cb132">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" tabindex="-1"></a>gapminder[gapminder<span class="sc">$</span>year <span class="ot">=</span> <span class="dv">1957</span>,]</span></code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Extract all columns except 1 through to 4</li>
</ol>
<div class="codewrapper sourceCode" id="cb133">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span></code></pre>
</div>
<ol start="3" style="list-style-type: decimal">
<li>Extract the rows where the life expectancy is longer the 80
years</li>
</ol>
<div class="codewrapper sourceCode" id="cb134">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">lifeExp</span> <span class="op">&gt;</span> <span class="fl">80</span><span class="op">]</span></span></code></pre>
</div>
<ol start="4" style="list-style-type: decimal">
<li>Extract the first row, and the fourth and fifth columns
(<code>continent</code> and <code>lifeExp</code>).</li>
</ol>
<div class="codewrapper sourceCode" id="cb135">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">]</span></span></code></pre>
</div>
<ol start="5" style="list-style-type: decimal">
<li>Advanced: extract rows that contain information for the years 2002
and 2007</li>
</ol>
<div class="codewrapper sourceCode" id="cb136">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2002</span> <span class="op">|</span> <span class="fl">2007</span>,<span class="op">]</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution7" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution7" aria-expanded="false" aria-controls="collapseSolution7">
  <h4 class="accordion-header" id="headingSolution7">
  チャレンジ８の解答
  </h4>
</button>
<div id="collapseSolution7" class="accordion-collapse collapse" aria-labelledby="headingSolution7" data-bs-parent="#accordionSolution7">
<div class="accordion-body">
<p>Fix each of the following common data frame subsetting errors:</p>
<ol style="list-style-type: decimal">
<li>Extract observations collected for the year 1957</li>
</ol>
<div class="codewrapper sourceCode" id="cb137">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># gapminder[gapminder$year = 1957,]</span></span>
<span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">1957</span>,<span class="op">]</span></span></code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Extract all columns except 1 through to 4</li>
</ol>
<div class="codewrapper sourceCode" id="cb138">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># gapminder[,-1:4]</span></span>
<span><span class="va">gapminder</span><span class="op">[</span>,<span class="op">-</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<ol start="3" style="list-style-type: decimal">
<li>Extract the rows where the life expectancy is longer than 80
years</li>
</ol>
<div class="codewrapper sourceCode" id="cb139">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># gapminder[gapminder$lifeExp &gt; 80]</span></span>
<span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">lifeExp</span> <span class="op">&gt;</span> <span class="fl">80</span>,<span class="op">]</span></span></code></pre>
</div>
<ol start="4" style="list-style-type: decimal">
<li>Extract the first row, and the fourth and fifth columns
(<code>continent</code> and <code>lifeExp</code>).</li>
</ol>
<div class="codewrapper sourceCode" id="cb140">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># gapminder[1, 4, 5]</span></span>
<span><span class="va">gapminder</span><span class="op">[</span><span class="fl">1</span>, <span class="fu">c</span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<ol start="5" style="list-style-type: decimal">
<li>Advanced: extract rows that contain information for the years 2002
and 2007</li>
</ol>
<div class="codewrapper sourceCode" id="cb141">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># gapminder[gapminder$year == 2002 | 2007,]</span></span>
<span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2002</span> <span class="op">|</span> <span class="va">gapminder</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span>,<span class="op">]</span></span>
<span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="fl">2002</span>, <span class="fl">2007</span><span class="op">)</span>,<span class="op">]</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="チャレンジ８" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ８" class="callout-inner">
<h3 class="callout-title">チャレンジ８</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li><p>なぜ、 <code>gapminder[1:20]</code>
は、エラーを返すのでしょうか？ <code>gapminder[1:20, ]</code>
とどう違うのでしょう？</p></li>
<li><p>新しく <code>gapminder_small</code> という、1から9の行だけを含む
<code>data.frame</code> を作ってください。
これは、１つまたは２つの手順でできます。</p></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution8" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution8" aria-expanded="false" aria-controls="collapseSolution8">
  <h4 class="accordion-header" id="headingSolution8">
  チャレンジ８の解答
  </h4>
</button>
<div id="collapseSolution8" class="accordion-collapse collapse" aria-labelledby="headingSolution8" data-bs-parent="#accordionSolution8">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li><p><code>gapminder</code>
は、データフレームなので、２つの次元の部分集合を作る必要があります。
<code>gapminder[1:20, ]</code>
は、最初から20番目の行までについて全ての列を引き出します。</p></li>
<li>
</li>
</ol>
<div class="codewrapper sourceCode" id="cb142">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder_small</span> <span class="op">&lt;-</span> <span class="va">gapminder</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>, <span class="fl">19</span><span class="op">:</span><span class="fl">23</span><span class="op">)</span>,<span class="op">]</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">まとめ</h3>
<div class="callout-content">
<ul>
<li>Indexing in R starts at 1, not 0.</li>
<li>Access individual values by location using <code>[]</code>.</li>
<li>Access slices of data using <code>[low:high]</code>.</li>
<li>Access arbitrary sets of data using <code>[c(...)]</code>.</li>
<li>Use logical operations and logical vectors to access subsets of
data.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-07-control-flow"><p>Content from <a href="07-control-flow.html">Control Flow</a></p>
<hr>
<p>最終更新日：2024-10-12 |

        <a href="https://github.com/swcarpentry-ja/r-novice-gapminder/edit/main/episodes/07-control-flow.Rmd" class="external-link">ページの編集 <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>所要時間：<i aria-hidden="true" data-feather="clock"></i> 65分</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="回答を全て表示する " data-collapse="回答を全て折りたたむ "> 回答を全て表示する <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">概要</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">質問</h3>
<ul>
<li>How can I make data-dependent choices in R?</li>
<li>How can I repeat operations in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">目的</h3>
<ul>
<li>Write conditional statements with <code>if...else</code> statements
and <code>ifelse()</code>.</li>
<li>Write and understand <code>for()</code> loops.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>コードを書く際、実行の流れを制御する必要がよくあります。
これは、ある条件、または一連の条件が満たされたときに実行されるようにすればできます。
あるいは、決まった回数実行されるよう設定することもできます。</p>
<p>There are several ways you can control flow in R. For conditional
statements, the most commonly used approaches are the constructs:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="sc">~</span><span class="er">~~</span> <span class="co"># if if (condition is true) {</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  perform action</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="er">}</span> <span class="co"># if ... else if (condition is true) { # 条件が満たされた場合 アクションを行う } else { # つまり、条件が満たされなかった場合 別のアクションを行う } ~~~</span></span></code></pre>
</div>
<p>例えばRに、もし変数 <code>x</code>
が特定の値を持っていた場合、メッセージを表示させたいとします。</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">8</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&gt;=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"x is greater than or equal to 10"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">x</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 8</code></pre>
</div>
<p>The print statement does not appear in the console because x is not
greater than 10. To print a different message for numbers less than 10,
we can add an <code>else</code> statement.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">8</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&gt;=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"x is greater than or equal to 10"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"x is less than 10"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "x is less than 10"</code></pre>
</div>
<p><code>else if</code> を使うと、複数の条件を試すこともできます。</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">8</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&gt;=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"x is greater than or equal to 10"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"x is greater than 5, but less than 10"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"x is less than 5"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "x is greater than 5, but less than 10"</code></pre>
</div>
<p><strong>Important:</strong> when R evaluates the condition inside
<code>if()</code> statements, it is looking for a logical element, i.e.,
<code>TRUE</code> or <code>FALSE</code>. This can cause some headaches
for beginners. 例えば：</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span>  <span class="op">&lt;-</span>  <span class="fl">4</span> <span class="op">==</span> <span class="fl">3</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="st">"4 equals 3"</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="st">"4 does not equal 3"</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "4 does not equal 3"</code></pre>
</div>
<p>ここで見られるように、ベクトル x が <code>FALSE</code>
であるため、不等号のメッセージが表示されました。</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">4</span> <span class="op">==</span> <span class="fl">3</span></span>
<span><span class="va">x</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] FALSE</code></pre>
</div>
<div id="チャレンジ１" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ１" class="callout-inner">
<h3 class="callout-title">チャレンジ１</h3>
<div class="callout-content">
<p>Use an <code>if()</code> statement to print a suitable message
reporting whether there are any records from 2002 in the
<code>gapminder</code> dataset. Now do the same for 2012.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>We will first see a solution to Challenge 1 which does not use the
<code>any()</code> function. We first obtain a logical vector describing
which element of <code>gapminder$year</code> is equal to
<code>2002</code>:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">[</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2002</span><span class="op">)</span>,<span class="op">]</span></span></code></pre>
</div>
<p>Then, we count the number of rows of the data.frame
<code>gapminder</code> that correspond to the 2002:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rows2002_number</span> <span class="op">&lt;-</span> <span class="fu">nrow</span><span class="op">(</span><span class="va">gapminder</span><span class="op">[</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2002</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<p>The presence of any record for the year 2002 is equivalent to the
request that <code>rows2002_number</code> is one or more:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rows2002_number</span> <span class="op">&gt;=</span> <span class="fl">1</span></span></code></pre>
</div>
<p>Putting all together, we obtain:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="fu">nrow</span><span class="op">(</span><span class="va">gapminder</span><span class="op">[</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2002</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span></span>
<span>   <span class="fu">print</span><span class="op">(</span><span class="st">"Record(s) for the year 2002 found."</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>All this can be done more quickly with <code>any()</code>. The
logical condition can be expressed as:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="fu">any</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2002</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>   <span class="fu">print</span><span class="op">(</span><span class="st">"Record(s) for the year 2002 found."</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>次のような警告メッセージをもらった人はいますか？</p>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in if (gapminder$year == 2012) {: the condition has length &gt; 1</code></pre>
</div>
<p>The <code>if()</code> function only accepts singular (of length 1)
inputs, and therefore returns an error when you use it with a vector.
The <code>if()</code> function will still run, but will only evaluate
the condition in the first element of the vector. Therefore, to use the
<code>if()</code> function, you need to make sure your input is singular
(of length 1).</p>
<div id="tip-built-in-ifelse-function" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-built-in-ifelse-function" class="callout-inner">
<h3 class="callout-title">Tip: Built in <code>ifelse()</code>
function</h3>
<div class="callout-content">
<p><code>R</code> accepts both <code>if()</code> and
<code>else if()</code> statements structured as outlined above, but also
statements using <code>R</code>’s built-in <code>ifelse()</code>
function. This function accepts both singular and vector inputs and is
structured as follows:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co"># ifelse function</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="fu">ifelse</span>(condition is true, perform action, perform alternative action)</span></code></pre>
</div>
<p>where the first argument is the condition or a set of conditions to
be met, the second argument is the statement that is evaluated when the
condition is <code>TRUE</code>, and the third statement is the statement
that is evaluated when the condition is <code>FALSE</code>.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">3</span></span>
<span><span class="fu">ifelse</span><span class="op">(</span><span class="va">y</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="st">"y is a negative number"</span>, <span class="st">"y is either positive or zero"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "y is a negative number"</code></pre>
</div>
</div>
</div>
</div>
<div id="ヒントany-と-all" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒントany-と-all" class="callout-inner">
<h3 class="callout-title">ヒント：<code>any()</code> と
<code>all()</code>
</h3>
<div class="callout-content">
<p><code>any()</code> 関数は、ベクトルの中に少なくとも１つ
<code>TRUE</code> の値がある場合、 <code>TRUE</code> を返し、
そうでない場合は、 <code>FALSE</code> を返します。 これは、
<code>%in%</code> 演算子でも同様に使えます。 関数 <code>all()</code>
は、その名前が示唆しているように、ベクトル内の全ての値が
<code>TRUE</code> である時のみ、 <code>TRUE</code> となります。</p>
</div>
</div>
</div>
<section><h2 class="section-heading" id="繰り返し行う処理">繰り返し行う処理<a class="anchor" aria-label="anchor" href="#%E7%B9%B0%E3%82%8A%E8%BF%94%E3%81%97%E8%A1%8C%E3%81%86%E5%87%A6%E7%90%86"></a>
</h2>
<hr class="half-width">
<p>If you want to iterate over a set of values, when the order of
iteration is important, and perform the same operation on each, a
<code>for()</code> loop will do the job. We saw <code>for()</code> loops
in the <a href="https://swcarpentry.github.io/shell-novice/05-loop.html" class="external-link">shell
lessons earlier</a>. This is the most flexible of looping operations,
but therefore also the hardest to use correctly. In general, the advice
of many <code>R</code> users would be to learn about <code>for()</code>
loops, but to avoid using <code>for()</code> loops unless the order of
iteration is important: i.e. the calculation at each iteration depends
on the results of previous iterations. If the order of iteration is not
important, then you should learn about vectorized alternatives, such as
the <code>purrr</code> package, as they pay off in computational
efficiency.</p>
<p><code>for()</code> ループの基本構造は：</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="cf">for</span> (iterator <span class="cf">in</span> set of values) {</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>  do a thing</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>}</span></code></pre>
</div>
<p>例えば：</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1
[1] 2
[1] 3
[1] 4
[1] 5
[1] 6
[1] 7
[1] 8
[1] 9
[1] 10</code></pre>
</div>
<p><code>1:10</code> の部分は、ベクトルをその場で作るものです。
他のベクトルの中身を繰り返すこともできます。</p>
<p><code>for()</code> ループを、もうひとつの <code>for()</code>
ループと入れ子となる形にすれば、 ２つ同時に繰り返すこともできます。</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu">c</span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>, <span class="st">'e'</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">print</span><span class="op">(</span><span class="fu">paste</span><span class="op">(</span><span class="va">i</span>,<span class="va">j</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "1 a"
[1] "1 b"
[1] "1 c"
[1] "1 d"
[1] "1 e"
[1] "2 a"
[1] "2 b"
[1] "2 c"
[1] "2 d"
[1] "2 e"
[1] "3 a"
[1] "3 b"
[1] "3 c"
[1] "3 d"
[1] "3 e"
[1] "4 a"
[1] "4 b"
[1] "4 c"
[1] "4 d"
[1] "4 e"
[1] "5 a"
[1] "5 b"
[1] "5 c"
[1] "5 d"
[1] "5 e"</code></pre>
</div>
<p>We notice in the output that when the first index (<code>i</code>) is
set to 1, the second index (<code>j</code>) iterates through its full
set of indices. Once the indices of <code>j</code> have been iterated
through, then <code>i</code> is incremented. This process continues
until the last index has been used for each <code>for()</code> loop.</p>
<p>結果を表示させずに、ループの結果を新しいオブジェクトに書き込むこともできます。</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu">c</span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>, <span class="st">'e'</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">temp_output</span> <span class="op">&lt;-</span> <span class="fu">paste</span><span class="op">(</span><span class="va">i</span>, <span class="va">j</span><span class="op">)</span></span>
<span>    <span class="va">output_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">output_vector</span>, <span class="va">temp_output</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">output_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "1 a" "1 b" "1 c" "1 d" "1 e" "2 a" "2 b" "2 c" "2 d" "2 e" "3 a" "3 b"
[13] "3 c" "3 d" "3 e" "4 a" "4 b" "4 c" "4 d" "4 e" "5 a" "5 b" "5 c" "5 d"
[25] "5 e"</code></pre>
</div>
<p>このアプローチが役に立つこともありますが、‘結果を太らせる’
（結果のオブジェクトを
徐々に積み上げる）と、演算する上で非効率になります。
ゆえに、多くの値の間を繰り返すときは避けましょう。</p>
<div id="ヒント結果を太らせないようにしましょう" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント結果を太らせないようにしましょう" class="callout-inner">
<h3 class="callout-title">ヒント：結果を太らせないようにしましょう</h3>
<div class="callout-content">
<p>One of the biggest things that trips up novices and experienced R
users alike, is building a results object (vector, list, matrix, data
frame) as your for loop progresses. Computers are very bad at handling
this, so your calculations can very quickly slow to a crawl. It’s much
better to define an empty results object before hand of appropriate
dimensions, rather than initializing an empty object without dimensions.
So if you know the end result will be stored in a matrix like above,
create an empty matrix with 5 row and 5 columns, then at each iteration
store the results in the appropriate location.</p>
</div>
</div>
</div>
<p>よりよい方法は、（空の）出力オブジェクトを、値を埋める前に宣言することです。
この例では、より複雑に見えますが、より効率的です。</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_matrix</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">5</span>, ncol <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">j_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>, <span class="st">'e'</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">temp_j_value</span> <span class="op">&lt;-</span> <span class="va">j_vector</span><span class="op">[</span><span class="va">j</span><span class="op">]</span></span>
<span>    <span class="va">temp_output</span> <span class="op">&lt;-</span> <span class="fu">paste</span><span class="op">(</span><span class="va">i</span>, <span class="va">temp_j_value</span><span class="op">)</span></span>
<span>    <span class="va">output_matrix</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp_output</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">output_vector2</span> <span class="op">&lt;-</span> <span class="fu">as.vector</span><span class="op">(</span><span class="va">output_matrix</span><span class="op">)</span></span>
<span><span class="va">output_vector2</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "1 a" "2 a" "3 a" "4 a" "5 a" "1 b" "2 b" "3 b" "4 b" "5 b" "1 c" "2 c"
[13] "3 c" "4 c" "5 c" "1 d" "2 d" "3 d" "4 d" "5 d" "1 e" "2 e" "3 e" "4 e"
[25] "5 e"</code></pre>
</div>
<div id="ヒントwhile-ループ" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒントwhile-ループ" class="callout-inner">
<h3 class="callout-title">ヒント：while ループ</h3>
<div class="callout-content">
<p>時には、ある条件が満たされるまで繰り返す必要があります。 これは、
<code>while()</code> ループを使えばできます。</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="cf">while</span>(this condition is true){</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>  do a thing</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>}</span></code></pre>
</div>
<p>R will interpret a condition being met as “TRUE”.</p>
<p><code>while(this condition is true) \~\~\~  例として、このwhileループは 一様分布（&amp;#x60;runif()&amp;#x60; 関数）から0.1よりも小さい数を得るまで、 ０から１の間で乱数を生成します。</code></p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="kw">while</span><span class="op">(</span><span class="va">z</span> <span class="op">&gt;</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">z</span> <span class="op">&lt;-</span> <span class="fu">runif</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu">cat</span><span class="op">(</span><span class="va">z</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p><code>while()</code> loops will not always be appropriate. You have
to be particularly careful that you don’t end up stuck in an infinite
loop because your condition is always met and hence the while statement
never terminates.</p>
</div>
</div>
</div>
<div id="チャレンジ２" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ２" class="callout-inner">
<h3 class="callout-title">チャレンジ２</h3>
<div class="callout-content">
<p>Compare the objects <code>output_vector</code> and
<code>output_vector2</code>. Are they the same? If not, why not? How
would you change the last block of code to make
<code>output_vector2</code> the same as <code>output_vector</code>?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>We can check whether the two vectors are identical using the
<code>all()</code> function:</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">all</span><span class="op">(</span><span class="va">output_vector</span> <span class="op">==</span> <span class="va">output_vector2</span><span class="op">)</span></span></code></pre>
</div>
<p>However, all the elements of <code>output_vector</code> can be found
in <code>output_vector2</code>:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">all</span><span class="op">(</span><span class="va">output_vector</span> <span class="op">%in%</span> <span class="va">output_vector2</span><span class="op">)</span></span></code></pre>
</div>
<p>and vice versa:</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">all</span><span class="op">(</span><span class="va">output_vector2</span> <span class="op">%in%</span> <span class="va">output_vector</span><span class="op">)</span></span></code></pre>
</div>
<p>therefore, the element in <code>output_vector</code> and
<code>output_vector2</code> are just sorted in a different order. This
is because <code>as.vector()</code> outputs the elements of an input
matrix going over its column. Taking a look at
<code>output_matrix</code>, we can notice that we want its elements by
rows. The solution is to transpose the <code>output_matrix</code>. We
can do it either by calling the transpose function <code>t()</code> or
by inputting the elements in the right order. The first solution
requires to change the original</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_vector2</span> <span class="op">&lt;-</span> <span class="fu">as.vector</span><span class="op">(</span><span class="va">output_matrix</span><span class="op">)</span></span></code></pre>
</div>
<p>into</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_vector2</span> <span class="op">&lt;-</span> <span class="fu">as.vector</span><span class="op">(</span><span class="fu">t</span><span class="op">(</span><span class="va">output_matrix</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>The second solution requires to change</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_matrix</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp_output</span></span></code></pre>
</div>
<p>into</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_matrix</span><span class="op">[</span><span class="va">j</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp_output</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="チャレンジ３" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ３" class="callout-inner">
<h3 class="callout-title">チャレンジ３</h3>
<div class="callout-content">
<p><code>gapminder</code>
データを大陸ごとにループし、平均余命が50歳以上かどうかを表示する
スクリプトを書きましょう。</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p><strong>Step 1</strong>: We want to make sure we can extract all the
unique values of the continent vector</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/gapminder_data.csv"</span><span class="op">)</span></span>
<span><span class="fu">unique</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span></span></code></pre>
</div>
<p><strong>Step 2</strong>: We also need to loop over each of these
continents and calculate the average life expectancy for each
<code>subset</code> of
data.<code>gapminder &lt;- read.csv("data/gapminder\_data.csv") unique(gapminder$continent) \~\~\~ {: .language-r} 手順2 ：これらの大陸のそれぞれにループをし、その &amp;#x60;部分集合&amp;#x60; データごとに平均余命を出す必要があります。</code></p>
<ol style="list-style-type: decimal">
<li>それは次のようにすればできます： 1.</li>
<li>‘大陸（continent）’ の固有の値のそれぞれについてループする 2.</li>
<li>Return the calculated life expectancy to the user by printing the
output:</li>
</ol>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">iContinent</span> <span class="kw">in</span> <span class="fu">unique</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span> <span class="op">==</span> <span class="va">iContinent</span>, <span class="op">]</span></span>
<span>  <span class="fu">cat</span><span class="op">(</span><span class="va">iContinent</span>, <span class="fu">mean</span><span class="op">(</span><span class="va">tmp</span><span class="op">$</span><span class="va">lifeExp</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu">rm</span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p><strong>Step 3</strong>: The exercise only wants the output printed
if the average life expectancy is less than 50 or greater than 50.
ゆえに、結果を表示させる前に <code>if</code>
条件をつけて、演算された平均余命が基準値以上か、基準値未満かを判別し、結果によって正しい出力を表示させる必要があります。
これを踏まえて、上の (3) を修正する必要があります： 3a.</p>
<p>3a. If the calculated life expectancy is less than some threshold (50
years), return the continent and a statement that life expectancy is
less than threshold, otherwise return the continent and a statement that
life expectancy is greater than threshold:</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">thresholdValue</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">iContinent</span> <span class="kw">in</span> <span class="fu">unique</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>   <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span> <span class="op">==</span> <span class="va">iContinent</span>, <span class="st">"lifeExp"</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>   <span class="kw">if</span> <span class="op">(</span><span class="va">tmp</span> <span class="op">&lt;</span> <span class="va">thresholdValue</span><span class="op">)</span><span class="op">{</span></span>
<span>       <span class="fu">cat</span><span class="op">(</span><span class="st">"Average Life Expectancy in"</span>, <span class="va">iContinent</span>, <span class="st">"is less than"</span>, <span class="va">thresholdValue</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>   <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>       <span class="fu">cat</span><span class="op">(</span><span class="st">"Average Life Expectancy in"</span>, <span class="va">iContinent</span>, <span class="st">"is greater than"</span>, <span class="va">thresholdValue</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>   <span class="op">}</span> <span class="co"># end if else condition</span></span>
<span>   <span class="fu">rm</span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="co"># end for loop</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="チャレンジ４" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ４" class="callout-inner">
<h3 class="callout-title">チャレンジ４</h3>
<div class="callout-content">
<p>チャレンジ３のスクリプトをそれぞれの国ごとにループする形に直してください。
今回は、平均余命は50歳未満か、50歳以上70歳未満か、70歳以上かを
表示しましょう。</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>We modify our solution to Challenge 3 by now adding two thresholds,
<code>lowerThreshold</code> and <code>upperThreshold</code> and
extending our if-else statements:</p>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a>チャレンジ４の解答 チャレンジ３の解答を、 <span class="st">`</span><span class="at">lowerThreshold</span><span class="st">`</span> と <span class="st">`</span><span class="at">upperThreshold</span><span class="st">`</span> の２つの基準値を加え、if<span class="sc">-</span><span class="cf">else</span> 宣言を拡張する形で修正します： <span class="sc">~</span><span class="er">~~</span> lowerThreshold <span class="ot">&lt;-</span> <span class="dv">50</span> upperThreshold <span class="ot">&lt;-</span> <span class="dv">70</span> <span class="cf">for</span>( iCountry <span class="cf">in</span> <span class="fu">unique</span>(gapminder<span class="sc">$</span>country) ){ tmp <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">subset</span>(gapminder, country<span class="sc">==</span>iCountry)<span class="sc">$</span>lifeExp) <span class="cf">if</span>(tmp <span class="sc">&lt;</span> lowerThreshold){ <span class="fu">cat</span>(<span class="st">"Average Life Expectancy in"</span>, iCountry, <span class="st">"is less than"</span>, lowerThreshold, <span class="st">"</span><span class="sc">\\</span><span class="st">n"</span>) } <span class="cf">else</span> <span class="cf">if</span>(tmp lowerThreshold <span class="sc">&amp;&amp;</span> tmp <span class="sc">&lt;</span> upperThreshold){ <span class="fu">cat</span>(<span class="st">"Average Life Expectancy in"</span>, iCountry, <span class="st">"is between"</span>, lowerThreshold, <span class="st">"and"</span>, upperThreshold, <span class="st">"</span><span class="sc">\\</span><span class="st">n"</span>) } <span class="cf">else</span>{ <span class="fu">cat</span>(<span class="st">"Average Life Expectancy in"</span>, iCountry, <span class="st">"is greater than"</span>, upperThreshold, <span class="st">"</span><span class="sc">\\</span><span class="st">n"</span>) } <span class="fu">rm</span>(tmp) } <span class="sc">~</span><span class="er">~~</span> {<span class="sc">:</span> .language<span class="sc">-</span>r}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="チャレンジ5---上級" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ5---上級" class="callout-inner">
<h3 class="callout-title">チャレンジ5 - 上級</h3>
<div class="callout-content">
<p>Write a script that loops over each country in the
<code>gapminder</code> dataset, tests whether the country starts with a
‘B’, and graphs life expectancy against time as a line graph if the mean
life expectancy is under 50 years.</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<p>We will use the <code>grep()</code> command that was introduced in
the <a href="https://swcarpentry.github.io/shell-novice/07-find.html" class="external-link">Unix
Shell lesson</a> to find countries that start with “B.” Lets understand
how to do this first. Following from the Unix shell section we may be
tempted to try the following</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">grep</span><span class="op">(</span><span class="st">"^B"</span>, <span class="fu">unique</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">country</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>But when we evaluate this command it returns the indices of the
factor variable <code>country</code> that start with “B.” To get the
values, we must add the <code>value=TRUE</code> option to the
<code>grep()</code> command:</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">grep</span><span class="op">(</span><span class="st">"^B"</span>, <span class="fu">unique</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">country</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>We will now store these countries in a variable called
candidateCountries, and then loop over each entry in the variable.
Inside the loop, we evaluate the average life expectancy for each
country, and if the average life expectancy is less than 50 we use
base-plot to plot the evolution of average life expectancy using
<code>with()</code> and <code>subset()</code>:</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">thresholdValue</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">candidateCountries</span> <span class="op">&lt;-</span> <span class="fu">grep</span><span class="op">(</span><span class="st">"^B"</span>, <span class="fu">unique</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">country</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">iCountry</span> <span class="kw">in</span> <span class="va">candidateCountries</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">country</span> <span class="op">==</span> <span class="va">iCountry</span>, <span class="st">"lifeExp"</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tmp</span> <span class="op">&lt;</span> <span class="va">thresholdValue</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu">cat</span><span class="op">(</span><span class="st">"Average Life Expectancy in"</span>, <span class="va">iCountry</span>, <span class="st">"is less than"</span>, <span class="va">thresholdValue</span>, <span class="st">"plotting life expectancy graph... \n"</span><span class="op">)</span></span>
<span></span>
<span>        <span class="fu">with</span><span class="op">(</span><span class="fu">subset</span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">country</span> <span class="op">==</span> <span class="va">iCountry</span><span class="op">)</span>,</span>
<span>                <span class="fu">plot</span><span class="op">(</span><span class="va">year</span>, <span class="va">lifeExp</span>,</span>
<span>                     type <span class="op">=</span> <span class="st">"o"</span>,</span>
<span>                     main <span class="op">=</span> <span class="fu">paste</span><span class="op">(</span><span class="st">"Life Expectancy in"</span>, <span class="va">iCountry</span>, <span class="st">"over time"</span><span class="op">)</span>,</span>
<span>                     ylab <span class="op">=</span> <span class="st">"Life Expectancy"</span>,</span>
<span>                     xlab <span class="op">=</span> <span class="st">"Year"</span></span>
<span>                     <span class="op">)</span> <span class="co"># end plot</span></span>
<span>             <span class="op">)</span> <span class="co"># end with</span></span>
<span>    <span class="op">}</span> <span class="co"># end if</span></span>
<span>    <span class="fu">rm</span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="co"># end for loop</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">まとめ</h3>
<div class="callout-content">
<ul>
<li>Use <code>if</code> and <code>else</code> to make choices.</li>
<li>Use <code>for</code> to repeat operations.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-08-plot-ggplot2"><p>Content from <a href="08-plot-ggplot2.html">Creating Publication-Quality Graphics with ggplot2</a></p>
<hr>
<p>最終更新日：2024-10-12 |

        <a href="https://github.com/swcarpentry-ja/r-novice-gapminder/edit/main/episodes/08-plot-ggplot2.Rmd" class="external-link">ページの編集 <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>所要時間：<i aria-hidden="true" data-feather="clock"></i> 80分</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="回答を全て表示する " data-collapse="回答を全て折りたたむ "> 回答を全て表示する <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">概要</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">質問</h3>
<ul>
<li>How can I create publication-quality graphics in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">目的</h3>
<ul>
<li>To be able to use ggplot2 to generate publication-quality
graphics.</li>
<li>To apply geometry, aesthetic, and statistics layers to a ggplot
plot.</li>
<li>To manipulate the aesthetics of a plot using different colors,
shapes, and lines.</li>
<li>To improve data visualization through transforming scales and
paneling by group.</li>
<li>To save a plot created with ggplot to disk.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>データをプロットすることは、データとその変数間の様々な関係をクイックに探索する最良の方法の一つです。</p>
<p>Rには、主に3つのプロットシステムがあります。 <a href="https://www.statmethods.net/graphs/index.html" class="external-link">R組み込みplot関数</a>、
<a href="https://www.statmethods.net/advgraphs/trellis.html" class="external-link">lattice</a>
パッケージ、<a href="https://www.statmethods.net/advgraphs/ggplot2.html" class="external-link">ggplot2</a>
パッケージです。</p>
<p>今回、私たちはggplot2パッケージについて学んでいきます。
なぜなら、ggplot2パッケージは出版品質並のグラフィック作成に最も効果的だからです。</p>
<p>ggplot2 is built on the grammar of graphics, the idea that any plot
can be built from the same set of components: a <strong>data
set</strong>, <strong>mapping aesthetics</strong>, and graphical
<strong>layers</strong>:</p>
<ul>
<li><p><strong>Data sets</strong> are the data that you, the user,
provide.</p></li>
<li><p><strong>Mapping aesthetics</strong> are what connect the data to
the graphics. They tell ggplot2 how to use your data to affect how the
graph looks, such as changing what is plotted on the X or Y axis, or the
size or color of different data points.</p></li>
<li><p><strong>Layers</strong> are the actual graphical output from
ggplot2. Layers determine what kinds of plot are shown (scatterplot,
histogram, etc.), the coordinate system used (rectangular, polar,
others), and other important aspects of the plot.
このアイディアは、Photoshop、Illustrator、Inkscapeなどの画像編集ソフトを使用する場面でお馴染みかもしれません。</p></li>
</ul>
<p>Let’s start off building an example using the gapminder data from
earlier. The most basic function is <code>ggplot</code>, which lets R
know that we’re creating a new plot. Any of the arguments we give the
<code>ggplot</code> function are the <em>global</em> options for the
plot: they apply to all layers on the plot.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-blank-ggplot-1.png" alt="Blank plot, before adding any mapping aesthetics to ggplot()." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Here we called <code>ggplot</code> and told it what data we want to
show on our figure. This is not enough information for
<code>ggplot</code> to actually draw anything. It only creates a blank
slate for other elements to be added to.</p>
<p>Now we’re going to add in the <strong>mapping aesthetics</strong>
using the <code>aes</code> function. <code>aes</code> tells
<code>ggplot</code> how variables in the <strong>data</strong> map to
<em>aesthetic</em> properties of the figure, such as which columns of
the data should be used for the <strong>x</strong> and
<strong>y</strong> locations.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdpPercap</span>, y <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-ggplot-with-aes-1.png" alt="Plotting area with axes for a scatter plot of life expectancy vs GDP, with no data points visible." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Here we told <code>ggplot</code> we want to plot the “gdpPercap”
column of the gapminder data frame on the x-axis, and the “lifeExp”
column on the y-axis. Notice that we didn’t need to explicitly pass
<code>aes</code> these columns
(e.g. <code>x = gapminder[, "gdpPercap"]</code>), this is because
<code>ggplot</code> is smart enough to know to look in the
<strong>data</strong> for that column!</p>
<p>The final part of making our plot is to tell <code>ggplot</code> how
we want to visually represent the data. We do this by adding a new
<strong>layer</strong> to the plot using one of the
<strong>geom</strong> functions.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdpPercap</span>, y <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-lifeExp-vs-gdpPercap-scatter-1.png" alt="Scatter plot of life expectancy vs GDP per capita, now showing the data points." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Here we used <code>geom_point</code>, which tells <code>ggplot</code>
we want to visually represent the relationship between
<strong>x</strong> and <strong>y</strong> as a scatterplot of
points.</p>
<div id="チャレンジ１" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ１" class="callout-inner">
<h3 class="callout-title">チャレンジ１</h3>
<div class="callout-content">
<p>Modify the example so that the figure shows how life expectancy has
changed over time:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdpPercap</span>, y <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>Hint: the gapminder dataset has a column called “year”, which should
appear on the x-axis.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  チャレンジ８の解答 1
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>Here is one possible solution:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="../fig/08-plot-ggplot2-rendered-ch1-sol-1.png" alt="Binned scatterplot of life expectancy versus year showing how life expectancy has increased over time" class="figure mx-auto d-block"><figcaption>
Binned scatterplot of life expectancy versus year showing how life
expectancy has increased over time
</figcaption></figure>
</div>
</div>
</div>
</div>
<div id="チャレンジ２" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ２" class="callout-inner">
<h3 class="callout-title">チャレンジ２</h3>
<div class="callout-content">
<p>チャレンジ ２ 先の例題とチャレンジでは、<code>aes</code>
関数を使用して、各点の x と y の位置について散布図 geom を指定しました。
修正できるもう1つのエステティック属性は、点の色です。
先のチャレンジのコードを修正して、“continent” 列で点に色付けして下さい。
データにどはどのような傾向が見られますか？
それらの傾向は、あなたが期待したものですか？</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  チャレンジ８の解答
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>The solution presented below adds <code>color=continent</code> to the
call of the <code>aes</code> function. The general trend seems to
indicate an increased life expectancy over the years. On continents with
stronger economies we find a longer life expectancy.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">lifeExp</span>, color<span class="op">=</span><span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="../fig/08-plot-ggplot2-rendered-ch2-sol-1.png" alt="Binned scatterplot of life expectancy vs year with color-coded continents showing value of 'aes' function" class="figure mx-auto d-block"><figcaption>
Binned scatterplot of life expectancy vs year with color-coded
continents showing value of ‘aes’ function
</figcaption></figure>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="レイヤー">レイヤー<a class="anchor" aria-label="anchor" href="#%E3%83%AC%E3%82%A4%E3%83%A4%E3%83%BC"></a>
</h2>
<hr class="half-width">
<p>散布図を使用することは、時間経過による変化を視覚化するのに、おそらく最適ではありません。
代わりに、データを線グラフとして可視化するようggplotに指示しましょう。</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">year</span>, y<span class="op">=</span><span class="va">lifeExp</span>, color<span class="op">=</span><span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-lifeExp-line-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p><code>geom_point</code>レイヤーを追加する代わりに、<code>geom_line</code>レイヤーを追加しました。</p>
<p>However, the result doesn’t look quite as we might have expected: it
seems to be jumping around a lot in each continent. Let’s try to
separate the data by country, plotting one line for each country:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">year</span>, y<span class="op">=</span><span class="va">lifeExp</span>, group<span class="op">=</span><span class="va">country</span>, color<span class="op">=</span><span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-lifeExp-line-by-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>by
エステティックを追加し、各国ごとに線を描くよう<code>ggplot</code>に指示します。</p>
<p>しかし、線と点の両方をプロット上に視覚化したい場合はどうすればよいでしょうか？
プロットに別のレイヤーを追加するだけです。</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">year</span>, y<span class="op">=</span><span class="va">lifeExp</span>, group<span class="op">=</span><span class="va">country</span>, color<span class="op">=</span><span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-lifeExp-line-point-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>It’s important to note that each layer is drawn on top of the
previous layer. In this example, the points have been drawn <em>on top
of</em> the lines. Here’s a demonstration:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">year</span>, y<span class="op">=</span><span class="va">lifeExp</span>, group<span class="op">=</span><span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color<span class="op">=</span><span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-lifeExp-layer-example-1-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>この例では、 color
エステティックマッピングが、<code>ggplot</code>のグローバルプロットオプションから<code>geom_line</code>レイヤーに移動されたため、
点には色が適用されなくなりました。
これで、点が線の上に描画されていることがわかります。</p>
<div id="ヒントエステティック属性にマッピングの代わりに値を設定する" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒントエステティック属性にマッピングの代わりに値を設定する" class="callout-inner">
<h3 class="callout-title">ヒント：エステティック属性に、マッピングの代わりに値を設定する</h3>
<div class="callout-content">
<p>So far, we’ve seen how to use an aesthetic (such as
<strong>color</strong>) as a <em>mapping</em> to a variable in the data.
For example, when we use
<code>geom_line(mapping = aes(color=continent))</code>, ggplot will give
a different color to each continent. But what if we want to change the
color of all lines to blue? You may think that
<code>geom_line(mapping = aes(color="blue"))</code> should work, but it
doesn’t. Since we don’t want to create a mapping to a specific variable,
we can move the color specification outside of the <code>aes()</code>
function, like this: <code>geom_line(color="blue")</code>.</p>
</div>
</div>
</div>
<div id="チャレンジ３" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ３" class="callout-inner">
<h3 class="callout-title">チャレンジ３</h3>
<div class="callout-content">
<p>Switch the order of the point and line layers from the previous
example. 何が起こったのでしょう？Rは、csvファイルを読み込む際、
列にある全てのものが同じ基本の型であるべきだと主張します。もし、列の
全て が、 double型であることが確認できない場合、その列の だれも
double型にならないのです。</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>The lines now get drawn over the points!</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">year</span>, y<span class="op">=</span><span class="va">lifeExp</span>, group<span class="op">=</span><span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color<span class="op">=</span><span class="va">continent</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-ch3-sol-1.png" alt="Scatter plot of life expectancy vs GDP per capita with a trend line summarising the relationship between variables. The plot illustrates the possibilities for styling visualisations in ggplot2 with data points enlarged, coloured orange, and displayed without transparency." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="変換と統計">変換と統計<a class="anchor" aria-label="anchor" href="#%E5%A4%89%E6%8F%9B%E3%81%A8%E7%B5%B1%E8%A8%88"></a>
</h2>
<hr class="half-width">
<p>ggplot2を使用すると、統計モデルをデータに適用することが容易になります。
デモのために、最初の例に戻ります。</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdpPercap</span>, y <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-lifeExp-vs-gdpPercap-scatter3-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Currently it’s hard to see the relationship between the points due to
some strong outliers in GDP per capita. We can change the scale of units
on the x axis using the <em>scale</em> functions. These control the
mapping between the data values and visual values of an aesthetic. We
can also modify the transparency of the points, using the <em>alpha</em>
function, which is especially helpful when you have a large amount of
data which is very clustered.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdpPercap</span>, y <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_x_log10</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="../fig/08-plot-ggplot2-rendered-axis-scale-1.png" alt="Scatterplot of GDP vs life expectancy showing logarithmic x-axis data spread" class="figure mx-auto d-block"><figcaption>
Scatterplot of GDP vs life expectancy showing logarithmic x-axis data
spread
</figcaption></figure><p>The <code>scale_x_log10</code> function applied a transformation to
the coordinate system of the plot, so that each multiple of 10 is evenly
spaced from left to right. For example, a GDP per capita of 1,000 is the
same horizontal distance away from a value of 10,000 as the 10,000 value
is from 100,000. This helps to visualize the spread of the data along
the x-axis.</p>
<div id="ヒントのリマインダエステティック属性にマッピングの代わりに値を設定する" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒントのリマインダエステティック属性にマッピングの代わりに値を設定する" class="callout-inner">
<h3 class="callout-title">ヒントのリマインダ：エステティック属性に、マッピングの代わりに値を設定する</h3>
<div class="callout-content">
<p><code>geom_point(alpha = 0.5)</code>を使用したことに注目してください。
先のヒントで触れたように、<code>aes()</code>関数以外の設定を使用すると、この値がすべての点で使用されます。
この場合、この値が必要です。しかし、他のエステティック設定と同様に、
alpha はデータ内の変数にマッピングすることもできます。
たとえば、<code>geom_point(aes(alpha = continent))</code>を使用して、各大陸に異なる透明度を与えることができます。</p>
</div>
</div>
</div>
<p><code>geom_smooth</code>という別のレイヤーを追加することで、データに単純な関係を当てはめることができます。</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdpPercap</span>, y <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_x_log10</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_smooth</span><span class="op">(</span>method<span class="op">=</span><span class="st">"lm"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-lm-fit-1.png" alt="Scatter plot of life expectancy vs GDP per capita with a blue trend line summarising the relationship between variables, and gray shaded area indicating 95% confidence intervals for that trend line." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p><code>geom_smooth</code>レイヤーで size
エステティック属性を設定することによって、
線を太くすることができます。</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdpPercap</span>, y <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_x_log10</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_smooth</span><span class="op">(</span>method<span class="op">=</span><span class="st">"lm"</span>, linewidth<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-lm-fit2-1.png" alt="Scatter plot of life expectancy vs GDP per capita with a trend line summarising the relationship between variables. The blue trend line is slightly thicker than in the previous figure." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>エステティック属性を指定する方法は2つあります。 Here we <em>set</em>
the <strong>linewidth</strong> aesthetic by passing it as an argument to
<code>geom_smooth</code> and it is applied the same to the whole
<code>geom</code>.
これまでのレッスンでは、データの変数とその視覚表現の間のマッピングを定義するために<code>aes</code>関数を使用しました。</p>
<div id="チャレンジ-4a" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-4a" class="callout-inner">
<h3 class="callout-title">チャレンジ 4a</h3>
<div class="callout-content">
<p>前の例を用いて、点レイヤー上の点の色とサイズを変更して下さい。</p>
<p>ヒント：’aes’関数を使用しないでください。</p>
<p>Hint: the equivalent of <code>linewidth</code> for points is
<code>size</code>.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  チャレンジ８の解答
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>Here a possible solution: Notice that the <code>color</code> argument
is supplied outside of the <code>aes()</code> function. This means that
it applies to all data points on the graph and is not related to a
specific variable.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdpPercap</span>, y <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_point</span><span class="op">(</span>size<span class="op">=</span><span class="fl">3</span>, color<span class="op">=</span><span class="st">"orange"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_x_log10</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_smooth</span><span class="op">(</span>method<span class="op">=</span><span class="st">"lm"</span>, linewidth<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-ch4a-sol-1.png" alt="Scatter plot of life expectancy vs GDP per capita with a trend line summarising the relationship between variables. The plot illustrates the possibilities for styling visualisations in ggplot2 with data points enlarged, coloured orange, and displayed without transparency." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="チャレンジ-4b" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-4b" class="callout-inner">
<h3 class="callout-title">チャレンジ 4b</h3>
<div class="callout-content">
<p>点を異なる形にし、また大陸毎に色分けと傾向線の描画をするために、
チャレンジ4aの回答を変更して下さい。
ヒント：color引数は、aes関数内で使用することができます。</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">
  チャレンジ８の解答
  </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<p>Here is a possible solution: Notice that supplying the
<code>color</code> argument inside the <code>aes()</code> functions
enables you to connect it to a certain variable. The <code>shape</code>
argument, as you can see, modifies all data points the same way (it is
outside the <code>aes()</code> call) while the <code>color</code>
argument which is placed inside the <code>aes()</code> call modifies a
point’s color based on its continent value.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdpPercap</span>, y <span class="op">=</span> <span class="va">lifeExp</span>, color <span class="op">=</span> <span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_point</span><span class="op">(</span>size<span class="op">=</span><span class="fl">3</span>, shape<span class="op">=</span><span class="fl">17</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_x_log10</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_smooth</span><span class="op">(</span>method<span class="op">=</span><span class="st">"lm"</span>, linewidth<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-ch4b-sol-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="複数パネルの図">複数パネルの図<a class="anchor" aria-label="anchor" href="#%E8%A4%87%E6%95%B0%E3%83%91%E3%83%8D%E3%83%AB%E3%81%AE%E5%9B%B3"></a>
</h2>
<hr class="half-width">
<p>先の例では、すべての国の平均余命の変化を1つのプロットで視覚化しました。
一方、 facet
パネルのレイヤーを追加することで、複数のパネルに分割することができます。</p>
<div id="ヒント" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント" class="callout-inner">
<h3 class="callout-title">ヒント</h3>
<div class="callout-content">
<p>We start by making a subset of data including only countries located
in the Americas. This includes 25 countries, which will begin to clutter
the figure. Note that we apply a “theme” definition to rotate the x-axis
labels to maintain readability. Nearly everything in ggplot2 is
customizable.</p>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">americas</span> <span class="op">&lt;-</span> <span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Americas"</span>,<span class="op">]</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">americas</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span> <span class="op">~</span> <span class="va">country</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-facet-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p><code>facet_wrap</code>レイヤーは引数として“formula”をとり、チルダ(~)で表記されます。
これは、gapminderデータセットのcountry列にある各々の一意な値のパネルを描画するようRに指示します。</p>
</section><section><h2 class="section-heading" id="テキストの変更">テキストの変更<a class="anchor" aria-label="anchor" href="#%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%81%AE%E5%A4%89%E6%9B%B4"></a>
</h2>
<hr class="half-width">
<p>分析結果の発表に向けてこの図を整理するにあたり、いくつかのテキスト要素を変更する必要があります。
x軸はあまりにも雑然としており、y軸はデータフレームの列名ではなく、“Life
expectancy”と読み替えるべきです。</p>
<p>これを行うには、いくつかのレイヤーを追加する必要があります。 theme
レイヤーは、軸テキストと全体のテキストサイズを制御します。
軸、プロットタイトル、および任意の凡例のラベルは、<code>labs</code>関数を使用して設定できます。
凡例のタイトルは、<code>aes</code>関数で使用したものと同じ名前を設定します。
したがって、color凡例のタイトルは<code>color = "Continent"</code>を用いて設定され、
fill凡例のタイトルは<code>fill = "任意のタイトル"</code>を使用して設定されます。</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">americas</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">lifeExp</span>, color<span class="op">=</span><span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">facet_wrap</span><span class="op">(</span> <span class="op">~</span> <span class="va">country</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Year"</span>,              <span class="co"># x axis title</span></span>
<span>    y <span class="op">=</span> <span class="st">"Life expectancy"</span>,   <span class="co"># y axis title</span></span>
<span>    title <span class="op">=</span> <span class="st">"Figure 1"</span>,      <span class="co"># main title of figure</span></span>
<span>    color <span class="op">=</span> <span class="st">"Continent"</span>      <span class="co"># title of legend</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-theme-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="プロットのエクスポート">プロットのエクスポート<a class="anchor" aria-label="anchor" href="#%E3%83%97%E3%83%AD%E3%83%83%E3%83%88%E3%81%AE%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%9D%E3%83%BC%E3%83%88"></a>
</h2>
<hr class="half-width">
<p><code>ggsave()</code>関数を使用すると、ggplotで作成したプロットをエクスポートすることができます。
出版、公開のための高品質グラフィックを作成するために、
適切な引数（<code>width</code>、<code>height</code>、および<code>dpi</code>）を調整してプロットの寸法と解像度を指定できます。
上記のように、そのプロットを保存するには、最初にそのプロットを変数<code>lifeExp_plot</code>に割り当て、
<code>ggsave</code>にそのプロットを<code>png</code>形式で<code>results</code>というディレクトリに保存するよう指示します。
（作業ディレクトリに’results
/’フォルダがあることを確認してください。）</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lifeExp_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">americas</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">lifeExp</span>, color<span class="op">=</span><span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">facet_wrap</span><span class="op">(</span> <span class="op">~</span> <span class="va">country</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Year"</span>,              <span class="co"># x axis title</span></span>
<span>    y <span class="op">=</span> <span class="st">"Life expectancy"</span>,   <span class="co"># y axis title</span></span>
<span>    title <span class="op">=</span> <span class="st">"Figure 1"</span>,      <span class="co"># main title of figure</span></span>
<span>    color <span class="op">=</span> <span class="st">"Continent"</span>      <span class="co"># title of legend</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggsave</span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"results/lifeExp.png"</span>, plot <span class="op">=</span> <span class="va">lifeExp_plot</span>, width <span class="op">=</span> <span class="fl">12</span>, height <span class="op">=</span> <span class="fl">10</span>, dpi <span class="op">=</span> <span class="fl">300</span>, units <span class="op">=</span> <span class="st">"cm"</span><span class="op">)</span></span></code></pre>
</div>
<p><code>ggsave</code>には素晴らしい点が二つあります。
一つ目は、最後のプロットがデフォルトになるので、<code>plot</code>引数を省略すると、<code>ggplot</code>で作成した最後のプロットが自動的に保存されることです。
二つ目は、ファイル名に指定したファイル拡張子（例：<code>.png</code>または<code>.pdf</code>）からプロットを保存するフォーマットを決定しようとします。
必要な場合は、<code>device</code>引数に明示的にフォーマットを指定できます。</p>
<p>This is a taste of what you can do with ggplot2. RStudio provides a
really useful <a href="https://www.rstudio.org/links/data_visualization_cheat_sheet" class="external-link">cheat
sheet</a> of the different layers available, and more extensive
documentation is available on the <a href="https://ggplot2.tidyverse.org/reference/" class="external-link">ggplot2 website</a>. All
RStudio cheat sheets are available from the <a href="https://www.rstudio.com/resources/cheatsheets/" class="external-link">RStudio
website</a>. Finally, if you have no idea how to change something, a
quick Google search will usually send you to a relevant question and
answer on Stack Overflow with reusable code to modify!</p>
<div id="チャレンジ５" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ５" class="callout-inner">
<h3 class="callout-title">チャレンジ５</h3>
<div class="callout-content">
<p>Generate boxplots to compare life expectancy between the different
continents during the available years.</p>
<p>Advanced:</p>
<ul>
<li>Rename y axis as Life Expectancy.</li>
<li>Remove x axis labels.</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" data-bs-parent="#accordionSolution6" aria-labelledby="headingSolution6">
<div class="accordion-body">
<p>Here a possible solution: <code>xlab()</code> and <code>ylab()</code>
set labels for the x and y axes, respectively The axis title, text and
ticks are attributes of the theme and must be modified within a
<code>theme()</code> call.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">continent</span>, y <span class="op">=</span> <span class="va">lifeExp</span>, fill <span class="op">=</span> <span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">year</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Life Expectancy"</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">theme</span><span class="op">(</span>axis.title.x<span class="op">=</span><span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>       axis.text.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>       axis.ticks.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/08-plot-ggplot2-rendered-ch5-sol-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">まとめ</h3>
<div class="callout-content">
<ul>
<li>Use <code>ggplot2</code> to create plots.</li>
<li>Think about graphics in layers: aesthetics, geometry, statistics,
scale transformation, and grouping.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-09-vectorization"><p>Content from <a href="09-vectorization.html">ベクトル化</a></p>
<hr>
<p>最終更新日：2024-10-12 |

        <a href="https://github.com/swcarpentry-ja/r-novice-gapminder/edit/main/episodes/09-vectorization.Rmd" class="external-link">ページの編集 <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>所要時間：<i aria-hidden="true" data-feather="clock"></i> 25分</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="回答を全て表示する " data-collapse="回答を全て折りたたむ "> 回答を全て表示する <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">概要</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">質問</h3>
<ul>
<li>How can I operate on all the elements of a vector at once?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">目的</h3>
<ul>
<li>To understand vectorized operations in R.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Rの関数はほとんどがベクトル化されており、関数はベクトルの全ての要素を最初から操作してくれるので、ベクトルの要素ごとにいちいちループする必要がありません。
おかげで簡潔で読み易く、エラーの少ないコードを書くことができます。</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span></span>
<span><span class="va">x</span> <span class="op">*</span> <span class="fl">2</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2 4 6 8</code></pre>
</div>
<p>積はベクトルの要素ごとに実行されました。</p>
<p>2つのベクトルを足し合わせることもできます:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">6</span><span class="op">:</span><span class="fl">9</span></span>
<span><span class="va">x</span> <span class="op">+</span> <span class="va">y</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1]  7  9 11 13</code></pre>
</div>
<p>この場合 <code>x</code> の各要素が対応する
<code>y</code>の要素に足されます。</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>x<span class="sc">:</span>  <span class="dv">1</span>  <span class="dv">2</span>  <span class="dv">3</span>  <span class="dv">4</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>    <span class="sc">+</span>  <span class="sc">+</span>  <span class="sc">+</span>  <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>y<span class="sc">:</span>  <span class="dv">6</span>  <span class="dv">7</span>  <span class="dv">8</span>  <span class="dv">9</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="sc">---------------</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>    <span class="dv">7</span>  <span class="dv">9</span> <span class="dv">11</span> <span class="dv">13</span></span></code></pre>
</div>
<p>Here is how we would add two vectors together using a for loop:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">output_vector</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="va">y</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="va">output_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1]  7  9 11 13</code></pre>
</div>
<p>Compare this to the output using vectorised operations.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sum_xy</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span></span>
<span><span class="va">sum_xy</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1]  7  9 11 13</code></pre>
</div>
<div id="チャレンジ１" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ１" class="callout-inner">
<h3 class="callout-title">チャレンジ１</h3>
<div class="callout-content">
<p><code>gapminder</code> データセットの <code>pop</code>
列でこれに挑戦してみましょう。</p>
<p><code>gapminder</code>
データフレームに百万人単位の人口を示す列を追加しましょう。
データフレームの先頭か最後を確認して、追加に成功したか確認しましょう。</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  チャレンジ８の解答 1
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p><code>gapminder</code> データセットの <code>pop</code>
列でこれに挑戦してみましょう。</p>
<p><code>gapminder</code>
データフレームに百万人単位の人口を示す列を追加しましょう。
データフレームの先頭か最後を確認して、追加に成功したか確認しましょう。</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">$</span><span class="va">pop_millions</span> <span class="op">&lt;-</span> <span class="va">gapminder</span><span class="op">$</span><span class="va">pop</span> <span class="op">/</span> <span class="fl">1e6</span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      country year      pop continent lifeExp gdpPercap pop_millions
1 Afghanistan 1952  8425333      Asia  28.801  779.4453     8.425333
2 Afghanistan 1957  9240934      Asia  30.332  820.8530     9.240934
3 Afghanistan 1962 10267083      Asia  31.997  853.1007    10.267083
4 Afghanistan 1967 11537966      Asia  34.020  836.1971    11.537966
5 Afghanistan 1972 13079460      Asia  36.088  739.9811    13.079460
6 Afghanistan 1977 14880372      Asia  38.438  786.1134    14.880372</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="チャレンジ２" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ２" class="callout-inner">
<h3 class="callout-title">チャレンジ２</h3>
<div class="callout-content">
<p>一つの図に、100万人単位の人口を年ごとにプロットしてみましょう。
国ごとの区別はつかなくていいです。</p>
<p>練習を繰り返して、中国とインドとインドネシアだけを含む図を
作ってみましょう。 先程と同じく、国ごとの区別はつかなくていいです。</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  チャレンジ８の解答
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>チャレンジの解答
100万人単位の人口を年ごとにプロットして、作図方法を復習しましょう。</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">gapminder</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">pop_millions</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/09-vectorization-rendered-ch2-sol-1.png" alt="Scatter plot showing populations in the millions against the year for China, India, and Indonesia, countries are not labeled." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">countryset</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"China"</span>,<span class="st">"India"</span>,<span class="st">"Indonesia"</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">country</span> <span class="op">%in%</span> <span class="va">countryset</span>,<span class="op">]</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">pop_millions</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/09-vectorization-rendered-ch2-sol-2.png" alt="Scatter plot showing populations in the millions against the year for China, India, and Indonesia, countries are not labeled." style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<p>比較演算子や論理演算子に加え、多くの関数もベクトル化されています。</p>
<p><strong>比較演算子</strong></p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">2</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] FALSE FALSE  TRUE  TRUE</code></pre>
</div>
<p><strong>論理演算子</strong></p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>a <span class="ot">&lt;-</span> x <span class="dv">3</span> <span class="co"># より明確な書き方は a &lt;- (x 3) a</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in parse(text = input): &lt;text&gt;:1:8: unexpected numeric constant
1: a &lt;- x 3
           ^</code></pre>
</div>
<div id="tip-論理ベクトルに使える便利な関数" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-論理ベクトルに使える便利な関数" class="callout-inner">
<h3 class="callout-title">Tip: 論理ベクトルに使える便利な関数</h3>
<div class="callout-content">
<ul>
<li>
<code>any()</code> はベクトルの要素の中に一つでも <code>TRUE</code>
があれば <code>TRUE</code> を返します。</li>
<li>
<code>all()</code> はベクトルの要素が 全て <code>TRUE</code>
であれば <code>TRUE</code> を返します。</li>
</ul>
</div>
</div>
</div>
<p>ほとんどの関数はベクトルを要素ごとに処理します。</p>
<p><strong>関数</strong></p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span></span>
<span><span class="fu">log</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.0000000 0.6931472 1.0986123 1.3862944</code></pre>
</div>
<p>ベクトル化された操作は行列を要素ごとに処理します:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, nrow<span class="op">=</span><span class="fl">3</span>, ncol<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">*</span> <span class="op">-</span><span class="fl">1</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1] [,2] [,3] [,4]
[1,]   -1   -4   -7  -10
[2,]   -2   -5   -8  -11
[3,]   -3   -6   -9  -12</code></pre>
</div>
<div id="tip-要素ごとの積-vs.-行列の積" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-要素ごとの積-vs.-行列の積" class="callout-inner">
<h3 class="callout-title">Tip: 要素ごとの積 vs. 行列の積</h3>
<div class="callout-content">
<p>非常に重要: <code></code> 演算子は要素ごとの積を行います！ To do
matrix multiplication, we need to use the <code>%*%</code> operator:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">%*%</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">1</span>, nrow<span class="op">=</span><span class="fl">4</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1]
[1,]   22
[2,]   26
[3,]   30</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">matrix</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, nrow<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">%*%</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1]
[1,]   30</code></pre>
</div>
<p>更に行列代数について知るには <a href="https://www.statmethods.net/advstats/matrix.html" class="external-link">Quick-R
reference guide</a> を参照して下さい</p>
</div>
</div>
</div>
<div id="チャレンジ３" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ３" class="callout-inner">
<h3 class="callout-title">チャレンジ３</h3>
<div class="callout-content">
<p>以下のリストがあるとします：</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, nrow<span class="op">=</span><span class="fl">3</span>, ncol<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">m</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1] [,2] [,3] [,4]
[1,]    1    4    7   10
[2,]    2    5    8   11
[3,]    3    6    9   12</code></pre>
</div>
<p>Write down what you think will happen when you run:</p>
<ol style="list-style-type: decimal">
<li><code>m ^ -1</code></li>
<li><code>m * c(1, 0, -1)</code></li>
<li><code>m &gt; c(0, 20)</code></li>
<li><code>m * c(1, 0, -1, 2)</code></li>
</ol>
<p>Did you get the output you expected? If not, ask a helper!</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>以下のリストがあるとします：</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, nrow<span class="op">=</span><span class="fl">3</span>, ncol<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">m</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1] [,2] [,3] [,4]
[1,]    1    4    7   10
[2,]    2    5    8   11
[3,]    3    6    9   12</code></pre>
</div>
<p>Write down what you think will happen when you run:</p>
<ol style="list-style-type: decimal">
<li><code>m ^ -1</code></li>
</ol>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>          [,1]      [,2]      [,3]       [,4]
[1,] 1.0000000 0.2500000 0.1428571 0.10000000
[2,] 0.5000000 0.2000000 0.1250000 0.09090909
[3,] 0.3333333 0.1666667 0.1111111 0.08333333</code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li><code>m * c(1, 0, -1)</code></li>
</ol>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1] [,2] [,3] [,4]
[1,]    1    4    7   10
[2,]    0    0    0    0
[3,]   -3   -6   -9  -12</code></pre>
</div>
<ol start="3" style="list-style-type: decimal">
<li><code>m &gt; c(0, 20)</code></li>
</ol>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      [,1]  [,2]  [,3]  [,4]
[1,]  TRUE FALSE  TRUE FALSE
[2,] FALSE  TRUE FALSE  TRUE
[3,]  TRUE FALSE  TRUE FALSE</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="チャレンジ４" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ４" class="callout-inner">
<h3 class="callout-title">チャレンジ４</h3>
<div class="callout-content">
<p>以下の分数の数列の総和が知りたいとします: ~~~ x:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">x</span> <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">2</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">3</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">...</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="va">n</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<ul>
<li>/(n^) ~~~ これをタイプするのは面倒な上に、nが大きいと不可能です。
ベクトル化を用いて n = 100 の場合を計算しましょう。 n = 10,000
の時の総和はいくつでしょうか？</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  チャレンジ４
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>以下の分数の数列の総和が知りたいとします: ~~~ x:</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">x</span> <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">2</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">3</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">...</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="va">n</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<ul>
<li>/(n^) ~~~ これをタイプするのは面倒な上に、nが大きいと不可能です。
ベクトル化を用いて n = 100 の場合を計算しましょう。 n = 10,000
の時の総和はいくつでしょうか？</li>
</ul>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sum</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1.634984</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sum</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1e04</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1.644834</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span><span class="fu">sum</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1.644834</code></pre>
</div>
<p>We can also obtain the same results using a function:</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inverse_sum_of_squares</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">sum</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">inverse_sum_of_squares</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1.634984</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">inverse_sum_of_squares</span><span class="op">(</span><span class="fl">10000</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1.644834</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span><span class="fu">inverse_sum_of_squares</span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1.644834</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="tip-operations-on-vectors-of-unequal-length" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-operations-on-vectors-of-unequal-length" class="callout-inner">
<h3 class="callout-title">Tip: Operations on vectors of unequal length</h3>
<div class="callout-content">
<p>Operations can also be performed on vectors of unequal length,
through a process known as <em>recycling</em>. This process
automatically repeats the smaller vector until it matches the length of
the larger vector. R will provide a warning if the larger vector is not
a multiple of the smaller vector.</p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">+</span> <span class="va">y</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">警告<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning in x + y: longer object length is not a multiple of shorter object
length</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2 4 6 5 7 9 8</code></pre>
</div>
<p>Vector <code>x</code> was recycled to match the length of vector
<code>y</code></p>
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a>x<span class="sc">:</span>  <span class="dv">1</span>  <span class="dv">2</span>  <span class="dv">3</span>  <span class="dv">1</span>  <span class="dv">2</span>  <span class="dv">3</span>  <span class="dv">1</span></span>
<span id="cb50-2"><a href="#cb50-2" tabindex="-1"></a>    <span class="sc">+</span>  <span class="sc">+</span>  <span class="sc">+</span>  <span class="sc">+</span>  <span class="sc">+</span>  <span class="sc">+</span>  <span class="sc">+</span></span>
<span id="cb50-3"><a href="#cb50-3" tabindex="-1"></a>y<span class="sc">:</span>  <span class="dv">1</span>  <span class="dv">2</span>  <span class="dv">3</span>  <span class="dv">4</span>  <span class="dv">5</span>  <span class="dv">6</span>  <span class="dv">7</span></span>
<span id="cb50-4"><a href="#cb50-4" tabindex="-1"></a><span class="sc">-----------------------</span></span>
<span id="cb50-5"><a href="#cb50-5" tabindex="-1"></a>    <span class="dv">2</span>  <span class="dv">4</span>  <span class="dv">6</span>  <span class="dv">5</span>  <span class="dv">7</span>  <span class="dv">9</span>  <span class="dv">8</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">まとめ</h3>
<div class="callout-content">
<ul>
<li>Use vectorized operations instead of loops.</li>
</ul>
</div>
</div>
</div></section><section id="aio-10-functions"><p>Content from <a href="10-functions.html">Functions Explained</a></p>
<hr>
<p>最終更新日：2024-10-12 |

        <a href="https://github.com/swcarpentry-ja/r-novice-gapminder/edit/main/episodes/10-functions.Rmd" class="external-link">ページの編集 <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>所要時間：<i aria-hidden="true" data-feather="clock"></i> 60分</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="回答を全て表示する " data-collapse="回答を全て折りたたむ "> 回答を全て表示する <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">概要</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">質問</h3>
<ul>
<li>How can I write a new function in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">目的</h3>
<ul>
<li>Define a function that takes arguments.</li>
<li>Return a value from a function.</li>
<li>Check argument conditions with <code>stopifnot()</code> in
functions.</li>
<li>Test a function.</li>
<li>Set default values for function arguments.</li>
<li>Explain why we should divide programs into small, single-purpose
functions.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>分析したいデータセットが一つだけなら、ファイルを表計算ソフトで読み込み、単純な統計値をプロットした方が早いでしょう。
しかし、gapmider
データは定期的に更新されるので、後から新しい情報を読み込み分析し直したくなります。
また、将来的には似たようなデータを違う場所から入手することもあるでしょう。</p>
<p>この講義では関数の書き方を学ぶことで、同じ操作を一つのコマンドで繰り返せるようになります。</p>
<div id="関数とは何でしょう" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="関数とは何でしょう" class="callout-inner">
<h3 class="callout-title">関数とは何でしょう？</h3>
<div class="callout-content">
<p>関数は連続した操作を一つに纏め、後から使うときのために保存しておきます。
Functions provide:</p>
<ul>
<li>a name we can remember and invoke it by</li>
<li>relief from the need to remember the individual operations</li>
<li>a defined set of inputs and expected outputs</li>
<li>rich connections to the larger programming environment</li>
</ul>
<p>As the basic building block of most programming languages,
user-defined functions constitute “programming” as much as any single
abstraction can.
関数を書いた時点であなたはコンピュータープログラマーです。</p>
</div>
</div>
</div>
<section><h2 class="section-heading" id="関数を定義しましょう">関数を定義しましょう。<a class="anchor" aria-label="anchor" href="#%E9%96%A2%E6%95%B0%E3%82%92%E5%AE%9A%E7%BE%A9%E3%81%97%E3%81%BE%E3%81%97%E3%82%87%E3%81%86"></a>
</h2>
<hr class="half-width">
<p><code>functions/</code> ディレクトリ内に新しく functions-lesson.R
と名付けた R スクリプトを作成して開きましょう。</p>
<p>The general structure of a function is:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">parameters</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># perform action</span></span>
<span>  <span class="co"># return value</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>華氏をケルビンに変換する <code>fahr_to_kelvin()</code>
という関数を定義しましょう。</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fahr_to_kelvin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">kelvin</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">temp</span> <span class="op">-</span> <span class="fl">32</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">5</span> <span class="op">/</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">273.15</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">kelvin</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p><code>fahr_to_kelvin()</code>
を定義するには、<code>fahr_to_kelvin</code> に <code>function</code>
の出力を指定します。 引数の名前の一覧は括弧に中に書きます。 次に関数の<a href="../%7B%7D/reference/#function-body">本文 (body)</a> として
走らせた時の実行内容を波括弧 (<code>{}</code>) の中に記述します。
本文はスペース二つでインデントしておきます。
これによりコードの操作内容を変更せずに可読性を向上させます。</p>
<p>It is useful to think of creating functions like writing a cookbook.
First you define the “ingredients” that your function needs. In this
case, we only need one ingredient to use our function: “temp”. After we
list our ingredients, we then say what we will do with them, in this
case, we are taking our ingredient and applying a set of mathematical
operators to it.</p>
<p>関数を呼び出す時、引数に指定した値は関数内で用いられる変数に与えられます。
関数の中では関数を呼び出した相手に結果を送るために <a href="../%7B%7D/reference/#return-statement">return 文</a> を用います。</p>
<div id="ヒント" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント" class="callout-inner">
<h3 class="callout-title">ヒント</h3>
<div class="callout-content">
<p>return 文が不要なことは R の変わった特徴の一つです。 R
では関数の本文の最終行に記述された変数が自動的に返り値になります。
しかし、わかりやすくするために return 文を明示的に記述します。</p>
</div>
</div>
</div>
<p>関数を実行してみましょう。
自分の関数を呼び出す方法は他の関数を呼び出す方法と同じです。</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 水の凝固点 fahr_to_kelvin(32)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 水の沸点 fahr_to_kelvin(212)</span></span></code></pre>
</div>
<div id="チャレンジ１" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ１" class="callout-inner">
<h3 class="callout-title">チャレンジ１</h3>
<div class="callout-content">
<p>Write a function called <code>kelvin_to_celsius()</code> that takes a
temperature in Kelvin and returns that temperature in Celsius.</p>
<p>Hint: To convert from Kelvin to Celsius you subtract 273.15</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  チャレンジ８の解答 1
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>Write a function called <code>kelvin_to_celsius</code> that takes a
temperature in Kelvin and returns that temperature in Celsius</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kelvin_to_celsius</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span> <span class="op">{</span></span>
<span> <span class="va">celsius</span> <span class="op">&lt;-</span> <span class="va">temp</span> <span class="op">-</span> <span class="fl">273.15</span></span>
<span> <span class="kw">return</span><span class="op">(</span><span class="va">celsius</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="関数を組み合わせましょう">関数を組み合わせましょう<a class="anchor" aria-label="anchor" href="#%E9%96%A2%E6%95%B0%E3%82%92%E7%B5%84%E3%81%BF%E5%90%88%E3%82%8F%E3%81%9B%E3%81%BE%E3%81%97%E3%82%87%E3%81%86"></a>
</h2>
<hr class="half-width">
<p>関数の真髄を発揮するのは、関数を混ぜ合わせ組み合わせてより多きな塊にすることで、望み通りの効果を得る時です。</p>
<p>華氏をケルビンに変換する関数とケルビンをセ氏に変換する関数の2つを定義しましょう。</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fahr_to_kelvin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">kelvin</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">temp</span> <span class="op">-</span> <span class="fl">32</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">5</span> <span class="op">/</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">273.15</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">kelvin</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">kelvin_to_celsius</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">celsius</span> <span class="op">&lt;-</span> <span class="va">temp</span> <span class="op">-</span> <span class="fl">273.15</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">celsius</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<div id="チャレンジ２" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ２" class="callout-inner">
<h3 class="callout-title">チャレンジ２</h3>
<div class="callout-content">
<p>Define the function to convert directly from Fahrenheit to Celsius,
by reusing the two functions above (or using your own functions if you
prefer).</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  チャレンジ８の解答
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>Define the function to convert directly from Fahrenheit to Celsius,
by reusing these two functions above</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fahr_to_celsius</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">temp_k</span> <span class="op">&lt;-</span> <span class="fu">fahr_to_kelvin</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">kelvin_to_celsius</span><span class="op">(</span><span class="va">temp_k</span><span class="op">)</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="幕間-防衛的プログラミング">幕間: 防衛的プログラミング<a class="anchor" aria-label="anchor" href="#%E5%B9%95%E9%96%93-%E9%98%B2%E8%A1%9B%E7%9A%84%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0"></a>
</h2>
<hr class="half-width">
<p>関数を書くことで R
のコードを効率的に再利用したりモジュール化する方法を理解し始めたところですが、
関数は想定した用途でのみ機能するように確実に設計することが重要です。
関数の引数を検査することは 防衛的プログラミング の考え方に繋がります。
防衛的プログラミングでは状況を頻繁に検査し何かおかしなことがあればエラーを返すことを推奨します。
このような検査は、プログラム実行を継続する前に現状が <code>TRUE</code>
であることをアサート（表明・断言）するので、アサーション文と呼ばれます。
アサーション文により、エラーがどこで起きているか分かりやすくなりデバッグが容易になります。</p>
<div class="section level3">
<h3 id="stopifnot-を用いて状態を検査しましょう">
<code>stopifnot()</code> を用いて状態を検査しましょう<a class="anchor" aria-label="anchor" href="#stopifnot-%E3%82%92%E7%94%A8%E3%81%84%E3%81%A6%E7%8A%B6%E6%85%8B%E3%82%92%E6%A4%9C%E6%9F%BB%E3%81%97%E3%81%BE%E3%81%97%E3%82%87%E3%81%86"></a>
</h3>
<p>華氏をケルビンに変換する <code>fahr_to_kelvin()</code>
関数について再検討してみましょう。 この関数の定義は以下の通りです。</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fahr_to_kelvin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">kelvin</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">temp</span> <span class="op">-</span> <span class="fl">32</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">5</span> <span class="op">/</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">273.15</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">kelvin</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>For this function to work as intended, the argument <code>temp</code>
must be a <code>numeric</code> value; otherwise, the mathematical
procedure for converting between the two temperature scales will not
work. To create an error, we can use the function <code>stop()</code>.
For example, since the argument <code>temp</code> must be a
<code>numeric</code> vector, we could check for this condition with an
<code>if</code> statement and throw an error if the condition was
violated. We could augment our function above like so:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fahr_to_kelvin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu">is.numeric</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">stop</span><span class="op">(</span><span class="st">"temp must be a numeric vector."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">kelvin</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">temp</span> <span class="op">-</span> <span class="fl">32</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">5</span> <span class="op">/</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">273.15</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">kelvin</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>複数の状態や引数を検査する必要があると、全てを検査するためのコードは何行にも渡ります。
幸いなことに R は <code>stopifnot</code>
という便利な関数を提供しています。 <code>TRUE</code>
と評価されるべき要件を必要なだけ列挙すると、 <code>stopifnot()</code>
は一つでも <code>FALSE</code> がある場合にエラーを返します。
検査項目を列挙すると、追加のドキュメント化という2つ目の目的としても機能します。</p>
<p><code>stopifnot()</code> を用いて <code>fahr_to_kelvin()</code>
に入力を検査するアサーション文を追加し、
防衛的プログラミングに挑戦しましょう。</p>
<p><code>temp</code> が数値ベクトルであることをアサートしたいとします。
以下のようにしましょう。</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fahr_to_kelvin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">stopifnot</span><span class="op">(</span><span class="fu">is.numeric</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">kelvin</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">temp</span> <span class="op">-</span> <span class="fl">32</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">5</span> <span class="op">/</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">273.15</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">kelvin</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>入力が適切であればこれでも機能します。</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 水の凝固点 fahr_to_kelvin(temp = 32)</span></span></code></pre>
</div>
<p>しかし不適切な入力があるとすぐに失敗します。</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Metric is a factor instead of numeric</span></span>
<span><span class="fu">fahr_to_kelvin</span><span class="op">(</span>temp <span class="op">=</span> <span class="fu">as.factor</span><span class="op">(</span><span class="fl">32</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in fahr_to_kelvin(temp = as.factor(32)): is.numeric(temp) is not TRUE</code></pre>
</div>
<div id="チャレンジ３" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ３" class="callout-inner">
<h3 class="callout-title">チャレンジ３</h3>
<div class="callout-content">
<p>防衛的プログラミングにより、<code>fahr_to_celsius()</code> 関数の
<code>temp</code> 引数に不適切な
値が指定されたらすぐにエラーを返すよう念押しして下さい。</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>チャレンジ３の解答 明示的に <code>stopifnot()</code>
を呼ぶことで先述の関数の定義を拡張しましょう。
<code>fahr_to_celsius()</code> は2つの他の関数から構成されているので、
ここでの検査は2つの関数の検査に追加され冗長になります。</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fahr_to_celsius</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">stopifnot</span><span class="op">(</span><span class="fu">is.numeric</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">temp_k</span> <span class="op">&lt;-</span> <span class="fu">fahr_to_kelvin</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">kelvin_to_celsius</span><span class="op">(</span><span class="va">temp_k</span><span class="op">)</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="もっと関数を組み合わせましょう">もっと関数を組み合わせましょう<a class="anchor" aria-label="anchor" href="#%E3%82%82%E3%81%A3%E3%81%A8%E9%96%A2%E6%95%B0%E3%82%92%E7%B5%84%E3%81%BF%E5%90%88%E3%82%8F%E3%81%9B%E3%81%BE%E3%81%97%E3%82%87%E3%81%86"></a>
</h2>
<hr class="half-width">
<p>ここで我々のデータセットで利用できるデータからある国の国内総生産を計算するための関数を定義します。</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># データセットを受け取り、人口の列と一人あたりのGDPをかけます。 calcGDP &lt;- function(dat) { gdp &lt;- dat$pop dat$gdpPercap return(gdp}</span></span></code></pre>
</div>
<p><code>calcGDP()</code> を定義するために、<code>function</code>
の結果を <code>calcGDP</code> に代入します。
引数の名前の一覧は括弧に中に書きます。 次に、本文 –
関数を読んだ時に実行される命令文 – は波括弧 (<code>{}</code>)
の中に書きます。</p>
<p>本文中の命令文は2つのスペースでインデントしました。
これにより関数の動作に影響を及ぼさずに可読性を向上できます。</p>
<p>関数を呼び出す時に、関数に渡した値は引数に指定され、
関数の本文中における変数になります。</p>
<p>関数の中では <code>return()</code> 関数を用いて結果を返します。
<code>return()</code> 関数は必須ではなく、R は
関数の最終行で実行されたコマンドの結果を自動的に返します。</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">calcGDP</span><span class="op">(</span><span class="fu">head</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in calcGDP(head(gapminder)): could not find function "calcGDP"</code></pre>
</div>
<p>That’s not very informative.
これでは情報に乏しいです。いくつか引数を追加して、年ごとと国ごとの情報を得られるようにしましょう。</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># データセットを受け取り、人口の列と一人あたりのGDPの列をかけます。 calcGDP &lt;- function(dat, year=NULL, country=NULL) { if(!is.null(year)) { dat &lt;- dat[dat$year %in% year, ] } if (!is.null(country)) { dat &lt;- dat[dat$country %in% country,] } gdp &lt;- dat$pop dat$gdpPercap new &lt;- cbind(dat, gdp=gdp) return(new}</span></span></code></pre>
</div>
<p>もしこれらの関数を別の R スクリプトに書いているなら
(グッドアイディア！)、 <code>source()</code> 関数を使って関数を R
セッションに読み込むことができます。</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">source</span><span class="op">(</span><span class="st">"functions/functions-lesson.R"</span><span class="op">)</span></span></code></pre>
</div>
<p>Ok, so there’s a lot going on in this function now. In plain English,
the function now subsets the provided data by year if the year argument
isn’t empty, then subsets the result by country if the country argument
isn’t empty. Then it calculates the GDP for whatever subset emerges from
the previous two steps. The function then adds the GDP as a new column
to the subsetted data and returns this as the final result. You can see
that the output is much more informative than a vector of numbers.</p>
<p><code>year</code> を指定した時に何が起きるか見てみましょう。</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="fu">calcGDP</span><span class="op">(</span><span class="va">gapminder</span>, year<span class="op">=</span><span class="fl">2007</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in calcGDP(gapminder, year = 2007): could not find function "calcGDP"</code></pre>
</div>
<p>また <code>country</code> を指定するとどうなるでしょうか。</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">calcGDP</span><span class="op">(</span><span class="va">gapminder</span>, country<span class="op">=</span><span class="st">"Australia"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in calcGDP(gapminder, country = "Australia"): could not find function "calcGDP"</code></pre>
</div>
<p>あるいは両方指定してみましょう。</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">calcGDP</span><span class="op">(</span><span class="va">gapminder</span>, year<span class="op">=</span><span class="fl">2007</span>, country<span class="op">=</span><span class="st">"Australia"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in calcGDP(gapminder, year = 2007, country = "Australia"): could not find function "calcGDP"</code></pre>
</div>
<p>関数の本文を順番に見ていきましょう。</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>calcGDP <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, <span class="at">year=</span><span class="cn">NULL</span>, <span class="at">country=</span><span class="cn">NULL</span>) {</span></code></pre>
</div>
<p>ここで <code>year</code> と <code>country</code>
の二つの引数を追加しました。 <code>=</code>
演算子を関数定義時に用いることで、両者の 既定値 には <code>NULL</code>
を指定しています。
これにより、ユーザーが値を指定しない限り、これらの引数の値は
<code>NULL</code> になることを意味します。</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu">is.null</span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">year</span> <span class="op">%in%</span> <span class="va">year</span>, <span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu">is.null</span><span class="op">(</span><span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">country</span> <span class="op">%in%</span> <span class="va">country</span>,<span class="op">]</span></span>
<span>  <span class="op">}</span></span></code></pre>
</div>
<p>ここでは、追加した引数それぞれについて値が <code>NULL</code>
であるか確認し、 <code>NULL</code> でなければ <code>dat</code>
に格納されたデータセットを非 <code>NULL</code>
な引数の値を用いて絞り込み上書きします。</p>
<p>Building these conditionals into the function makes it more flexible
for later. この関数を用いて、以下の様々な場合のGDPを計算できます。</p>
<ul>
<li>データセット全体</li>
<li>ある年</li>
<li>ある国</li>
<li>ある年とある国の組み合わせ</li>
</ul>
<p>代わりに <code>%in%</code> を使うことによって、<code>year</code> と
<code>country</code> に複数の値を指定できるようになっています。</p>
<div id="tip-値渡し" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-値渡し" class="callout-inner">
<h3 class="callout-title">Tip: 値渡し</h3>
<div class="callout-content">
<p>Functions in R almost always make copies of the data to operate on
inside of a function body. When we modify <code>dat</code> inside the
function we are modifying the copy of the gapminder dataset stored in
<code>dat</code>, not the original variable we gave as the first
argument.</p>
<p>This is called “pass-by-value” and it makes writing code much safer:
you can always be sure that whatever changes you make within the body of
the function, stay inside the body of the function.</p>
</div>
</div>
</div>
<div id="tip-関数のスコープ" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-関数のスコープ" class="callout-inner">
<h3 class="callout-title">Tip: 関数のスコープ</h3>
<div class="callout-content">
<p>Another important concept is scoping: any variables (or functions!)
you create or modify inside the body of a function only exist for the
lifetime of the function’s execution.
関数の本文中で作成したり変更したいかなる変数 (関数を含む！) は、
関数を実行している間だけ存在します。<code>calcGDP()</code>
を呼んだ時に、 <code>dat</code>、<code>gdp</code>、そして
<code>new</code> という変数は関数の本文中でのみ存在します。 対話的な R
のセッションにおいて同名の変数が存在していたとして、
それらは関数実行時に変更されることはありません。</p>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>  gdp <span class="ot">&lt;-</span> dat<span class="sc">$</span>pop <span class="sc">*</span> dat<span class="sc">$</span>gdpPercap</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>  new <span class="ot">&lt;-</span> <span class="fu">cbind</span>(dat, <span class="at">gdp=</span>gdp)</span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>  <span class="fu">return</span>(new)</span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a><span class="er">}</span></span></code></pre>
</div>
<p>Finally, we calculated the GDP on our new subset, and created a new
data frame with that column added.
最終的に、絞り込んだデータからGDPを計算し、その結果を列に追加した新しいデータフレームを作成しました。
これは関数を呼び出した後でも返り値のGDPの値が持つ文脈がわかることを意味します。
従って、最初に試した数値のベクトルを返す方法よりもずっと良いものです。</p>
<div id="チャレンジ４" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ４" class="callout-inner">
<h3 class="callout-title">チャレンジ４</h3>
<div class="callout-content">
<p>GDP を計算する関数をテストするため、1987年の New Zealand の GDP
を計算して下さい。 1952 年の New Zealand の GDP とはどう違いますか？</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  チャレンジ８の解答
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu">calcGDP</span><span class="op">(</span><span class="va">gapminder</span>, year <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1952</span>, <span class="fl">1987</span><span class="op">)</span>, country <span class="op">=</span> <span class="st">"New Zealand"</span><span class="op">)</span></span></code></pre>
</div>
<p>GDP for New Zealand in 1987: 65050008703</p>
<p>GDP for New Zealand in 1952: 21058193787</p>
</div>
</div>
</div>
</div>
<div id="チャレンジ５" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ５" class="callout-inner">
<h3 class="callout-title">チャレンジ５</h3>
<div class="callout-content">
<p>The <code>paste()</code> function can be used to combine text
together, e.g:</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">best_practice</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"Write"</span>, <span class="st">"programs"</span>, <span class="st">"for"</span>, <span class="st">"people"</span>, <span class="st">"not"</span>, <span class="st">"computers"</span><span class="op">)</span></span>
<span><span class="fu">paste</span><span class="op">(</span><span class="va">best_practice</span>, collapse<span class="op">=</span><span class="st">" "</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Write programs for people not computers"</code></pre>
</div>
<p>Write a function called <code>fence()</code> that takes two vectors
as arguments, called <code>text</code> and <code>wrapper</code>, and
prints out the text wrapped with the <code>wrapper</code>:</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fence</span><span class="op">(</span>text<span class="op">=</span><span class="va">best_practice</span>, wrapper<span class="op">=</span><span class="st">"***"</span><span class="op">)</span></span></code></pre>
</div>
<p><em>Note:</em> the <code>paste()</code> function has an argument
called <code>sep</code>, which specifies the separator between text. The
default is a space: ” “. The default for <code>paste0()</code> is no
space”“.</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">
  チャレンジ８の解答
  </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<p>Write a function called <code>fence()</code> that takes two vectors
as arguments, called <code>text</code> and <code>wrapper</code>, and
prints out the text wrapped with the <code>wrapper</code>:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fence</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">text</span>, <span class="va">wrapper</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">text</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">wrapper</span>, <span class="va">text</span>, <span class="va">wrapper</span><span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">paste</span><span class="op">(</span><span class="va">text</span>, collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">best_practice</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"Write"</span>, <span class="st">"programs"</span>, <span class="st">"for"</span>, <span class="st">"people"</span>, <span class="st">"not"</span>, <span class="st">"computers"</span><span class="op">)</span></span>
<span><span class="fu">fence</span><span class="op">(</span>text<span class="op">=</span><span class="va">best_practice</span>, wrapper<span class="op">=</span><span class="st">"***"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "*** Write programs for people not computers ***"</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="ヒント-1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント-1" class="callout-inner">
<h3 class="callout-title">ヒント</h3>
<div class="callout-content">
<p>R より複雑な演算を行う時に利用できる変わった機能があります。
ここでは発展的な概念を知っておく必要のあることは書きません。 将来的に R
で関数を書くことに慣れたら、 <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Environment-objects" class="external-link">R
Language Manual</a> や Hadley Wickham による <a href="https://adv-r.had.co.nz/" class="external-link">Advanced R Programming</a>
のこの[章][]を読んで学んで下さい。</p>
</div>
</div>
</div>
<div id="tip-テストとドキュメント" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-テストとドキュメント" class="callout-inner">
<h3 class="callout-title">Tip: テストとドキュメント</h3>
<div class="callout-content">
<p>It’s important to both test functions and document them:
Documentation helps you, and others, understand what the purpose of your
function is, and how to use it, and its important to make sure that your
function actually does what you think.</p>
<p>When you first start out, your workflow will probably look a lot like
this:</p>
<ol style="list-style-type: decimal">
<li>Write a function</li>
<li>Comment parts of the function to document its behaviour</li>
<li>Load in the source file</li>
<li>Experiment with it in the console to make sure it behaves as you
expect</li>
<li>Make any necessary bug fixes</li>
<li>Rinse and repeat.</li>
</ol>
<p>Formal documentation for functions, written in separate
<code>.Rd</code> files, gets turned into the documentation you see in
help files. The <a href="https://cran.r-project.org/web/packages/roxygen2/vignettes/rd.html" class="external-link">roxygen2</a>
package allows R coders to write documentation alongside the function
code and then process it into the appropriate <code>.Rd</code> files.
You will want to switch to this more formal method of writing
documentation when you start writing more complicated R projects. In
fact, packages are, in essence, bundles of functions with this formal
documentation. Loading your own functions through
<code>source("functions.R")</code> is equivalent to loading someone
else’s functions (or your own one day!) through
<code>library("package")</code>.</p>
<p>Formal automated tests can be written using the <a href="https://r-pkgs.had.co.nz/tests.html" class="external-link">testthat</a> package.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">まとめ</h3>
<div class="callout-content">
<ul>
<li>Use <code>function</code> to define a new function in R.</li>
<li>Use parameters to pass values into functions.</li>
<li>Use <code>stopifnot()</code> to flexibly check function arguments in
R.</li>
<li>Load functions into programs using <code>source()</code>.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-11-writing-data"><p>Content from <a href="11-writing-data.html">データの出力</a></p>
<hr>
<p>最終更新日：2024-10-12 |

        <a href="https://github.com/swcarpentry-ja/r-novice-gapminder/edit/main/episodes/11-writing-data.Rmd" class="external-link">ページの編集 <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>所要時間：<i aria-hidden="true" data-feather="clock"></i> 20分</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="回答を全て表示する " data-collapse="回答を全て折りたたむ "> 回答を全て表示する <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">概要</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">質問</h3>
<ul>
<li>How can I save plots and data created in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">目的</h3>
<ul>
<li>To be able to write out plots and data from R.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="saving-plots">Saving plots<a class="anchor" aria-label="anchor" href="#saving-plots"></a>
</h2>
<hr class="half-width">
<p><code>ggsave</code> 関数を使って、<code>ggplot2</code>
を用いて作った直近の図を保存する方法は既に学んだ通りです。
おさらいしておきましょう。</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggsave</span><span class="op">(</span><span class="st">"My_most_recent_plot.pdf"</span><span class="op">)</span></span></code></pre>
</div>
<p>RStudio から図を保存するには “Plot” ウィンドウにある “Export”
ボタンを使います。 この機能を使うと、図を .pdf や .png、.jpg
など様々な画像形式で保存することができます。</p>
<p>図を “Plot”
ウィンドウに表示することなく保存したいこともあるでしょう。
ページごとに一つの図を含むような複数のページから成る PDF
を出力したいこともあるでしょう。
あるいはループを使ってファイル中のデータの絞り込み条件を変えながら複数の図を作成していて、
一つずつ保存するためにいちいちループを止めて “Export”
ボタンを押すことが不可能な場合もあるでしょう。</p>
<p>このような場合、より柔軟な方法を使います。 <code>pdf</code>
関数は新たに PDF デバイスを作ります。
この関数に引数を指定することで、サイズや解像度を調整できます。</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="sc">~</span><span class="er">~~</span> <span class="fu">pdf</span>(<span class="st">"Life_Exp_vs_time.pdf"</span>, <span class="at">width=</span><span class="dv">12</span>, <span class="at">height=</span><span class="dv">4</span>) <span class="fu">ggplot</span>(<span class="at">data=</span>gapminder, <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>lifeExp, <span class="at">colour=</span>country)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="co"># PDF デバイスを確実に終了しておく必要があります！</span></span></code></pre>
</div>
<p>このドキュメントを開いて内容を確認してみましょう。</p>
<div id="チャレンジ１" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ１" class="callout-inner">
<h3 class="callout-title">チャレンジ１</h3>
<div class="callout-content">
<p>Rewrite your ‘pdf’ command to print a second page in the pdf, showing
a facet plot (hint: use <code>facet_grid</code>) of the same data with
one panel per continent.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  チャレンジ８の解答 1
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pdf</span><span class="op">(</span><span class="st">"Life_Exp_vs_time.pdf"</span>, width <span class="op">=</span> <span class="fl">12</span>, height <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">lifeExp</span>, colour <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span><span class="va">p</span></span>
<span><span class="va">p</span> <span class="op">+</span> <span class="fu">facet_grid</span><span class="op">(</span><span class="op">~</span><span class="va">continent</span><span class="op">)</span></span>
<span><span class="fu">dev.off</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>同様にして <code>jepg</code> や <code>png</code>
などのコマンドを使うことで、他の形式のドキュメントを作成できます。</p>
</section><section><h2 class="section-heading" id="データの出力">データの出力<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%87%BA%E5%8A%9B"></a>
</h2>
<hr class="half-width">
<p>R からデータを出力したいこともあります。</p>
<p>これには、既に使った <code>read.table</code> 関数とよく似た
<code>write.table</code> 関数を使います。</p>
<p>データを綺麗にするスクリプトを書きましょう。
今回の分析では、gapminder
データの中のオーストラリアに該当する部分だけを使います。</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aust_subset</span> <span class="op">&lt;-</span> <span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">country</span> <span class="op">==</span> <span class="st">"Australia"</span>,<span class="op">]</span></span>
<span></span>
<span><span class="fu">write.table</span><span class="op">(</span><span class="va">aust_subset</span>,</span>
<span>  file<span class="op">=</span><span class="st">"cleaned-data/gapminder-aus.csv"</span>,</span>
<span>  sep<span class="op">=</span><span class="st">","</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>シェルに戻ってデータが正しく出力されているか確認しましょうOK:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">head</span> cleaned-data/gapminder-aus.csv</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>"country","year","pop","continent","lifeExp","gdpPercap"
"61","Australia",1952,8691212,"Oceania",69.12,10039.59564
"62","Australia",1957,9712569,"Oceania",70.33,10949.64959
"63","Australia",1962,10794968,"Oceania",70.93,12217.22686
"64","Australia",1967,11872264,"Oceania",71.1,14526.12465
"65","Australia",1972,13177000,"Oceania",71.93,16788.62948
"66","Australia",1977,14074100,"Oceania",73.49,18334.19751
"67","Australia",1982,15184200,"Oceania",74.74,19477.00928
"68","Australia",1987,16257249,"Oceania",76.32,21888.88903
"69","Australia",1992,17481977,"Oceania",77.56,23424.76683</code></pre>
</div>
<p>Hmm, that’s not quite what we wanted. Where did all these quotation
marks come from? Also the row numbers are meaningless.</p>
<p>ヘルプファイルを見てこの動作を変更しましょう。</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">write.table</span></span></code></pre>
</div>
<p>既定では、R は文字列をファイルに出力する時に引用符で囲みます。
また、行と列の名前も出力します。</p>
<p>以下のように修正しましょう。</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">write.table</span><span class="op">(</span></span>
<span>  <span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">country</span> <span class="op">==</span> <span class="st">"Australia"</span>,<span class="op">]</span>,</span>
<span>  file<span class="op">=</span><span class="st">"cleaned-data/gapminder-aus.csv"</span>,</span>
<span>  sep<span class="op">=</span><span class="st">","</span>, quote<span class="op">=</span><span class="cn">FALSE</span>, row.names<span class="op">=</span><span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>もう一度シェルを使ってデータを確認してみましょう。</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">head</span> cleaned-data/gapminder-aus.csv</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>country,year,pop,continent,lifeExp,gdpPercap
Australia,1952,8691212,Oceania,69.12,10039.59564
Australia,1957,9712569,Oceania,70.33,10949.64959
Australia,1962,10794968,Oceania,70.93,12217.22686
Australia,1967,11872264,Oceania,71.1,14526.12465
Australia,1972,13177000,Oceania,71.93,16788.62948
Australia,1977,14074100,Oceania,73.49,18334.19751
Australia,1982,15184200,Oceania,74.74,19477.00928
Australia,1987,16257249,Oceania,76.32,21888.88903
Australia,1992,17481977,Oceania,77.56,23424.76683</code></pre>
</div>
<p>よくなりました！</p>
<div id="チャレンジ２" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ２" class="callout-inner">
<h3 class="callout-title">チャレンジ２</h3>
<div class="callout-content">
<p>gapminder
データを1990年以降のデータのみに絞り込むスクリプトを書いて下さい。</p>
<p>このスクリプトを使って絞り込んだ結果を <code>cleaned-data/</code>
ディレクトリ中のファイルに出力しましょう。</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  チャレンジ８の解答
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">チャレンジ1990の解答</span> <span class="op">~</span><span class="op">~</span><span class="op">~</span> <span class="fu">write.table</span><span class="op">(</span> <span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span> , <span class="op">]</span>, file <span class="op">=</span> <span class="st">"cleaned-data/gapminder-after1990.csv"</span>, sep <span class="op">=</span> <span class="st">","</span>, quote <span class="op">=</span> <span class="cn">FALSE</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">まとめ</h3>
<div class="callout-content">
<ul>
<li>Save plots from RStudio using the ‘Export’ button.</li>
<li>Use <code>write.table</code> to save tabular data.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-12-dplyr"><p>Content from <a href="12-dplyr.html">Data Frame Manipulation with dplyr</a></p>
<hr>
<p>最終更新日：2024-10-12 |

        <a href="https://github.com/swcarpentry-ja/r-novice-gapminder/edit/main/episodes/12-dplyr.Rmd" class="external-link">ページの編集 <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>所要時間：<i aria-hidden="true" data-feather="clock"></i> 55分</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="回答を全て表示する " data-collapse="回答を全て折りたたむ "> 回答を全て表示する <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">概要</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">質問</h3>
<ul>
<li>How can I manipulate data frames without repeating myself?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">目的</h3>
<ul>
<li>To be able to use the six main data frame manipulation ‘verbs’ with
pipes in <code>dplyr</code>.</li>
<li>To understand how <code>group_by()</code> and
<code>summarize()</code> can be combined to summarize datasets.</li>
<li>Be able to analyze a subset of data using logical filtering.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>多くの研究者にとって、データフレームの操作は、多くのことを意味します。
よくあるのは、特定の観測値（行）もしくは変数（列）の選択、
特定の変数でのデータのグループ化、 更には要約する統計値の計算です。
これらは、普通のRの基本操作で実行できます： We can do these operations
using the normal base R operations:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mean</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">gdpPercap</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Africa"</span><span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2193.755</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mean</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">gdpPercap</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Americas"</span><span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 7136.11</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mean</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">gdpPercap</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Asia"</span><span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 7902.15</code></pre>
</div>
<p>でも、これはあまり おススメ
ではありません。繰り返しがかなりあるからです。
繰り返し作業は、時間を食います。そして、嫌なバグを起こる原因にもなりえます。</p>
<section><h2 class="section-heading" id="dplyr-パッケージ">
<code>dplyr</code> パッケージ<a class="anchor" aria-label="anchor" href="#dplyr-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8"></a>
</h2>
<hr class="half-width">
<p>嬉しいことに、<a href="https://cran.r-project.org/package=dplyr" class="external-link"><code>dplyr</code></a>
パッケージには、データフレーム操作に非常に役立つ関数がいくつもあります。
それを使うと、先ほどみたような繰り返しを減らし、エラーを起こす確率を減らし、
タイピングする必要性さえも恐らく減らせます。 更には、<code>dplyr</code>
の書き方は、とても分かりやすいかもしれません。 As an added bonus, you
might even find the <code>dplyr</code> grammar easier to read.</p>
<div id="tip-tidyverse" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-tidyverse" class="callout-inner">
<h3 class="callout-title">Tip: Tidyverse</h3>
<div class="callout-content">
<p><code>dplyr</code> package belongs to a broader family of opinionated
R packages designed for data science called the “Tidyverse”. These
packages are specifically designed to work harmoniously together. Some
of these packages will be covered along this course, but you can find
more complete information here: <a href="https://www.tidyverse.org/" class="external-link">https://www.tidyverse.org/</a>.</p>
</div>
</div>
</div>
<p>ここでは、特によく使われる６つの関数と、
それらを組み合わせるためのパイプ（<code>% %</code>）を紹介します。 .</p>
<ol style="list-style-type: decimal">
<li><code>select()</code></li>
<li><code>filter()</code></li>
<li><code>group_by()</code></li>
<li><code>summarize()</code></li>
<li><code>mutate()</code></li>
</ol>
<p>もし、このパッケージをまだインストールしていないようでしたら、ここでしておきましょう：</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">'dplyr'</span><span class="op">)</span></span></code></pre>
</div>
<p>パッケージをロードしましょう：</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="st">"dplyr"</span><span class="op">)</span></span></code></pre>
</div>
</section><section><h2 class="section-heading" id="select-の使用">select() の使用<a class="anchor" aria-label="anchor" href="#select-%E3%81%AE%E4%BD%BF%E7%94%A8"></a>
</h2>
<hr class="half-width">
<p>例えば、
データフレームにある、いくつかの変数だけを使って進めたい場合、
使えるかもしれないのは、<code>select()</code> 関数です。
これを使えば、選択した変数だけをキープすることができます。</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">year_country_gdp</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">year</span>, <span class="va">country</span>, <span class="va">gdpPercap</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="../fig/13-dplyr-fig1.png" alt="Diagram illustrating use of select function to select two columns of a data frame" class="figure">
If we want to remove one column only from the <code>gapminder</code>
data, for example, removing the <code>continent</code> column.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">smaller_gapminder_data</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="va">gapminder</span>, <span class="op">-</span><span class="va">continent</span><span class="op">)</span></span></code></pre>
</div>
<p>もし <code>year_country_gdp</code> を開いたら、year、country 及び
gdpPercap しかないでしょう。 これまでは、 ‘普通の’
書き方を使いましたが、<code>dplyr</code> の強みは、複数の関数を
パイプを使って、組み合わせられることです。
パイプの書き方は、これまでRで見てきたものとは、
全く違いますので、上記でしたことをパイプを使って、やってみましょう。</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">year_country_gdp</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">year</span>, <span class="va">country</span>, <span class="va">gdpPercap</span><span class="op">)</span></span></code></pre>
</div>
<p>To help you understand why we wrote that in that way, let’s walk
through it step by step. First we summon the gapminder data frame and
pass it on, using the pipe symbol <code>%&gt;%</code>, to the next step,
which is the <code>select()</code> function. In this case we don’t
specify which data object we use in the <code>select()</code> function
since in gets that from the previous pipe. <strong>Fun Fact</strong>:
There is a good chance you have encountered pipes before in the shell.
In R, a pipe symbol is <code>%&gt;%</code> while in the shell it is
<code>|</code> but the concept is the same!</p>
<div id="tip-renaming-data-frame-columns-in-dplyr" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-renaming-data-frame-columns-in-dplyr" class="callout-inner">
<h3 class="callout-title">Tip: Renaming data frame columns in dplyr</h3>
<div class="callout-content">
<p>In Chapter 4 we covered how you can rename columns with base R by
assigning a value to the output of the <code>names()</code> function.
Just like select, this is a bit cumbersome, but thankfully dplyr has a
<code>rename()</code> function.</p>
<p>Within a pipeline, the syntax is
<code>rename(new_name = old_name)</code>. For example, we may want to
rename the gdpPercap column name from our <code>select()</code>
statement above.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_gdp</span> <span class="op">&lt;-</span> <span class="va">year_country_gdp</span> <span class="op">%&gt;%</span> <span class="fu">rename</span><span class="op">(</span>gdp_per_capita <span class="op">=</span> <span class="va">gdpPercap</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">tidy_gdp</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  year     country gdp_per_capita
1 1952 Afghanistan       779.4453
2 1957 Afghanistan       820.8530
3 1962 Afghanistan       853.1007
4 1967 Afghanistan       836.1971
5 1972 Afghanistan       739.9811
6 1977 Afghanistan       786.1134</code></pre>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="filter-の使用">filter() の使用<a class="anchor" aria-label="anchor" href="#filter-%E3%81%AE%E4%BD%BF%E7%94%A8"></a>
</h2>
<hr class="half-width">
<p>欧州のみで、上記を進めたいとしたら、 <code>select</code> と
<code>filter</code> を組み合わせましょう。</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">year_country_gdp_euro</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Europe"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="va">year</span>, <span class="va">country</span>, <span class="va">gdpPercap</span><span class="op">)</span></span></code></pre>
</div>
<p>If we now want to show life expectancy of European countries but only
for a specific year (e.g., 2007), we can do as below.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">europe_lifeExp_2007</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Europe"</span>, <span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">country</span>, <span class="va">lifeExp</span><span class="op">)</span></span></code></pre>
</div>
<div id="チャレンジ１" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ１" class="callout-inner">
<h3 class="callout-title">チャレンジ１</h3>
<div class="callout-content">
<p>Write a single command (which can span multiple lines and includes
pipes) that will produce a data frame that has the African values for
<code>lifeExp</code>, <code>country</code> and <code>year</code>, but
not for other Continents. How many rows does your data frame have and
why?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">year_country_lifeExp_Africa</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>                           <span class="fu">filter</span><span class="op">(</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Africa"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>                           <span class="fu">select</span><span class="op">(</span><span class="va">year</span>, <span class="va">country</span>, <span class="va">lifeExp</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>以前行ったように、gapminder データフレームを <code>filter()</code>
関数に引き渡し、 フィルターされた バージョンのgapminder
データフレームを、 <code>select()</code> 関数に引き渡します。 注意：
ここでは、操作手順がとても重要です。 まず ‘select’
を使うと、その前のステップで、大陸の変数が削除されているため、 filter
で大陸の変数を見つけることができないことでしょう。</p>
</section><section><h2 class="section-heading" id="using-group_by">Using group_by()<a class="anchor" aria-label="anchor" href="#using-group_by"></a>
</h2>
<hr class="half-width">
<p>Now, we were supposed to be reducing the error prone repetitiveness
of what can be done with base R, but up to now we haven’t done that
since we would have to repeat the above for each continent. Instead of
<code>filter()</code>, which will only pass observations that meet your
criteria (in the above: <code>continent=="Europe"</code>), we can use
<code>group_by()</code>, which will essentially use every unique
criteria that you could have used in filter.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	1704 obs. of  6 variables:
 $ country  : chr  "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" ...
 $ year     : int  1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ pop      : num  8425333 9240934 10267083 11537966 13079460 ...
 $ continent: chr  "Asia" "Asia" "Asia" "Asia" ...
 $ lifeExp  : num  28.8 30.3 32 34 36.1 ...
 $ gdpPercap: num  779 821 853 836 740 ...</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">gapminder</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>gropd_df [1,704 × 6] (S3: grouped_df/tbl_df/tbl/data.frame)
 $ country  : chr [1:1704] "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" ...
 $ year     : int [1:1704] 1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ pop      : num [1:1704] 8425333 9240934 10267083 11537966 13079460 ...
 $ continent: chr [1:1704] "Asia" "Asia" "Asia" "Asia" ...
 $ lifeExp  : num [1:1704] 28.8 30.3 32 34 36.1 ...
 $ gdpPercap: num [1:1704] 779 821 853 836 740 ...
 - attr(*, "groups")= tibble [5 × 2] (S3: tbl_df/tbl/data.frame)
  ..$ continent: chr [1:5] "Africa" "Americas" "Asia" "Europe" ...
  ..$ .rows    : list&lt;int&gt; [1:5]
  .. ..$ : int [1:624] 25 26 27 28 29 30 31 32 33 34 ...
  .. ..$ : int [1:300] 49 50 51 52 53 54 55 56 57 58 ...
  .. ..$ : int [1:396] 1 2 3 4 5 6 7 8 9 10 ...
  .. ..$ : int [1:360] 13 14 15 16 17 18 19 20 21 22 ...
  .. ..$ : int [1:24] 61 62 63 64 65 66 67 68 69 70 ...
  .. ..@ ptype: int(0)
  ..- attr(*, ".drop")= logi TRUE</code></pre>
</div>
<p><code>group_by()</code>
（<code>grouped_df</code>）で用いたデータフレームのデータ構造は、もともとの
<code>gapminder</code>
（<code>data.frame</code>）とは異なることに気づいたことでしょう。
<code>grouped_df</code> は、 <code>list</code> のようなものです。その
<code>list</code> にある各項目は、 （少なくとも上記の例では）特定の
<code>continent</code> の値が対応する列のみを含む
<code>data.frame</code> になります。</p>
<figure><img src="../fig/13-dplyr-fig2.png" alt="Diagram illustrating how the group by function oraganizes a data frame into groups" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="summarize-の使用">summarize() の使用<a class="anchor" aria-label="anchor" href="#summarize-%E3%81%AE%E4%BD%BF%E7%94%A8"></a>
</h2>
<hr class="half-width">
<p>The above was a bit on the uneventful side but
<code>group_by()</code> is much more exciting in conjunction with
<code>summarize()</code>. This will allow us to create new variable(s)
by using functions that repeat for each of the continent-specific data
frames. That is to say, using the <code>group_by()</code> function, we
split our original data frame into multiple pieces, then we can run
functions (e.g. <code>mean()</code> or <code>sd()</code>) within
<code>summarize()</code>.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gdp_bycontinents</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>mean_gdpPercap <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/13-dplyr-fig3.png" alt="Diagram illustrating the use of group by and summarize together to create a new variable" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>continent mean_gdpPercap</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>     <span class="sc">&lt;</span>fctr<span class="sc">&gt;</span>          <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="dv">1</span>    Africa       <span class="fl">2193.755</span></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a><span class="dv">2</span>  Americas       <span class="fl">7136.110</span></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a><span class="dv">3</span>      Asia       <span class="fl">7902.150</span></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a><span class="dv">4</span>    Europe      <span class="fl">14469.476</span></span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a><span class="dv">5</span>   Oceania      <span class="fl">18621.609</span></span></code></pre>
</div>
<p>これにより、それぞれの大陸の平均gdpPercapを計算することができますが、
更に、すばらしいことがあるのです。</p>
<div id="チャレンジ２" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ２" class="callout-inner">
<h3 class="callout-title">チャレンジ２</h3>
<div class="callout-content">
<p>Calculate the average life expectancy per country. Which has the
longest average life expectancy and which has the shortest average life
expectancy?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lifeExp_bycountry</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">group_by</span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">summarize</span><span class="op">(</span>mean_lifeExp <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lifeExp_bycountry</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">filter</span><span class="op">(</span><span class="va">mean_lifeExp</span> <span class="op">==</span> <span class="fu">min</span><span class="op">(</span><span class="va">mean_lifeExp</span><span class="op">)</span> <span class="op">|</span> <span class="va">mean_lifeExp</span> <span class="op">==</span> <span class="fu">max</span><span class="op">(</span><span class="va">mean_lifeExp</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 2 × 2
  country      mean_lifeExp
  &lt;chr&gt;               &lt;dbl&gt;
1 Iceland              76.5
2 Sierra Leone         36.8</code></pre>
</div>
<p>Another way to do this is to use the <code>dplyr</code> function
<code>arrange()</code>, which arranges the rows in a data frame
according to the order of one or more variables from the data frame. It
has similar syntax to other functions from the <code>dplyr</code>
package. You can use <code>desc()</code> inside <code>arrange()</code>
to sort in descending order.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lifeExp_bycountry</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">arrange</span><span class="op">(</span><span class="va">mean_lifeExp</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">head</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1 × 2
  country      mean_lifeExp
  &lt;chr&gt;               &lt;dbl&gt;
1 Sierra Leone         36.8</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lifeExp_bycountry</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">mean_lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">head</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1 × 2
  country mean_lifeExp
  &lt;chr&gt;          &lt;dbl&gt;
1 Iceland         76.5</code></pre>
</div>
<p>Alphabetical order works too</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lifeExp_bycountry</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">head</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1 × 2
  country  mean_lifeExp
  &lt;chr&gt;           &lt;dbl&gt;
1 Zimbabwe         52.7</code></pre>
</div>
</div>
</div>
</div>
</div>
<p><code>group_by()</code>
の関数では、複数の変数でグループ化するこもできます。 <code>year</code>
と <code>continent</code> でグループ分けしてみましょう。</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gdp_bycontinents_byyear</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>mean_gdpPercap <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'continent'. You can override using the
`.groups` argument.</code></pre>
</div>
<p>That is already quite powerful, but it gets even better! You’re not
limited to defining 1 new variable in <code>summarize()</code>.</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gdp_pop_bycontinents_byyear</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>mean_gdpPercap <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span>,</span>
<span>              sd_gdpPercap <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span>,</span>
<span>              mean_pop <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>,</span>
<span>              sd_pop <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">pop</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'continent'. You can override using the
`.groups` argument.</code></pre>
</div>
</section><section><h2 class="section-heading" id="count-及び-n">count() 及び n()<a class="anchor" aria-label="anchor" href="#count-%E5%8F%8A%E3%81%B3-n"></a>
</h2>
<hr class="half-width">
<p>A very common operation is to count the number of observations for
each group. The <code>dplyr</code> package comes with two related
functions that help with this.</p>
<p>例えば、2002年のデータセットにある国の数を確認したい場合、
<code>count()</code> 関数が使えます。
興味のあるグループのひとつかいくつかの行の名前を取り、
<code>sort=TRUE</code>
を加えることで、結果を降順に並べることもできます：</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2002</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">count</span><span class="op">(</span><span class="va">continent</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  continent  n
1    Africa 52
2      Asia 33
3    Europe 30
4  Americas 25
5   Oceania  2</code></pre>
</div>
<p>演算の際の観測値の数が必要な場合 <code>n()</code> 関数が使えます。 It
will return the total number of observations in the current group rather
than counting the number of observations in each group within a specific
column. 例えば、大陸別平均余命の標準誤差を得たいとします：</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>se_le <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">/</span><span class="fu">sqrt</span><span class="op">(</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 5 × 2
  continent se_le
  &lt;chr&gt;     &lt;dbl&gt;
1 Africa    0.366
2 Americas  0.540
3 Asia      0.596
4 Europe    0.286
5 Oceania   0.775</code></pre>
</div>
<p>いくつかの要約計算を、つなぎ合わせることもできます。つまり、ここでは各大陸の国別平均余命の
<code>minimum</code> 、 <code>maximum</code> 、 <code>mean</code> 及び
<code>se</code> となります：</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span></span>
<span>      mean_le <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span>,</span>
<span>      min_le <span class="op">=</span> <span class="fu">min</span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span>,</span>
<span>      max_le <span class="op">=</span> <span class="fu">max</span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span>,</span>
<span>      se_le <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">/</span><span class="fu">sqrt</span><span class="op">(</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 5 × 5
  continent mean_le min_le max_le se_le
  &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
1 Africa       48.9   23.6   76.4 0.366
2 Americas     64.7   37.6   80.7 0.540
3 Asia         60.1   28.8   82.6 0.596
4 Europe       71.9   43.6   81.8 0.286
5 Oceania      74.3   69.1   81.2 0.775</code></pre>
</div>
</section><section><h2 class="section-heading" id="mutate-の使用">mutate() の使用<a class="anchor" aria-label="anchor" href="#mutate-%E3%81%AE%E4%BD%BF%E7%94%A8"></a>
</h2>
<hr class="half-width">
<p>情報を要約する前に（もしくは後にでも）、 <code>mutate()</code>
を使えば、新しい変数を作ることができます。</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gdp_pop_bycontinents_byyear</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>gdp_billion <span class="op">=</span> <span class="va">gdpPercap</span><span class="op">*</span><span class="va">pop</span><span class="op">/</span><span class="fl">10</span><span class="op">^</span><span class="fl">9</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span>,<span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>mean_gdpPercap <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span>,</span>
<span>              sd_gdpPercap <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span>,</span>
<span>              mean_pop <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>,</span>
<span>              sd_pop <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>,</span>
<span>              mean_gdp_billion <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gdp_billion</span><span class="op">)</span>,</span>
<span>              sd_gdp_billion <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">gdp_billion</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'continent'. You can override using the
`.groups` argument.</code></pre>
</div>
</section><section><h2 class="section-heading" id="論理フィルター-ifelse-とmutate-の併用">論理フィルター ifelse とmutate の併用<a class="anchor" aria-label="anchor" href="#%E8%AB%96%E7%90%86%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF%E3%83%BC-ifelse-%E3%81%A8mutate-%E3%81%AE%E4%BD%B5%E7%94%A8"></a>
</h2>
<hr class="half-width">
<p>新しい変数を作る時、論理条件を付けることができます。
似たような組み合わせの <code>mutate()</code> と <code>ifelse()</code>
は、まさに必要な場面、つまり
新しいものを作る時に、フィルターすることができます。
この簡単に読めるコードが、（データフレーム全体の次元を変えずに）あるデータを
排除するための早くて役に立つ方法であり、
与えられた条件によって値を更新する方法なのです。</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## keeping all data but "filtering" after a certain condition</span></span>
<span><span class="co"># calculate GDP only for people with a life expectation above 25</span></span>
<span><span class="va">gdp_pop_bycontinents_byyear_above25</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>gdp_billion <span class="op">=</span> <span class="fu">ifelse</span><span class="op">(</span><span class="va">lifeExp</span> <span class="op">&gt;</span> <span class="fl">25</span>, <span class="va">gdpPercap</span> <span class="op">*</span> <span class="va">pop</span> <span class="op">/</span> <span class="fl">10</span><span class="op">^</span><span class="fl">9</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>mean_gdpPercap <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span>,</span>
<span>              sd_gdpPercap <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span>,</span>
<span>              mean_pop <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>,</span>
<span>              sd_pop <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>,</span>
<span>              mean_gdp_billion <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gdp_billion</span><span class="op">)</span>,</span>
<span>              sd_gdp_billion <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">gdp_billion</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'continent'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## updating only if certain condition is fullfilled</span></span>
<span><span class="co"># for life expectations above 40 years, the gpd to be expected in the future is scaled</span></span>
<span><span class="va">gdp_future_bycontinents_byyear_high_lifeExp</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>gdp_futureExpectation <span class="op">=</span> <span class="fu">ifelse</span><span class="op">(</span><span class="va">lifeExp</span> <span class="op">&gt;</span> <span class="fl">40</span>, <span class="va">gdpPercap</span> <span class="op">*</span> <span class="fl">1.5</span>, <span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>mean_gdpPercap <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span>,</span>
<span>              mean_gdpPercap_expected <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gdp_futureExpectation</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'continent'. You can override using the
`.groups` argument.</code></pre>
</div>
</section><section><h2 class="section-heading" id="dplyr-と-ggplot2-の併用">
<code>dplyr</code> と <code>ggplot2</code> の併用<a class="anchor" aria-label="anchor" href="#dplyr-%E3%81%A8-ggplot2-%E3%81%AE%E4%BD%B5%E7%94%A8"></a>
</h2>
<hr class="half-width">
<p>First install and load ggplot2:</p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">'ggplot2'</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span></span></code></pre>
</div>
<p>プロットのレッスンでは、 <code>ggplot2</code>
を使って、ファセットパネルの層を加えることで、
複数パネルの図を示す方法を見ました。
以下が、（いくつかコメントを足してありますが）使用したコードです：</p>
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter countries located in the Americas</span></span>
<span><span class="va">americas</span> <span class="op">&lt;-</span> <span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Americas"</span>, <span class="op">]</span></span>
<span><span class="co"># Make the plot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">americas</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span> <span class="op">~</span> <span class="va">country</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/12-dplyr-rendered-unnamed-chunk-27-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>このコードは、正しいプロットを作りますが、他に使い道のない、変数（<code>starts.with</code>
及び <code>az.countries</code>）も作ります。 <code>dplyr</code>
関数のチェーンで、 <code>% %</code> を使って、
データをパイプしたように、 <code>ggplot()</code>
へデータを引き渡すこともできます。 なぜならば <code>% %</code>
は、関数の最初の引数を置き換えるため、 <code>ggplot()</code>
関数の中の、 <code>data =</code> 因数を指定する必要がありません。
<code>dplyr</code> と <code>ggplot2</code>
関数を組み合わせることで、同じ図を、新しい変数を作ったり、
データを修正することなく作成できます。</p>
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># Filter countries located in the Americas</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Americas"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># Make the plot</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span> <span class="op">~</span> <span class="va">country</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/12-dplyr-rendered-unnamed-chunk-28-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>More examples of using the function <code>mutate()</code> and the
<code>ggplot2</code> package.</p>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># extract first letter of country name into new column</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>startsWith <span class="op">=</span> <span class="fu">substr</span><span class="op">(</span><span class="va">country</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># only keep countries starting with A or Z</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">startsWith</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"Z"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># plot lifeExp into facets</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">lifeExp</span>, colour <span class="op">=</span> <span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/12-dplyr-rendered-unnamed-chunk-29-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="上級チャレンジ" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="上級チャレンジ" class="callout-inner">
<h3 class="callout-title">上級チャレンジ</h3>
<div class="callout-content">
<p>各大陸から無作為に選ばれた２つの国の2002年の平均余命を計算し、
大陸名を、逆の順番に並べましょう。 ヒント： <code>dplyr</code> 関数
<code>arrange()</code> 及び <code>sample_n()</code> を使いましょう。
書き方は、他の dplyr 関数と同じです。</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  Solution to Advanced Challenge
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb52">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lifeExp_2countries_bycontinents</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">filter</span><span class="op">(</span><span class="va">year</span><span class="op">==</span><span class="fl">2002</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">sample_n</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">summarize</span><span class="op">(</span>mean_lifeExp<span class="op">=</span><span class="fu">mean</span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">mean_lifeExp</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="その他役に立つ資料">その他役に立つ資料<a class="anchor" aria-label="anchor" href="#%E3%81%9D%E3%81%AE%E4%BB%96%E5%BD%B9%E3%81%AB%E7%AB%8B%E3%81%A4%E8%B3%87%E6%96%99"></a>
</h2>
<hr class="half-width">
<ul>
<li>
<a href="https://r4ds.hadley.nz/" class="external-link">R for Data Science</a> (online
book)</li>
<li>
<a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf" class="external-link">Data
Wrangling Cheat sheet</a> (pdf file)</li>
<li>
<a href="https://dplyr.tidyverse.org/" class="external-link">Introduction to dplyr</a>
(online documentation)</li>
<li>
<a href="https://www.rstudio.com/resources/webinars/data-wrangling-with-r-and-rstudio/" class="external-link">Data
wrangling with R and RStudio</a> (online video)</li>
<li>
<a href="https://jhudatascience.org/tidyversecourse/" class="external-link">Tidyverse
Skills for Data Science</a> (online book)</li>
</ul>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">まとめ</h3>
<div class="callout-content">
<ul>
<li>Use the <code>dplyr</code> package to manipulate data frames.</li>
<li>Use <code>select()</code> to choose variables from a data
frame.</li>
<li>Use <code>filter()</code> to choose data based on values.</li>
<li>Use <code>group_by()</code> and <code>summarize()</code> to work
with subsets of data.</li>
<li>Use <code>mutate()</code> to create new variables.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-13-tidyr"><p>Content from <a href="13-tidyr.html">Data Frame Manipulation with tidyr</a></p>
<hr>
<p>最終更新日：2024-10-12 |

        <a href="https://github.com/swcarpentry-ja/r-novice-gapminder/edit/main/episodes/13-tidyr.Rmd" class="external-link">ページの編集 <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>所要時間：<i aria-hidden="true" data-feather="clock"></i> 45分</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="回答を全て表示する " data-collapse="回答を全て折りたたむ "> 回答を全て表示する <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">概要</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">質問</h3>
<ul>
<li>How can I change the layout of a data frame?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">目的</h3>
<ul>
<li>To understand the concepts of ‘longer’ and ‘wider’ data frame
formats and be able to convert between them with
<code>tidyr</code>.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>研究者には「横長」データを「縦長」データに（又はその逆を）したいと
思うことがよくあります。 「縦長」形式とは：</p>
<ul>
<li>各列が変数</li>
<li>各行が観測値</li>
</ul>
<p>「縦長」形式では、普通、観測値は１列で、残りの列はIDの変数になります。</p>
<p>For the ‘wide’ format each row is often a site/subject/patient and
you have multiple observation variables containing the same type of
data. These can be either repeated observations over time, or
observation of multiple variables (or a mix of both). You may find data
input may be simpler or some other applications may prefer the ‘wide’
format. However, many of <code>R</code>‘s functions have been designed
assuming you have ’longer’ formatted data. This tutorial will help you
efficiently transform your data shape regardless of original format.</p>
<figure><img src="../fig/14-tidyr-fig1.png" alt="Diagram illustrating the difference between a wide versus long layout of a data frame" class="figure mx-auto d-block"></figure><p>Long and wide data frame layouts mainly affect readability. For
humans, the wide format is often more intuitive since we can often see
more of the data on the screen due to its shape. However, the long
format is more machine readable and is closer to the formatting of
databases. The ID variables in our data frames are similar to the fields
in a database and observed variables are like the database values.</p>
<section><h2 class="section-heading" id="手始めに">手始めに<a class="anchor" aria-label="anchor" href="#%E6%89%8B%E5%A7%8B%E3%82%81%E3%81%AB"></a>
</h2>
<hr class="half-width">
<p>まず、パッケージをインストールしましょう、もしまだやっていなければですが
（おそらく、前の dplyr
のレッスンで、インストールしているかと思います）：</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#install.packages("tidyr")</span></span>
<span><span class="co">#install.packages("dplyr")</span></span></code></pre>
</div>
<p>パーッケージをロードしましょう。</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="st">"tidyr"</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="st">"dplyr"</span><span class="op">)</span></span></code></pre>
</div>
<p>始めに、そもそもの gapminder
データフレームのデータ構造を見てみましょう：</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	1704 obs. of  6 variables:
 $ country  : chr  "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" ...
 $ year     : int  1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ pop      : num  8425333 9240934 10267083 11537966 13079460 ...
 $ continent: chr  "Asia" "Asia" "Asia" "Asia" ...
 $ lifeExp  : num  28.8 30.3 32 34 36.1 ...
 $ gdpPercap: num  779 821 853 836 740 ...</code></pre>
</div>
<div id="チャレンジ１" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ１" class="callout-inner">
<h3 class="callout-title">チャレンジ１</h3>
<div class="callout-content">
<p>gapminder は、横長のみ、縦長のみ、又はその中間の形式でしょうか。</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>チャレンジ１の解答 元々の gapminder data.frame は、中間の形式です。
複数の観測変数（<code>pop</code>,<code>lifeExp</code>,<code>gdpPercap</code>）があるため、
縦長のみのデータとは言えません。</p>
</div>
</div>
</div>
</div>
<p>Sometimes, as with the gapminder dataset, we have multiple types of
observed data. It is somewhere in between the purely ‘long’ and ‘wide’
data formats. We have 3 “ID variables” (<code>continent</code>,
<code>country</code>, <code>year</code>) and 3 “Observation variables”
(<code>pop</code>,<code>lifeExp</code>,<code>gdpPercap</code>). This
intermediate format can be preferred despite not having ALL observations
in 1 column given that all 3 observation variables have different units.
There are few operations that would need us to make this data frame any
longer (i.e. 4 ID variables and 1 Observation variable).</p>
<p>While using many of the functions in R, which are often vector based,
you usually do not want to do mathematical operations on values with
different units. For example, using the purely long format, a single
mean for all of the values of population, life expectancy, and GDP would
not be meaningful since it would return the mean of values with 3
incompatible units. The solution is that we first manipulate the data
either by grouping (see the lesson on <code>dplyr</code>), or we change
the structure of the data frame. <strong>Note:</strong> Some plotting
functions in R actually work better in the wide format data.</p>
</section><section><h2 class="section-heading" id="gather-を使って横長から縦長形式へ">gather() を使って、横長から縦長形式へ<a class="anchor" aria-label="anchor" href="#gather-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E6%A8%AA%E9%95%B7%E3%81%8B%E3%82%89%E7%B8%A6%E9%95%B7%E5%BD%A2%E5%BC%8F%E3%81%B8"></a>
</h2>
<hr class="half-width">
<p>Until now, we’ve been using the nicely formatted original gapminder
dataset, but ‘real’ data (i.e. our own research data) will never be so
well organized. Here let’s start with the wide formatted version of the
gapminder dataset.</p>
<blockquote>
<p>Download the wide version of the gapminder data from <a href="../data/gapminder_wide.csv">this link to a csv file</a> and save it
in your data folder.</p>
</blockquote>
<p>We’ll load the data file and look at it.
データファイルをロードして見てみましょう。
注：大陸と国の列は、因子型にはしたくありません。
そこで、そうならないように、<code>read.csv()</code>に stringsAsFactors
引数を使いましょう。</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gap_wide</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/gapminder_wide.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">gap_wide</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	142 obs. of  38 variables:
 $ continent     : chr  "Africa" "Africa" "Africa" "Africa" ...
 $ country       : chr  "Algeria" "Angola" "Benin" "Botswana" ...
 $ gdpPercap_1952: num  2449 3521 1063 851 543 ...
 $ gdpPercap_1957: num  3014 3828 960 918 617 ...
 $ gdpPercap_1962: num  2551 4269 949 984 723 ...
 $ gdpPercap_1967: num  3247 5523 1036 1215 795 ...
 $ gdpPercap_1972: num  4183 5473 1086 2264 855 ...
 $ gdpPercap_1977: num  4910 3009 1029 3215 743 ...
 $ gdpPercap_1982: num  5745 2757 1278 4551 807 ...
 $ gdpPercap_1987: num  5681 2430 1226 6206 912 ...
 $ gdpPercap_1992: num  5023 2628 1191 7954 932 ...
 $ gdpPercap_1997: num  4797 2277 1233 8647 946 ...
 $ gdpPercap_2002: num  5288 2773 1373 11004 1038 ...
 $ gdpPercap_2007: num  6223 4797 1441 12570 1217 ...
 $ lifeExp_1952  : num  43.1 30 38.2 47.6 32 ...
 $ lifeExp_1957  : num  45.7 32 40.4 49.6 34.9 ...
 $ lifeExp_1962  : num  48.3 34 42.6 51.5 37.8 ...
 $ lifeExp_1967  : num  51.4 36 44.9 53.3 40.7 ...
 $ lifeExp_1972  : num  54.5 37.9 47 56 43.6 ...
 $ lifeExp_1977  : num  58 39.5 49.2 59.3 46.1 ...
 $ lifeExp_1982  : num  61.4 39.9 50.9 61.5 48.1 ...
 $ lifeExp_1987  : num  65.8 39.9 52.3 63.6 49.6 ...
 $ lifeExp_1992  : num  67.7 40.6 53.9 62.7 50.3 ...
 $ lifeExp_1997  : num  69.2 41 54.8 52.6 50.3 ...
 $ lifeExp_2002  : num  71 41 54.4 46.6 50.6 ...
 $ lifeExp_2007  : num  72.3 42.7 56.7 50.7 52.3 ...
 $ pop_1952      : num  9279525 4232095 1738315 442308 4469979 ...
 $ pop_1957      : num  10270856 4561361 1925173 474639 4713416 ...
 $ pop_1962      : num  11000948 4826015 2151895 512764 4919632 ...
 $ pop_1967      : num  12760499 5247469 2427334 553541 5127935 ...
 $ pop_1972      : num  14760787 5894858 2761407 619351 5433886 ...
 $ pop_1977      : num  17152804 6162675 3168267 781472 5889574 ...
 $ pop_1982      : num  20033753 7016384 3641603 970347 6634596 ...
 $ pop_1987      : num  23254956 7874230 4243788 1151184 7586551 ...
 $ pop_1992      : num  26298373 8735988 4981671 1342614 8878303 ...
 $ pop_1997      : num  29072015 9875024 6066080 1536536 10352843 ...
 $ pop_2002      : int  31287142 10866106 7026113 1630347 12251209 7021078 15929988 4048013 8835739 614382 ...
 $ pop_2007      : int  33333216 12420476 8078314 1639131 14326203 8390505 17696293 4369038 10238807 710960 ...</code></pre>
</div>
<figure><img src="../fig/14-tidyr-fig2.png" alt="Diagram illustrating the wide format of the gapminder data frame" class="figure mx-auto d-block"></figure><p>To change this very wide data frame layout back to our nice,
intermediate (or longer) layout, we will use one of the two available
<code>pivot</code> functions from the <code>tidyr</code> package. To
convert from wide to a longer format, we will use the
<code>pivot_longer()</code> function. <code>pivot_longer()</code> makes
datasets longer by increasing the number of rows and decreasing the
number of columns, or ‘lengthening’ your observation variables into a
single variable.</p>
<figure><img src="../fig/14-tidyr-fig3.png" alt="Diagram illustrating how pivot longer reorganizes a data frame from a wide to long format" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gap_long</span> <span class="op">&lt;-</span> <span class="va">gap_wide</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">'pop'</span><span class="op">)</span>, <span class="fu">starts_with</span><span class="op">(</span><span class="st">'lifeExp'</span><span class="op">)</span>, <span class="fu">starts_with</span><span class="op">(</span><span class="st">'gdpPercap'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"obstype_year"</span>, values_to <span class="op">=</span> <span class="st">"obs_values"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">gap_long</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>tibble [5,112 × 4] (S3: tbl_df/tbl/data.frame)
 $ continent   : chr [1:5112] "Africa" "Africa" "Africa" "Africa" ...
 $ country     : chr [1:5112] "Algeria" "Algeria" "Algeria" "Algeria" ...
 $ obstype_year: chr [1:5112] "pop_1952" "pop_1957" "pop_1962" "pop_1967" ...
 $ obs_values  : num [1:5112] 9279525 10270856 11000948 12760499 14760787 ...</code></pre>
</div>
<p>ここでは、以前 dplyr
のレッスンの中で行ったようなパイプの書き方を使いました。 実は、tidyr と
dplyr 関数は互換性があり、パイプで繋ぐことで、一緒に使うことが
できるのです。</p>
<p>We first provide to <code>pivot_longer()</code> a vector of column
names that will be pivoted into longer format. We could type out all the
observation variables, but as in the <code>select()</code> function (see
<code>dplyr</code> lesson), we can use the <code>starts_with()</code>
argument to select all variables that start with the desired character
string. <code>pivot_longer()</code> also allows the alternative syntax
of using the <code>-</code> symbol to identify which variables are not
to be pivoted (i.e. ID variables).</p>
<p>The next arguments to <code>pivot_longer()</code> are
<code>names_to</code> for naming the column that will contain the new ID
variable (<code>obstype_year</code>) and <code>values_to</code> for
naming the new amalgamated observation variable
(<code>obs_value</code>). We supply these new column names as
strings.</p>
<figure><img src="../fig/14-tidyr-fig4.png" alt="Diagram illustrating the long format of the gapminder data" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gap_long</span> <span class="op">&lt;-</span> <span class="va">gap_wide</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="op">-</span><span class="va">continent</span>, <span class="op">-</span><span class="va">country</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"obstype_year"</span>, values_to <span class="op">=</span> <span class="st">"obs_values"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">gap_long</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>tibble [5,112 × 4] (S3: tbl_df/tbl/data.frame)
 $ continent   : chr [1:5112] "Africa" "Africa" "Africa" "Africa" ...
 $ country     : chr [1:5112] "Algeria" "Algeria" "Algeria" "Algeria" ...
 $ obstype_year: chr [1:5112] "gdpPercap_1952" "gdpPercap_1957" "gdpPercap_1962" "gdpPercap_1967" ...
 $ obs_values  : num [1:5112] 2449 3014 2551 3247 4183 ...</code></pre>
</div>
<p>これは、このデータフレームでは、取るに足らないことかもしれませんが、
１つの ID
変数と40の変則的な変数名を持つ観測変数がある場合も時にはあります。
柔軟性があることで、かなり時間が節約できるのです！</p>
<p>Now <code>obstype_year</code> actually contains 2 pieces of
information, the observation type
(<code>pop</code>,<code>lifeExp</code>, or <code>gdpPercap</code>) and
the <code>year</code>. We can use the <code>separate()</code> function
to split the character strings into multiple variables</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gap_long</span> <span class="op">&lt;-</span> <span class="va">gap_long</span> <span class="op">%&gt;%</span> <span class="fu">separate</span><span class="op">(</span><span class="va">obstype_year</span>, into <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">'obs_type'</span>, <span class="st">'year'</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span>
<span><span class="va">gap_long</span><span class="op">$</span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fu">as.integer</span><span class="op">(</span><span class="va">gap_long</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span></code></pre>
</div>
<div id="チャレンジ２" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ２" class="callout-inner">
<h3 class="callout-title">チャレンジ２</h3>
<div class="callout-content">
<p>Using <code>gap_long</code>, calculate the mean life expectancy,
population, and gdpPercap for each continent. <strong>Hint:</strong> use
the <code>group_by()</code> and <code>summarize()</code> functions we
learned in the <code>dplyr</code> lesson</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gap_long</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span>, <span class="va">obs_type</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">summarize</span><span class="op">(</span>means<span class="op">=</span><span class="fu">mean</span><span class="op">(</span><span class="va">obs_values</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'continent'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 15 × 3
# Groups:   continent [5]
   continent obs_type       means
   &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;
 1 Africa    gdpPercap     2194.
 2 Africa    lifeExp         48.9
 3 Africa    pop        9916003.
 4 Americas  gdpPercap     7136.
 5 Americas  lifeExp         64.7
 6 Americas  pop       24504795.
 7 Asia      gdpPercap     7902.
 8 Asia      lifeExp         60.1
 9 Asia      pop       77038722.
10 Europe    gdpPercap    14469.
11 Europe    lifeExp         71.9
12 Europe    pop       17169765.
13 Oceania   gdpPercap    18622.
14 Oceania   lifeExp         74.3
15 Oceania   pop        8874672. </code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="spread-で縦長から中間形式へ">spread() で縦長から中間形式へ<a class="anchor" aria-label="anchor" href="#spread-%E3%81%A7%E7%B8%A6%E9%95%B7%E3%81%8B%E3%82%89%E4%B8%AD%E9%96%93%E5%BD%A2%E5%BC%8F%E3%81%B8"></a>
</h2>
<hr class="half-width">
<p>It is always good to check work. So, let’s use the second
<code>pivot</code> function, <code>pivot_wider()</code>, to ‘widen’ our
observation variables back out. <code>pivot_wider()</code> is the
opposite of <code>pivot_longer()</code>, making a dataset wider by
increasing the number of columns and decreasing the number of rows. We
can use <code>pivot_wider()</code> to pivot or reshape our
<code>gap_long</code> to the original intermediate format or the widest
format. Let’s start with the intermediate format.</p>
<p>The <code>pivot_wider()</code> function takes <code>names_from</code>
and <code>values_from</code> arguments.</p>
<p>To <code>names_from</code> we supply the column name whose contents
will be pivoted into new output columns in the widened data frame. The
corresponding values will be added from the column named in the
<code>values_from</code> argument.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gap_normal</span> <span class="op">&lt;-</span> <span class="va">gap_long</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">obs_type</span>, values_from <span class="op">=</span> <span class="va">obs_values</span><span class="op">)</span></span>
<span><span class="fu">dim</span><span class="op">(</span><span class="va">gap_normal</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1704    6</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dim</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1704    6</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">gap_normal</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "continent" "country"   "year"      "gdpPercap" "lifeExp"   "pop"      </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "country"   "year"      "pop"       "continent" "lifeExp"   "gdpPercap"</code></pre>
</div>
<p>元々の <code>gapminder</code>
と同じ次元を持つ、中間形式のデータフレーム <code>gap_normal</code>
ができましたが、 変数の順番が違います。 このふたつが、
<code>all.equal()</code> かを調べる前に、これを直しましょう。</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gap_normal</span> <span class="op">&lt;-</span> <span class="va">gap_normal</span><span class="op">[</span>, <span class="fu">names</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu">all.equal</span><span class="op">(</span><span class="va">gap_normal</span>, <span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Attributes: &lt; Component \"class\": Lengths (3, 1) differ (string compare on first 1) &gt;"
[2] "Attributes: &lt; Component \"class\": 1 string mismatch &gt;"
[3] "Component \"country\": 1704 string mismatches"
[4] "Component \"pop\": Mean relative difference: 1.634504"
[5] "Component \"continent\": 1212 string mismatches"
[6] "Component \"lifeExp\": Mean relative difference: 0.203822"
[7] "Component \"gdpPercap\": Mean relative difference: 1.162302"                           </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">gap_normal</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 6 × 6
  country  year      pop continent lifeExp gdpPercap
  &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Algeria  1952  9279525 Africa       43.1     2449.
2 Algeria  1957 10270856 Africa       45.7     3014.
3 Algeria  1962 11000948 Africa       48.3     2551.
4 Algeria  1967 12760499 Africa       51.4     3247.
5 Algeria  1972 14760787 Africa       54.5     4183.
6 Algeria  1977 17152804 Africa       58.0     4910.</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      country year      pop continent lifeExp gdpPercap
1 Afghanistan 1952  8425333      Asia  28.801  779.4453
2 Afghanistan 1957  9240934      Asia  30.332  820.8530
3 Afghanistan 1962 10267083      Asia  31.997  853.1007
4 Afghanistan 1967 11537966      Asia  34.020  836.1971
5 Afghanistan 1972 13079460      Asia  36.088  739.9811
6 Afghanistan 1977 14880372      Asia  38.438  786.1134</code></pre>
</div>
<p>もうすぐです。元々のは、 <code>country</code> 、
<code>continent</code> 、そして <code>year</code>
でソートされていました。</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gap_normal</span> <span class="op">&lt;-</span> <span class="va">gap_normal</span> <span class="op">%&gt;%</span> <span class="fu">arrange</span><span class="op">(</span><span class="va">country</span>, <span class="va">year</span><span class="op">)</span></span>
<span><span class="fu">all.equal</span><span class="op">(</span><span class="va">gap_normal</span>, <span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Attributes: &lt; Component \"class\": Lengths (3, 1) differ (string compare on first 1) &gt;"
[2] "Attributes: &lt; Component \"class\": 1 string mismatch &gt;"                                </code></pre>
</div>
<p>That’s great!
すばらしい！一番縦に長い形式から、中間形式に戻し、コードにエラーが
でることもありませんでした。</p>
<p>Now let’s convert the long all the way back to the wide. In the wide
format, we will keep country and continent as ID variables and pivot the
observations across the 3 metrics
(<code>pop</code>,<code>lifeExp</code>,<code>gdpPercap</code>) and time
(<code>year</code>). First we need to create appropriate labels for all
our new variables (time*metric combinations) and we also need to unify
our ID variables to simplify the process of defining
<code>gap_wide</code>.</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gap_temp</span> <span class="op">&lt;-</span> <span class="va">gap_long</span> <span class="op">%&gt;%</span> <span class="fu">unite</span><span class="op">(</span><span class="va">var_ID</span>, <span class="va">continent</span>, <span class="va">country</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">gap_temp</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>tibble [5,112 × 4] (S3: tbl_df/tbl/data.frame)
 $ var_ID    : chr [1:5112] "Africa_Algeria" "Africa_Algeria" "Africa_Algeria" "Africa_Algeria" ...
 $ obs_type  : chr [1:5112] "gdpPercap" "gdpPercap" "gdpPercap" "gdpPercap" ...
 $ year      : int [1:5112] 1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ obs_values: num [1:5112] 2449 3014 2551 3247 4183 ...</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gap_temp</span> <span class="op">&lt;-</span> <span class="va">gap_long</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">unite</span><span class="op">(</span><span class="va">ID_var</span>, <span class="va">continent</span>, <span class="va">country</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">unite</span><span class="op">(</span><span class="va">var_names</span>, <span class="va">obs_type</span>, <span class="va">year</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">gap_temp</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>tibble [5,112 × 3] (S3: tbl_df/tbl/data.frame)
 $ ID_var    : chr [1:5112] "Africa_Algeria" "Africa_Algeria" "Africa_Algeria" "Africa_Algeria" ...
 $ var_names : chr [1:5112] "gdpPercap_1952" "gdpPercap_1957" "gdpPercap_1962" "gdpPercap_1967" ...
 $ obs_values: num [1:5112] 2449 3014 2551 3247 4183 ...</code></pre>
</div>
<p><code>unite()</code>
を使い、<code>continent</code>と<code>country</code>を組み合わせ、ID
変数をひとつ作り、 変数名を定義しました。 <code>spread()</code>
でパイプを使う準備が整いました。</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gap_wide_new</span> <span class="op">&lt;-</span> <span class="va">gap_long</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">unite</span><span class="op">(</span><span class="va">ID_var</span>, <span class="va">continent</span>, <span class="va">country</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">unite</span><span class="op">(</span><span class="va">var_names</span>, <span class="va">obs_type</span>, <span class="va">year</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">var_names</span>, values_from <span class="op">=</span> <span class="va">obs_values</span><span class="op">)</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">gap_wide_new</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>tibble [142 × 37] (S3: tbl_df/tbl/data.frame)
 $ ID_var        : chr [1:142] "Africa_Algeria" "Africa_Angola" "Africa_Benin" "Africa_Botswana" ...
 $ gdpPercap_1952: num [1:142] 2449 3521 1063 851 543 ...
 $ gdpPercap_1957: num [1:142] 3014 3828 960 918 617 ...
 $ gdpPercap_1962: num [1:142] 2551 4269 949 984 723 ...
 $ gdpPercap_1967: num [1:142] 3247 5523 1036 1215 795 ...
 $ gdpPercap_1972: num [1:142] 4183 5473 1086 2264 855 ...
 $ gdpPercap_1977: num [1:142] 4910 3009 1029 3215 743 ...
 $ gdpPercap_1982: num [1:142] 5745 2757 1278 4551 807 ...
 $ gdpPercap_1987: num [1:142] 5681 2430 1226 6206 912 ...
 $ gdpPercap_1992: num [1:142] 5023 2628 1191 7954 932 ...
 $ gdpPercap_1997: num [1:142] 4797 2277 1233 8647 946 ...
 $ gdpPercap_2002: num [1:142] 5288 2773 1373 11004 1038 ...
 $ gdpPercap_2007: num [1:142] 6223 4797 1441 12570 1217 ...
 $ lifeExp_1952  : num [1:142] 43.1 30 38.2 47.6 32 ...
 $ lifeExp_1957  : num [1:142] 45.7 32 40.4 49.6 34.9 ...
 $ lifeExp_1962  : num [1:142] 48.3 34 42.6 51.5 37.8 ...
 $ lifeExp_1967  : num [1:142] 51.4 36 44.9 53.3 40.7 ...
 $ lifeExp_1972  : num [1:142] 54.5 37.9 47 56 43.6 ...
 $ lifeExp_1977  : num [1:142] 58 39.5 49.2 59.3 46.1 ...
 $ lifeExp_1982  : num [1:142] 61.4 39.9 50.9 61.5 48.1 ...
 $ lifeExp_1987  : num [1:142] 65.8 39.9 52.3 63.6 49.6 ...
 $ lifeExp_1992  : num [1:142] 67.7 40.6 53.9 62.7 50.3 ...
 $ lifeExp_1997  : num [1:142] 69.2 41 54.8 52.6 50.3 ...
 $ lifeExp_2002  : num [1:142] 71 41 54.4 46.6 50.6 ...
 $ lifeExp_2007  : num [1:142] 72.3 42.7 56.7 50.7 52.3 ...
 $ pop_1952      : num [1:142] 9279525 4232095 1738315 442308 4469979 ...
 $ pop_1957      : num [1:142] 10270856 4561361 1925173 474639 4713416 ...
 $ pop_1962      : num [1:142] 11000948 4826015 2151895 512764 4919632 ...
 $ pop_1967      : num [1:142] 12760499 5247469 2427334 553541 5127935 ...
 $ pop_1972      : num [1:142] 14760787 5894858 2761407 619351 5433886 ...
 $ pop_1977      : num [1:142] 17152804 6162675 3168267 781472 5889574 ...
 $ pop_1982      : num [1:142] 20033753 7016384 3641603 970347 6634596 ...
 $ pop_1987      : num [1:142] 23254956 7874230 4243788 1151184 7586551 ...
 $ pop_1992      : num [1:142] 26298373 8735988 4981671 1342614 8878303 ...
 $ pop_1997      : num [1:142] 29072015 9875024 6066080 1536536 10352843 ...
 $ pop_2002      : num [1:142] 31287142 10866106 7026113 1630347 12251209 ...
 $ pop_2007      : num [1:142] 33333216 12420476 8078314 1639131 14326203 ...</code></pre>
</div>
<div id="チャレンジ３" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ３" class="callout-inner">
<h3 class="callout-title">チャレンジ３</h3>
<div class="callout-content">
<p>この一つ先に進み、 <code>gap_ludicrously_wide</code>
を作り、国、年及び３つの行列に展開したデータを作りましょう。 ヒント
この新しいデータフレームには、５行しかありません。</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gap_ludicrously_wide</span> <span class="op">&lt;-</span> <span class="va">gap_long</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">unite</span><span class="op">(</span><span class="va">var_names</span>, <span class="va">obs_type</span>, <span class="va">year</span>, <span class="va">country</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">var_names</span>, values_from <span class="op">=</span> <span class="va">obs_values</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>今、とても ‘横長な’ 形式のデータフレームがありますが、
<code>ID_var</code> は、より使えるようにできるはずです。
<code>separate()</code> を使って、２変数に分けてみましょう。</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gap_wide_betterID</span> <span class="op">&lt;-</span> <span class="fu">separate</span><span class="op">(</span><span class="va">gap_wide_new</span>, <span class="va">ID_var</span>, <span class="fu">c</span><span class="op">(</span><span class="st">"continent"</span>, <span class="st">"country"</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span></span>
<span><span class="va">gap_wide_betterID</span> <span class="op">&lt;-</span> <span class="va">gap_long</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">unite</span><span class="op">(</span><span class="va">ID_var</span>, <span class="va">continent</span>, <span class="va">country</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">unite</span><span class="op">(</span><span class="va">var_names</span>, <span class="va">obs_type</span>, <span class="va">year</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">var_names</span>, values_from <span class="op">=</span> <span class="va">obs_values</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">separate</span><span class="op">(</span><span class="va">ID_var</span>, <span class="fu">c</span><span class="op">(</span><span class="st">"continent"</span>,<span class="st">"country"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">gap_wide_betterID</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>tibble [142 × 38] (S3: tbl_df/tbl/data.frame)
 $ continent     : chr [1:142] "Africa" "Africa" "Africa" "Africa" ...
 $ country       : chr [1:142] "Algeria" "Angola" "Benin" "Botswana" ...
 $ gdpPercap_1952: num [1:142] 2449 3521 1063 851 543 ...
 $ gdpPercap_1957: num [1:142] 3014 3828 960 918 617 ...
 $ gdpPercap_1962: num [1:142] 2551 4269 949 984 723 ...
 $ gdpPercap_1967: num [1:142] 3247 5523 1036 1215 795 ...
 $ gdpPercap_1972: num [1:142] 4183 5473 1086 2264 855 ...
 $ gdpPercap_1977: num [1:142] 4910 3009 1029 3215 743 ...
 $ gdpPercap_1982: num [1:142] 5745 2757 1278 4551 807 ...
 $ gdpPercap_1987: num [1:142] 5681 2430 1226 6206 912 ...
 $ gdpPercap_1992: num [1:142] 5023 2628 1191 7954 932 ...
 $ gdpPercap_1997: num [1:142] 4797 2277 1233 8647 946 ...
 $ gdpPercap_2002: num [1:142] 5288 2773 1373 11004 1038 ...
 $ gdpPercap_2007: num [1:142] 6223 4797 1441 12570 1217 ...
 $ lifeExp_1952  : num [1:142] 43.1 30 38.2 47.6 32 ...
 $ lifeExp_1957  : num [1:142] 45.7 32 40.4 49.6 34.9 ...
 $ lifeExp_1962  : num [1:142] 48.3 34 42.6 51.5 37.8 ...
 $ lifeExp_1967  : num [1:142] 51.4 36 44.9 53.3 40.7 ...
 $ lifeExp_1972  : num [1:142] 54.5 37.9 47 56 43.6 ...
 $ lifeExp_1977  : num [1:142] 58 39.5 49.2 59.3 46.1 ...
 $ lifeExp_1982  : num [1:142] 61.4 39.9 50.9 61.5 48.1 ...
 $ lifeExp_1987  : num [1:142] 65.8 39.9 52.3 63.6 49.6 ...
 $ lifeExp_1992  : num [1:142] 67.7 40.6 53.9 62.7 50.3 ...
 $ lifeExp_1997  : num [1:142] 69.2 41 54.8 52.6 50.3 ...
 $ lifeExp_2002  : num [1:142] 71 41 54.4 46.6 50.6 ...
 $ lifeExp_2007  : num [1:142] 72.3 42.7 56.7 50.7 52.3 ...
 $ pop_1952      : num [1:142] 9279525 4232095 1738315 442308 4469979 ...
 $ pop_1957      : num [1:142] 10270856 4561361 1925173 474639 4713416 ...
 $ pop_1962      : num [1:142] 11000948 4826015 2151895 512764 4919632 ...
 $ pop_1967      : num [1:142] 12760499 5247469 2427334 553541 5127935 ...
 $ pop_1972      : num [1:142] 14760787 5894858 2761407 619351 5433886 ...
 $ pop_1977      : num [1:142] 17152804 6162675 3168267 781472 5889574 ...
 $ pop_1982      : num [1:142] 20033753 7016384 3641603 970347 6634596 ...
 $ pop_1987      : num [1:142] 23254956 7874230 4243788 1151184 7586551 ...
 $ pop_1992      : num [1:142] 26298373 8735988 4981671 1342614 8878303 ...
 $ pop_1997      : num [1:142] 29072015 9875024 6066080 1536536 10352843 ...
 $ pop_2002      : num [1:142] 31287142 10866106 7026113 1630347 12251209 ...
 $ pop_2007      : num [1:142] 33333216 12420476 8078314 1639131 14326203 ...</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">all.equal</span><span class="op">(</span><span class="va">gap_wide</span>, <span class="va">gap_wide_betterID</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Attributes: &lt; Component \"class\": Lengths (1, 3) differ (string compare on first 1) &gt;"
[2] "Attributes: &lt; Component \"class\": 1 string mismatch &gt;"                                </code></pre>
</div>
<p>そこにまた戻りました！</p>
</section><section><h2 class="section-heading" id="その他役に立つ資料">その他役に立つ資料<a class="anchor" aria-label="anchor" href="#%E3%81%9D%E3%81%AE%E4%BB%96%E5%BD%B9%E3%81%AB%E7%AB%8B%E3%81%A4%E8%B3%87%E6%96%99"></a>
</h2>
<hr class="half-width">
<ul>
<li>
<a href="https://r4ds.hadley.nz/" class="external-link">R for Data Science</a> (online
book)</li>
<li>
<a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf" class="external-link">Data
Wrangling Cheat sheet</a> (pdf file)</li>
<li>
<a href="https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html" class="external-link">Introduction
to tidyr</a> (online documentation)</li>
<li>
<a href="https://www.rstudio.com/resources/webinars/data-wrangling-with-r-and-rstudio/" class="external-link">Data
wrangling with R and RStudio</a> (online video)</li>
</ul>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">まとめ</h3>
<div class="callout-content">
<ul>
<li>Use the <code>tidyr</code> package to change the layout of data
frames.</li>
<li>Use <code>pivot_longer()</code> to go from wide to longer
layout.</li>
<li>Use <code>pivot_wider()</code> to go from long to wider layout.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-14-knitr-markdown"><p>Content from <a href="14-knitr-markdown.html">Producing Reports With knitr</a></p>
<hr>
<p>最終更新日：2024-10-12 |

        <a href="https://github.com/swcarpentry-ja/r-novice-gapminder/edit/main/episodes/14-knitr-markdown.Rmd" class="external-link">ページの編集 <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>所要時間：<i aria-hidden="true" data-feather="clock"></i> 75分</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="回答を全て表示する " data-collapse="回答を全て折りたたむ "> 回答を全て表示する <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">概要</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">質問</h3>
<ul>
<li>How can I integrate software and reports?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">目的</h3>
<ul>
<li>Understand the value of writing reproducible reports</li>
<li>Learn how to recognise and compile the basic components of an R
Markdown file</li>
<li>Become familiar with R code chunks, and understand their purpose,
structure and options</li>
<li>Demonstrate the use of inline chunks for weaving R outputs into text
blocks, for example when discussing the results of some
calculations</li>
<li>Be aware of alternative output formats to which an R Markdown file
can be exported</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="データ分析報告">データ分析報告<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E5%88%86%E6%9E%90%E5%A0%B1%E5%91%8A"></a>
</h2>
<hr class="half-width">
<p>データ分析家は、協力者や、将来参照する文章として、分析及び結果を記した
報告を数多く書く傾向にあります。</p>
<p>Many new users begin by first writing a single R script containing
all of their work, and then share the analysis by emailing the script
and various graphs as attachments. But this can be cumbersome, requiring
a lengthy discussion to explain which attachment was which result.</p>
<p>Writing formal reports with Word or <a href="https://www.latex-project.org/" class="external-link">LaTeX</a> can simplify this
process by incorporating both the analysis report and output graphs into
a single document. But tweaking formatting to make figures look correct
and fixing obnoxious page breaks can be tedious and lead to a lengthy
“whack-a-mole” game of fixing new mistakes resulting from a single
formatting change.</p>
<p>Creating a report as a web page (which is an html file) using R
Markdown makes things easier. The report can be one long stream, so tall
figures that wouldn’t ordinarily fit on one page can be kept at full
size and easier to read, since the reader can simply keep scrolling.
Additionally, the formatting of and R Markdown document is simple and
easy to modify, allowing you to spend more time on your analyses instead
of writing reports.</p>
</section><section><h2 class="section-heading" id="読み書きできるプログラミング">読み書きできるプログラミング<a class="anchor" aria-label="anchor" href="#%E8%AA%AD%E3%81%BF%E6%9B%B8%E3%81%8D%E3%81%A7%E3%81%8D%E3%82%8B%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0"></a>
</h2>
<hr class="half-width">
<p>分析報告書のようなものは、<em>再現できる</em>
文書であることが理想です。つまり、
エラーが見つかった場合や、データに追加があった場合など、単に報告書を
再コンパイルすることで、新しい、または正しい結果が得られるという形です
（再現できない文書の場合、図を再作成し、Word文書に貼り付け、更に手作業で
様々な詳細結果に手を加えなえればなりません）。</p>
<p>The key R package here is <a href="https://yihui.name/knitr/" class="external-link"><code>knitr</code></a>. It allows you
to create a document that is a mixture of text and chunks of code.
文書がknitrで処理される際にRコードが実行され、
グラフや他の結果が文書に挿入されます。</p>
<p>こういうものを「読み書きできるプログラミング（literate
programming）」と呼びます。</p>
<p><code>knitr</code> allows you to mix basically any type of text with
code from different programming languages, but we recommend that you use
<code>R Markdown</code>, which mixes Markdown with R. <a href="https://www.markdownguide.org/" class="external-link">Markdown</a> is a light-weight
mark-up language for creating web pages.</p>
</section><section><h2 class="section-heading" id="r-markdownファイルの作成">R Markdownファイルの作成<a class="anchor" aria-label="anchor" href="#r-markdown%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E4%BD%9C%E6%88%90"></a>
</h2>
<hr class="half-width">
<p>R Studioで、File New File R Markdown をクリックしましょう。
すると、次のようなダイアログボックスが出ます：</p>
<figure><img src="../fig/New_R_Markdown.png" alt="Screenshot of the New R Markdown file dialogue box in RStudio" class="figure mx-auto d-block"></figure><p>デフォルト（HTML
output）のままでよいので、タイトルを付けましょう。</p>
</section><section><h2 class="section-heading" id="r-markdownの基本構成要素">R Markdownの基本構成要素<a class="anchor" aria-label="anchor" href="#r-markdown%E3%81%AE%E5%9F%BA%E6%9C%AC%E6%A7%8B%E6%88%90%E8%A6%81%E7%B4%A0"></a>
</h2>
<hr class="half-width">
<p>The initial chunk of text (header) contains instructions for R to
specify what kind of document will be created, and the options chosen.
You can use the header to give your document a title, author, date, and
tell it what type of output you want to produce. In this case, we’re
creating an html document.</p>
<pre><code>---
title: "Initial R Markdown document"
author: "Karl Broman"
date: "April 23, 2015"
output: html_document
---</code></pre>
<p>入れたくなければ、これらのフィールドのいずれも消すことができます。
二重引用符は、厳密には <em>必須</em> ではありません。
大抵は、タイトルにコロンを含めたいときに使います。</p>
<p>RStudioは、始めやすいように、例がいくつか入れられてある文書を作成します。
以下のような「チャンク（chunk）」がすでにあるかと思います：</p>
<pre>``{r}
summary(cars)
```
</pre>
<p>これらはRコードの「チャンク」（塊）で、knitrによってコードが実行され、結果に置き換えられます。
また後ほど、詳しくお伝えします。</p>
</section><section><h2 class="section-heading" id="markdown">Markdown<a class="anchor" aria-label="anchor" href="#markdown"></a>
</h2>
<hr class="half-width">
<p>Markdown is a system for writing web pages by marking up the text
much as you would in an email rather than writing html code. The
marked-up text gets <em>converted</em> to html, replacing the marks with
the proper html code.</p>
<p>とりあえず、ここにあるものを全部消して、少しMarkdownを書いてみましょう。</p>
<p>二重アスタリスクを使って、 太字 に（例 <code>bold</code>）、
下線を使って、 <em>斜体</em> にすることができます（例
<code>_italics_</code>）。</p>
<p>You can make a bulleted list by writing a list with hyphens or
asterisks with a space between the list and other text, like this:</p>
<pre><code>太字は、二重アスタリスクで 斜体は、下線で コードタイプのフォントは括弧で</code></pre>
<p>または、このように：</p>
<pre><code>太字は、二重アスタリスクで - 斜体は、下線で - コードタイプのフォントは括弧で</code></pre>
<p>それぞれ、以下の形で表示されます：</p>
<ul>
<li>太字は、二重アスタリスクで</li>
<li>斜体は、下線で</li>
<li>コードタイプのフォントは括弧で</li>
</ul>
<p>You can use whatever method you prefer, but <em>be consistent</em>.
This maintains the readability of your code.</p>
<p>数字を使って番号付きリストを作ることもできます。
同じ番号を何度でも好きなだけ使えます：</p>
<pre><code>1. 太字は、二重アスタリスクで 1. 斜体は、下線で 1. コードタイプのフォントは括弧で</code></pre>
<p>これは、次のように表示されます：</p>
<ol style="list-style-type: decimal">
<li>太字は、二重アスタリスクで</li>
<li>斜体は、下線で</li>
<li>コードタイプのフォントは括弧で</li>
</ol>
<p>行の頭に <code>#</code>
印を好きな数つけることで、色々なサイズの文節の題名を作ることができます：</p>
<pre><code><span><span class="co"># タイトル ## 主文節 ### 副文節 #### 更なる副文節</span></span></code></pre>
<p>You <em>compile</em> the R Markdown document to an html webpage by
clicking the “Knit” button in the upper-left.</p>
<div id="チャレンジ１" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ１" class="callout-inner">
<h3 class="callout-title">チャレンジ１</h3>
<div class="callout-content">
<p>Create a new R Markdown document. Delete all of the R code chunks and
write a bit of Markdown (some sections, some italicized text, and an
itemized list).</p>
<p>Convert the document to a webpage.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>In RStudio, select File &gt; New file &gt; R Markdown…</p>
<p>Delete the placeholder text and add the following:</p>
<pre><code># Introduction

## Background on Data

This report uses the *gapminder* dataset, which has columns that include:

* country
* continent
* year
* lifeExp
* pop
* gdpPercap

## Background on Methods
</code></pre>
<p>Then click the ‘Knit’ button on the toolbar to generate an html
document (webpage).</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="もうちょっとmarkdownについて">もうちょっとMarkdownについて<a class="anchor" aria-label="anchor" href="#%E3%82%82%E3%81%86%E3%81%A1%E3%82%87%E3%81%A3%E3%81%A8markdown%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"></a>
</h2>
<hr class="half-width">
<p>次のような、ハイパーリンクを作ることができます：
<code>[表示するテキスト](https://carpentries.org/)</code>.</p>
<p>You can include an image file like this:
<code>![The Carpentries Logo](https://carpentries.org/assets/img/TheCarpentries.svg)</code></p>
<p>下付き文字 （例 F<sub>2</sub>）は <code>F~2</code> で、上付き文字（例
F<sup>2</sup>）は <code>F^2^</code> でできます。</p>
<p><a href="http://www.latex-project.org/" class="external-link">LaTeX</a>の等式の書き方を知っていれば、
<code>$ $</code> と <code>$$ $$</code> で数式を挿入することができます。
例えば、 <code>$E = mc^2$</code> や、</p>
<pre><code>$$y = \mu + \sum_{i=1}^p \beta_i x_i + \epsilon$$</code></pre>
<p>You can review Markdown syntax by navigating to the “Markdown Quick
Reference” under the “Help” field in the toolbar at the top of
RStudio.</p>
</section><section><h2 class="section-heading" id="rコードのチャンク塊">Rコードの「チャンク（塊）」<a class="anchor" aria-label="anchor" href="#r%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E3%83%81%E3%83%A3%E3%83%B3%E3%82%AF%E5%A1%8A"></a>
</h2>
<hr class="half-width">
<p>The real power of Markdown comes from mixing markdown with chunks of
code. This is R Markdown. When processed, the R code will be executed;
if they produce figures, the figures will be inserted in the final
document.</p>
<p>メインのコードチャンクは、こんな感じです：</p>
<pre>``{r load_data}
gapminder
<p>That is, you place a chunk of R code between <code>```{r
chunk_name}</code> and <code>```</code>.
そうすると、エラーを修正するときに役立ちますし、グラフのファイル名は、生成されたコードのチャンクの名前に基づいて付けられるからです。
You can create code chunks quickly in RStudio using the shortcuts
<kbd>Ctrl</kbd>+<kbd>Alt</kbd>+<kbd>I</kbd> on Windows and Linux, or
<kbd>Cmd</kbd>+<kbd>Option</kbd>+<kbd>I</kbd> on Mac.</p>
<div id="チャレンジ２" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ２" class="callout-inner">
<h3 class="callout-title">チャレンジ２</h3>
<div class="callout-content">
<p>Add code chunks to:</p>
<ul>
<li>Load the ggplot2 package</li>
<li>Read the gapminder data</li>
<li>Create a plot</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<pre>``{r load-ggplot2}
library("ggplot2")
```
</pre>
<pre>``{r read-gapminder-data}
gapminder
<pre>``{r make-plot}
plot(lifeExp ~ year, data = gapminder)
```
</pre>
</pre>
</div>
</div>
</div>
</div>
</pre></section><section><h2 class="section-heading" id="どうコンパイルされるか">どうコンパイルされるか<a class="anchor" aria-label="anchor" href="#%E3%81%A9%E3%81%86%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E3%81%95%E3%82%8C%E3%82%8B%E3%81%8B"></a>
</h2>
<hr class="half-width">
<p>「Knit HTML」ボタンを押すと、R Markdown文書は<a href="http://yihui.name/knitr" class="external-link">knitr</a>
によって処理され、単純なMarkdown文書が（一連の図のファイルと共に）生成されます。
Rコードは実行され、入力と出力に置き換えられます。図が生成された場合、
これらの図へのリンクが挿入されます。</p>
<p>Markdownと図の文書は、<a href="http://pandoc.org/" class="external-link">pandoc</a>
というツールで処理され、
Markdownファイルは、図の埋め込まれたhtmlファイルに変換されます。</p>
<figure><img src="../fig/14-knitr-markdown-rendered-rmd_to_html_fig-1.png" style="display: block; margin: auto auto auto 0;" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="チャンクのオプション">チャンクのオプション<a class="anchor" aria-label="anchor" href="#%E3%83%81%E3%83%A3%E3%83%B3%E3%82%AF%E3%81%AE%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3"></a>
</h2>
<hr class="half-width">
<p>コードのチャンクがどう扱われるかは、様々なオプションによって決められます。
Here are some examples:</p>
<ul>
<li><ul>
<li>コード自体を見せないためには、 <code>echo=FALSE</code>
を使います</li>
</ul></li>
<li><ul>
<li>結果を表示しないためには、 <code>results="hide"</code>
を使います</li>
</ul></li>
<li><ul>
<li>コードを演算せず表示するためには、 <code>eval=FALSE</code>
を使います</li>
</ul></li>
<li><ul>
<li>警告やメッセージを隠す場合は、 <code>warning=FALSE</code> と
<code>message=FALSE</code> を使います</li>
</ul></li>
<li><ul>
<li>生成される図の大きさを（インチで）管理するためには、
<code>fig.height</code> と <code>fig.width</code> を使います</li>
</ul></li>
</ul>
<p>なので、書くとすれば：</p>
<pre>``{r load_libraries, echo=FALSE, message=FALSE}
library("dplyr")
library("ggplot2")
```
</pre>
<p>使いたいオプションを別のチャンクでも使いたい場合は、
<em>global_options</em> を使います。例えば：</p>
<pre>``{r global_options, echo=FALSE}
knitr::opts_chunk$set(fig.path="Figs/", message=FALSE, warning=FALSE,
                      echo=FALSE, results="hide", fig.width=11)
```
</pre>
<p><code>fig.path</code>
オプションは、図のファイルがどこに保存されるかを定義します。 ここでの
<code>/</code> はとても重要で、もしこれがなければ、図は標準的な場所に
保存されますが、 <code>Figs</code>
で始まる名前のファイルだけになります。</p>
<p>共有ディレクトリにR Markdownファイルが複数ある場合は、
<code>fig.path</code>
を図のファイル名と異なる接頭語を付けるために使うといいかもしれません。
例えば、<code>fig.path="Figs/cleaning-"</code> と
<code>fig.path="Figs/analysis-"</code> とすれば、 それぞれ
<code>"cleaning-"</code> と <code>"analysis-"</code>
で始まる図のファイルが <code>"Figs/"</code>
ディレクトリに保存されます。</p>
<div id="チャレンジ３" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ３" class="callout-inner">
<h3 class="callout-title">チャレンジ３</h3>
<div class="callout-content">
<p>図の大きさを管理し、コードを隠すチャンクのオプションを使ってみましょう。</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<pre>``{r echo = FALSE, fig.width = 3}
plot(faithful)
```
</pre>
</div>
</div>
</div>
</div>
<p>You can review all of the <code>R</code> chunk options by navigating
to the “R Markdown Cheat Sheet” under the “Cheatsheets” section of the
“Help” field in the toolbar at the top of RStudio.</p>
</section><section><h2 class="section-heading" id="文中のrコード">文中のRコード<a class="anchor" aria-label="anchor" href="#%E6%96%87%E4%B8%AD%E3%81%AEr%E3%82%B3%E3%83%BC%E3%83%89"></a>
</h2>
<hr class="half-width">
<p>報告書にある、<em>全て</em>
の数を再現可能なものにすることができます。 インラインコードチャンクには
<code>`r</code> と <code>`</code>
で囲んで、例えばこのように記述します：<code></code>r round(some_value,
2)<code></code>。 このコードはコンパイル時に実行され、結果の <em>値</em>
に置き換えられます。</p>
<p>この文中のチャンクを、複数の行に分けて入れないようにしましょう。</p>
<p>こういう場合は、パラグラフの前に<code>include=FALSE</code> （
<code>echo=FALSE</code> と <code>results="hide"</code>
の組み合わせと同じ）のオプションを設定した、
定義や演算を行うコードチャンクを作っておきましょう。</p>
<p>Rounding can produce differences in output in such situations.
<code>2.0</code> が欲しくても、<code>round(2.03, 1)</code> ではただの
<code>2</code> が出てきてしまいます。</p>
<p><a href="https://github.com/kbroman" class="external-link">R/broman</a>パッケージにある、
<a href="https://github.com/kbroman/broman/blob/master/R/myround.R" class="external-link"><code>myround</code></a>関数が、
この問題に対処してくれます。</p>
<div id="チャレンジ４" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ４" class="callout-inner">
<h3 class="callout-title">チャレンジ４</h3>
<div class="callout-content">
<p>文中のRコードを少し試してみましょう。</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  チャレンジ３の解答
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>Here’s some inline code to determine that 2 + 2 = 4.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="その他の出力オプション">その他の出力オプション<a class="anchor" aria-label="anchor" href="#%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE%E5%87%BA%E5%8A%9B%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3"></a>
</h2>
<hr class="half-width">
<p>R MarkdownをPDFやWord文書に変換することもできます。
ドロップダウンメニューを表示させるために、「Knit
HTML」の横にある小さい三角をクリックしましょう。 または、
<code>pdf_document</code> や <code>word_document</code>
をファイルの最初のヘッダー（header）に入れておくこともできます。</p>
<div id="ヒントpdfドキュメントの作成" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒントpdfドキュメントの作成" class="callout-inner">
<h3 class="callout-title">ヒント：PDFドキュメントの作成</h3>
<div class="callout-content">
<p><code>.pdf</code>
文書を作成するためには、いくつかソフトウェアをインストールしなければいけないかもしれません。
The R package <code>tinytex</code> provides some tools to help make this
process easier for R users. With <code>tinytex</code> installed, run
<code>tinytex::install_tinytex()</code> to install the required software
(you’ll only need to do this once) and then when you knit to pdf
<code>tinytex</code> will automatically detect and install any
additional LaTeX packages that are needed to produce the pdf document.
Visit the <a href="https://yihui.org/tinytex/" class="external-link">tinytex website</a> for
more information.</p>
</div>
</div>
</div>
<div id="tip-visual-markdown-editing-in-rstudio" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-visual-markdown-editing-in-rstudio" class="callout-inner">
<h3 class="callout-title">Tip: Visual markdown editing in RStudio</h3>
<div class="callout-content">
<p>RStudio versions 1.4 and later include visual markdown editing mode.
In visual editing mode, markdown expressions (like
<code>**bold words**</code>) are transformed to the formatted appearance
(<strong>bold words</strong>) as you type. This mode also includes a
toolbar at the top with basic formatting buttons, similar to what you
might see in common word processing software programs. You can turn
visual editing on and off by pressing the <img src="../fig/visual_mode_icon.png" alt="Icon for turning on and off the visual editing mode in RStudio, which looks like a pair of compasses" class="figure">
button in the top right corner of your R Markdown document.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="資料">資料<a class="anchor" aria-label="anchor" href="#%E8%B3%87%E6%96%99"></a>
</h2>
<hr class="half-width">
<ul>
<li><a href="https://kbroman.org/knitr_knutshell" class="external-link">Knitr in a knutshell
tutorial</a></li>
<li>
<a href="https://www.amazon.com/exec/obidos/ASIN/1482203537/7210-20" class="external-link">Dynamic
Documents with R and knitr</a> (book)</li>
<li><a href="https://rmarkdown.rstudio.com" class="external-link">R Markdown
documentation</a></li>
<li><a href="https://www.rstudio.com/wp-content/uploads/2016/03/rmarkdown-cheatsheet-2.0.pdf" class="external-link">R
Markdown cheat sheet</a></li>
<li><a href="https://www.rstudio.com/resources/webinars/getting-started-with-r-markdown/" class="external-link">Getting
started with R Markdown</a></li>
<li>
<a href="https://bookdown.org/yihui/rmarkdown/" class="external-link">R Markdown: The
Definitive Guide</a> (book by Rstudio team)</li>
<li><a href="https://www.rstudio.com/resources/webinars/reproducible-reporting/" class="external-link">Reproducible
Reporting</a></li>
<li><a href="https://www.rstudio.com/resources/webinars/the-ecosystem-of-r-markdown/" class="external-link">The
Ecosystem of R Markdown</a></li>
<li><a href="https://www.rstudio.com/resources/webinars/introducing-bookdown/" class="external-link">Introducing
Bookdown</a></li>
</ul>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">まとめ</h3>
<div class="callout-content">
<ul>
<li>Mix reporting written in R Markdown with software written in R.</li>
<li>Specify chunk options to control formatting.</li>
<li>Use <code>knitr</code> to convert these documents into PDF and other
formats.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-15-wrap-up"><p>Content from <a href="15-wrap-up.html">Writing Good Software</a></p>
<hr>
<p>最終更新日：2024-10-12 |

        <a href="https://github.com/swcarpentry-ja/r-novice-gapminder/edit/main/episodes/15-wrap-up.Rmd" class="external-link">ページの編集 <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>所要時間：<i aria-hidden="true" data-feather="clock"></i> 15分</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="回答を全て表示する " data-collapse="回答を全て折りたたむ "> 回答を全て表示する <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">概要</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">質問</h3>
<ul>
<li>How can I write software that other people can use?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">目的</h3>
<ul>
<li>Describe best practices for writing R and explain the justification
for each.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="プロジェクトフォルダーを構造化する">プロジェクトフォルダーを構造化する<a class="anchor" aria-label="anchor" href="#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%83%95%E3%82%A9%E3%83%AB%E3%83%80%E3%83%BC%E3%82%92%E6%A7%8B%E9%80%A0%E5%8C%96%E3%81%99%E3%82%8B"></a>
</h2>
<hr class="half-width">
<p>Keep your project folder structured, organized and tidy, by creating
subfolders for your code files, manuals, data, binaries, output plots,
etc. It can be done completely manually, or with the help of RStudio’s
<code>New Project</code> functionality, or a designated package, such as
<code>ProjectTemplate</code>.</p>
<div id="ヒント解決策の一つprojecttemplate" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ヒント解決策の一つprojecttemplate" class="callout-inner">
<h3 class="callout-title">ヒント：解決策の一つ：ProjectTemplate</h3>
<div class="callout-content">
<p>One way to automate the management of projects is to install the
third-party package, <code>ProjectTemplate</code>. This package will set
up an ideal directory structure for project management. This is very
useful as it enables you to have your analysis pipeline/workflow
organised and structured. Together with the default RStudio project
functionality and Git you will be able to keep track of your work as
well as be able to share your work with collaborators.</p>
<ol style="list-style-type: decimal">
<li>Install <code>ProjectTemplate</code>.</li>
<li>Load the library</li>
<li>Initialise the project:</li>
</ol>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"ProjectTemplate"</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="st">"ProjectTemplate"</span><span class="op">)</span></span>
<span><span class="fu">create.project</span><span class="op">(</span><span class="st">"../my_project_2"</span>, merge.strategy <span class="op">=</span> <span class="st">"allow.non.conflict"</span><span class="op">)</span></span></code></pre>
</div>
<p>For more information on ProjectTemplate and its functionality visit
the home page <a href="https://projecttemplate.net/index.html" class="external-link">ProjectTemplate</a></p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="コードを読めるようにする">コードを読めるようにする<a class="anchor" aria-label="anchor" href="#%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E8%AA%AD%E3%82%81%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B"></a>
</h2>
<hr class="half-width">
<p>The most important part of writing code is making it readable and
understandable.
コードを書く際に一番重要なのが、読みやすくて理解のしやすくすることです。
他の誰が自分のコードを取り上げ、何をするものかを理解してもらわなければなりません。
多くの場合、この誰かさんは、6か月後の自分なので、もしコードが読めない、
理解できない場合は、昔の自分に悪態をつくことになるでしょう。</p>
</section><section><h2 class="section-heading" id="文書化どうやってではなくなぜを伝えて下さい">文書化：「どうやって」ではなく「なぜ」を伝えて下さい<a class="anchor" aria-label="anchor" href="#%E6%96%87%E6%9B%B8%E5%8C%96%E3%81%A9%E3%81%86%E3%82%84%E3%81%A3%E3%81%A6%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%8F%E3%81%AA%E3%81%9C%E3%82%92%E4%BC%9D%E3%81%88%E3%81%A6%E4%B8%8B%E3%81%95%E3%81%84"></a>
</h2>
<hr class="half-width">
<p>When you first start out, your comments will often describe what a
command does, since you’re still learning yourself and it can help to
clarify concepts and remind you later. However, these comments aren’t
particularly useful later on when you don’t remember what problem your
code is trying to solve. Try to also include comments that tell you
<em>why</em> you’re solving a problem, and <em>what</em> problem that
is. The <em>how</em> can come after that: it’s an implementation detail
you ideally shouldn’t have to worry about.</p>
</section><section><h2 class="section-heading" id="コードをモジュール化しましょう">コードをモジュール化しましょう<a class="anchor" aria-label="anchor" href="#%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E5%8C%96%E3%81%97%E3%81%BE%E3%81%97%E3%82%87%E3%81%86"></a>
</h2>
<hr class="half-width">
<p>関数を分析スクリプトと分けて、別のファイルに保存しておき、
プロジェクトでRのセッションを開いたときに、 <code>source</code>
することをオススメします。
このアプローチを取ると、分析スクリプトに無駄がなくなり、プロジェクト内のどの分析スクリプトでも
使える関数をストックする場所ができるので、便利です。
また、同じような関数をまとめるのが簡単になります。</p>
</section><section><h2 class="section-heading" id="問題をひとくち大に分ける">問題をひとくち大に分ける<a class="anchor" aria-label="anchor" href="#%E5%95%8F%E9%A1%8C%E3%82%92%E3%81%B2%E3%81%A8%E3%81%8F%E3%81%A1%E5%A4%A7%E3%81%AB%E5%88%86%E3%81%91%E3%82%8B"></a>
</h2>
<hr class="half-width">
<p>初めは、問題解決と関数の記述は気が滅入るタスクで、
コードの経験不足とは別の問題として分けることができないと思うかもしれません。問題を消化できる塊に分け、
導入の詳細についての心配は後回しにしましょう：
問題をコードで解決できるまで、どんどん小さい関数に分けていきしましょう。
そして、解決されたものを積み上げていけば、問題を解決できるでしょう。</p>
</section><section><h2 class="section-heading" id="コードが正しいことをしているか確かめましょう">コードが正しいことをしているか確かめましょう<a class="anchor" aria-label="anchor" href="#%E3%82%B3%E3%83%BC%E3%83%89%E3%81%8C%E6%AD%A3%E3%81%97%E3%81%84%E3%81%93%E3%81%A8%E3%82%92%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B%E7%A2%BA%E3%81%8B%E3%82%81%E3%81%BE%E3%81%97%E3%82%87%E3%81%86"></a>
</h2>
<hr class="half-width">
<p>関数をテストすることを、くれぐれも忘れないように！</p>
</section><section><h2 class="section-heading" id="同じことを繰り返さないようにしましょう">同じことを繰り返さないようにしましょう<a class="anchor" aria-label="anchor" href="#%E5%90%8C%E3%81%98%E3%81%93%E3%81%A8%E3%82%92%E7%B9%B0%E3%82%8A%E8%BF%94%E3%81%95%E3%81%AA%E3%81%84%E3%82%88%E3%81%86%E3%81%AB%E3%81%97%E3%81%BE%E3%81%97%E3%82%87%E3%81%86"></a>
</h2>
<hr class="half-width">
<p>Functions enable easy reuse within a project.
関数は、プロジェクトの中で簡単に再利用できます。もし、プロジェクトで同じようなコードの行の塊を
見つけたら、それらを関数に移す候補にしましょう。</p>
<p>もし、計算が一連の関数で行われていた場合、プロジェクトはよりモジュール化され、変更するのが簡単になります。
これは、特定のインプットが必ず特定のアウトプットを返す場合など、特にそうです。</p>
</section><section><h2 class="section-heading" id="常にスタイリッシュであろうとする">常にスタイリッシュであろうとする<a class="anchor" aria-label="anchor" href="#%E5%B8%B8%E3%81%AB%E3%82%B9%E3%82%BF%E3%82%A4%E3%83%AA%E3%83%83%E3%82%B7%E3%83%A5%E3%81%A7%E3%81%82%E3%82%8D%E3%81%86%E3%81%A8%E3%81%99%E3%82%8B"></a>
</h2>
<hr class="half-width">
<p>自分のコードに一貫性のあるスタイルを適用しましょう。</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">まとめ</h3>
<div class="callout-content">
<ul>
<li>Keep your project folder structured, organized and tidy.</li>
<li>Document what and why, not how.</li>
<li>Break programs into short single-purpose functions.</li>
<li>Write re-runnable tests.</li>
<li>同じことを繰り返さないようにしましょう.</li>
<li>Be consistent in naming, indentation, and other aspects of
style.</li>
</ul>
</div>
</div>
</div>
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>このレッスンは<a href="CODE_OF_CONDUCT.html">行動規範</a>の対象となっている</p>
        <p>

        <a href="https://github.com/swcarpentry-ja/r-novice-gapminder/edit/main/README.md" class="external-link">GitHubで編集</a>

	
        | <a href="https://github.com/swcarpentry-ja/r-novice-gapminder/blob/main/CONTRIBUTING.md" class="external-link">貢献</a>
        | <a href="https://github.com/swcarpentry-ja/r-novice-gapminder/" class="external-link">ソース</a></p>
				<p><a href="https://github.com/swcarpentry-ja/r-novice-gapminder/blob/main/CITATION" class="external-link">引用</a> | <a href="mailto:team@carpentries.org">お問い合わせ</a> | <a href="https://carpentries.org/about/" class="external-link">概要</a></p>
			</div>
			<div class="col-md-6">

        <p>材料は著者によって<a href="LICENSE.html">CC-BY 4.0</a>のもとに掲載を許諾されている</p>

        <p>テンプレートは<a href="https://carpentries.org/" class="external-link">The Carpentries</a>によって<a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a>のもとに掲載を許諾されている</p>
        <p>このレッスンは<a href="https://github.com/carpentries/sandpaper/tree/main" class="external-link">sandpaper (0.16.9)</a>、<a href="https://github.com/carpentries/pegboard/tree/main" class="external-link">pegboard (0.7.6)</a>、および<a href="https://github.com/carpentries/varnish/tree/1.0.4" class="external-link">varnish (1.0.4)</a>によって作られた</p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="上へ戻る"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top -->
      上へ<span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">戻る</span>
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://swcarpentry.github.io/r-novice-gapminder/instructor/aio.html",
  "inLanguage": "ja",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "ソフトウェア, データ, レッスン, カーペントリーズ",
  "name": "一つにまとまったページ",
  "creativeWorkStatus": "active",
  "url": "https://swcarpentry.github.io/r-novice-gapminder/instructor/aio.html",
  "identifier": "https://swcarpentry.github.io/r-novice-gapminder/instructor/aio.html",
  "dateCreated": "2015-04-18",
  "dateModified": "2024-10-22",
  "datePublished": "2024-10-22"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo --><script>
          var _paq = window._paq = window._paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(["setDomains", ["*.lessons.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
          _paq.push(["setDoNotTrack", true]);
          _paq.push(["disableCookies"]);
          _paq.push(["trackPageView"]);
          _paq.push(["enableLinkTracking"]);
          (function() {
              var u="https://matomo.carpentries.org/";
              _paq.push(["setTrackerUrl", u+"matomo.php"]);
              _paq.push(["setSiteId", "1"]);
              var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0];
              g.async=true; g.src="https://matomo.carpentries.org/matomo.js"; s.parentNode.insertBefore(g,s);
          })();
        </script><!-- End Matomo Code -->
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

